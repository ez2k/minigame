<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨ë“œëŸ¬ì‹œ í´ë¦¬ì»¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ffd700, #ffaa00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .gold-display {
            font-size: 2em;
            margin: 15px 0;
            color: #ffd700;
        }

        .gold-display .amount {
            font-weight: bold;
            font-size: 1.3em;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 0.9em;
            color: #aaa;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Clicker Area */
        .clicker-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
        }

        .coin-button {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: 6px solid #daa520;
            cursor: pointer;
            font-size: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                inset 0 5px 20px rgba(255, 255, 255, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .coin-button:hover {
            transform: scale(1.05);
            box-shadow:
                0 15px 40px rgba(255, 215, 0, 0.4),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                inset 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .coin-button:active {
            transform: scale(0.95);
        }

        .click-text {
            position: fixed;
            pointer-events: none;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: floatUp 1s ease-out forwards;
            z-index: 1000;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5);
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            color: #aaa;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .tab.active {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
        }

        /* Panels */
        .panel {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0 0 15px 15px;
            padding: 15px;
            min-height: 300px;
        }

        .panel.active {
            display: block;
        }

        /* Generators */
        .generator-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .generator-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .generator-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .generator-icon {
            font-size: 2.5em;
            width: 60px;
            text-align: center;
        }

        .generator-details h3 {
            color: #fff;
            margin-bottom: 5px;
        }

        .generator-details p {
            color: #aaa;
            font-size: 0.85em;
        }

        .generator-owned {
            color: #ffd700;
            font-size: 0.9em;
            margin-top: 3px;
        }

        .generator-right {
            text-align: right;
        }

        .buy-btn {
            padding: 10px 20px;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            min-width: 120px;
        }

        .buy-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .buy-amount {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            justify-content: flex-end;
        }

        .amount-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .amount-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .amount-btn.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
            color: #ffd700;
        }

        /* Upgrades */
        .upgrade-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .upgrade-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .upgrade-item.purchased {
            opacity: 0.5;
            border-color: rgba(0, 255, 0, 0.3);
        }

        .upgrade-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .upgrade-icon {
            font-size: 2em;
            width: 50px;
            text-align: center;
        }

        /* Prestige */
        .prestige-area {
            text-align: center;
            padding: 30px;
        }

        .prestige-info {
            background: linear-gradient(145deg, rgba(147, 112, 219, 0.2), rgba(138, 43, 226, 0.2));
            border: 2px solid rgba(147, 112, 219, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .prestige-info h2 {
            color: #dda0dd;
            margin-bottom: 15px;
        }

        .prestige-gems {
            font-size: 2em;
            color: #da70d6;
            margin: 15px 0;
        }

        .prestige-bonus {
            color: #aaa;
            margin-bottom: 20px;
        }

        .prestige-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #9370db, #8a2be2);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .prestige-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 30px rgba(147, 112, 219, 0.5);
        }

        .prestige-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .prestige-requirement {
            color: #888;
            font-size: 0.9em;
            margin-top: 15px;
        }

        /* Settings */
        .settings-area {
            padding: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .setting-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .setting-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .setting-btn.danger {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.3);
        }

        .setting-btn.danger:hover {
            background: rgba(255, 0, 0, 0.4);
        }

        /* Offline Popup */
        .offline-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .offline-popup.hidden {
            display: none;
        }

        .offline-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
        }

        .offline-content h2 {
            color: #ffd700;
            margin-bottom: 20px;
        }

        .offline-earnings {
            font-size: 2em;
            color: #ffd700;
            margin: 20px 0;
        }

        .offline-time {
            color: #aaa;
            margin-bottom: 20px;
        }

        .offline-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: none;
            border-radius: 10px;
            color: #1a1a2e;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .offline-btn:hover {
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }

            .gold-display {
                font-size: 1.5em;
            }

            .coin-button {
                width: 150px;
                height: 150px;
                font-size: 60px;
            }

            .stats-row {
                flex-direction: column;
                gap: 5px;
            }

            .generator-item {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .generator-right {
                text-align: center;
            }

            .buy-amount {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Offline Popup -->
    <div id="offlinePopup" class="offline-popup hidden">
        <div class="offline-content">
            <h2>ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”!</h2>
            <p class="offline-time" id="offlineTime"></p>
            <p>ì˜¤í”„ë¼ì¸ ë™ì•ˆ ë²Œì–´ë“¤ì¸ ê³¨ë“œ:</p>
            <div class="offline-earnings" id="offlineEarnings">+0</div>
            <button class="offline-btn" onclick="closeOfflinePopup()">ë°›ê¸°!</button>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ê³¨ë“œëŸ¬ì‹œ í´ë¦¬ì»¤</h1>
            <div class="gold-display">
                <span>ğŸ’°</span> <span class="amount" id="goldAmount">0</span> ê³¨ë“œ
            </div>
            <div class="stats-row">
                <div class="stat">
                    <span>ğŸ‘†</span>
                    <span>í´ë¦­ë‹¹: <span id="clickPower">1</span></span>
                </div>
                <div class="stat">
                    <span>âš¡</span>
                    <span>ì´ˆë‹¹: <span id="perSecond">0</span></span>
                </div>
                <div class="stat">
                    <span>ğŸ’</span>
                    <span>ë³´ì„: <span id="gems">0</span></span>
                </div>
            </div>
        </div>

        <!-- Clicker -->
        <div class="clicker-area">
            <button class="coin-button" id="coinBtn">ğŸ’°</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="generators">ğŸ­ ìƒì‚°ì‹œì„¤</button>
            <button class="tab" data-tab="upgrades">â¬†ï¸ ì—…ê·¸ë ˆì´ë“œ</button>
            <button class="tab" data-tab="prestige">ğŸ’ í™˜ìƒ</button>
            <button class="tab" data-tab="settings">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- Panels -->
        <div id="generators" class="panel active">
            <div class="buy-amount" style="margin-bottom: 15px; justify-content: flex-start;">
                <span style="color: #aaa; margin-right: 10px;">êµ¬ë§¤ ìˆ˜ëŸ‰:</span>
                <button class="amount-btn active" data-amount="1">x1</button>
                <button class="amount-btn" data-amount="10">x10</button>
                <button class="amount-btn" data-amount="100">x100</button>
                <button class="amount-btn" data-amount="max">MAX</button>
            </div>
            <div id="generatorList"></div>
        </div>

        <div id="upgrades" class="panel">
            <div id="upgradeList"></div>
        </div>

        <div id="prestige" class="panel">
            <div class="prestige-area">
                <div class="prestige-info">
                    <h2>ğŸ’ í™˜ìƒ ì‹œìŠ¤í…œ</h2>
                    <p>ëª¨ë“  ê³¨ë“œì™€ ì‹œì„¤ì„ ì´ˆê¸°í™”í•˜ê³ <br>ì˜êµ¬ ë³´ë„ˆìŠ¤ë¥¼ ì–»ìœ¼ì„¸ìš”!</p>
                    <div class="prestige-gems">
                        íšë“ ì˜ˆì •: <span id="prestigeGain">0</span> ğŸ’
                    </div>
                    <p class="prestige-bonus">
                        í˜„ì¬ ë³´ë„ˆìŠ¤: <span id="prestigeBonus">0</span>% ì¶”ê°€ ê³¨ë“œ
                    </p>
                    <button class="prestige-btn" id="prestigeBtn" disabled>í™˜ìƒí•˜ê¸°</button>
                    <p class="prestige-requirement" id="prestigeReq">1,000,000 ê³¨ë“œ í•„ìš”</p>
                </div>
            </div>
        </div>

        <div id="settings" class="panel">
            <div class="settings-area">
                <div class="setting-item">
                    <span>ğŸ’¾ ìˆ˜ë™ ì €ì¥</span>
                    <button class="setting-btn" onclick="saveGame()">ì €ì¥í•˜ê¸°</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ“Š í†µê³„ ë³´ê¸°</span>
                    <button class="setting-btn" onclick="showStats()">í†µê³„</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ—‘ï¸ ê²Œì„ ì´ˆê¸°í™”</span>
                    <button class="setting-btn danger" onclick="resetGame()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            gold: 0,
            totalGold: 0,
            totalClicks: 0,
            clickPower: 1,
            perSecond: 0,
            gems: 0,
            totalGems: 0,
            generators: {},
            upgrades: {},
            lastSave: Date.now(),
            startTime: Date.now()
        };

        let buyAmount = 1;

        // Generators Data
        const generators = [
            { id: 'cursor', name: 'ìë™ ì»¤ì„œ', icon: 'ğŸ‘†', basePrice: 15, baseProduction: 0.1 },
            { id: 'miner', name: 'ê´‘ë¶€', icon: 'â›ï¸', basePrice: 100, baseProduction: 1 },
            { id: 'mine', name: 'ê¸ˆê´‘', icon: 'ğŸ”ï¸', basePrice: 1100, baseProduction: 8 },
            { id: 'factory', name: 'ê³µì¥', icon: 'ğŸ­', basePrice: 12000, baseProduction: 47 },
            { id: 'bank', name: 'ì€í–‰', icon: 'ğŸ¦', basePrice: 130000, baseProduction: 260 },
            { id: 'temple', name: 'í™©ê¸ˆ ì‚¬ì›', icon: 'ğŸ›•', basePrice: 1400000, baseProduction: 1400 },
            { id: 'wizard', name: 'ì—°ê¸ˆìˆ ì‚¬', icon: 'ğŸ§™', basePrice: 20000000, baseProduction: 7800 },
            { id: 'portal', name: 'ì°¨ì›ë¬¸', icon: 'ğŸŒ€', basePrice: 330000000, baseProduction: 44000 },
            { id: 'timemachine', name: 'íƒ€ì„ë¨¸ì‹ ', icon: 'â°', basePrice: 5100000000, baseProduction: 260000 }
        ];

        // Upgrades Data
        const upgrades = [
            { id: 'click1', name: 'ê°•í™”ëœ ì†ê°€ë½', icon: 'ğŸ‘†', price: 100, desc: 'í´ë¦­ë‹¹ +1', effect: () => gameState.clickPower += 1 },
            { id: 'click2', name: 'í™©ê¸ˆ ì†ê°€ë½', icon: 'âœ¨', price: 500, desc: 'í´ë¦­ë‹¹ +5', effect: () => gameState.clickPower += 5 },
            { id: 'click3', name: 'ë‹¤ì´ì•„ëª¬ë“œ ì†ê°€ë½', icon: 'ğŸ’', price: 10000, desc: 'í´ë¦­ë‹¹ +50', effect: () => gameState.clickPower += 50 },
            { id: 'cursor1', name: 'ì»¤ì„œ ì—…ê·¸ë ˆì´ë“œ', icon: 'ğŸ–±ï¸', price: 100, desc: 'ì»¤ì„œ íš¨ìœ¨ 2ë°°', requires: 'cursor', multiplier: 2 },
            { id: 'miner1', name: 'ë” ì¢‹ì€ ê³¡ê´­ì´', icon: 'â›ï¸', price: 1000, desc: 'ê´‘ë¶€ íš¨ìœ¨ 2ë°°', requires: 'miner', multiplier: 2 },
            { id: 'mine1', name: 'ê¹Šì€ êµ´ì°©', icon: 'ğŸ•³ï¸', price: 11000, desc: 'ê¸ˆê´‘ íš¨ìœ¨ 2ë°°', requires: 'mine', multiplier: 2 },
            { id: 'factory1', name: 'ìë™í™”', icon: 'ğŸ¤–', price: 120000, desc: 'ê³µì¥ íš¨ìœ¨ 2ë°°', requires: 'factory', multiplier: 2 },
            { id: 'bank1', name: 'ë³µë¦¬ ì´ì', icon: 'ğŸ“ˆ', price: 1300000, desc: 'ì€í–‰ íš¨ìœ¨ 2ë°°', requires: 'bank', multiplier: 2 },
            { id: 'global1', name: 'í™©ê¸ˆ ì¶•ë³µ', icon: 'ğŸŒŸ', price: 10000000, desc: 'ëª¨ë“  ìƒì‚°ëŸ‰ +50%', globalMultiplier: 1.5 },
            { id: 'click4', name: 'ë¯¸ë‹¤ìŠ¤ì˜ ì†', icon: 'ğŸ‘‘', price: 100000000, desc: 'í´ë¦­ë‹¹ +500', effect: () => gameState.clickPower += 500 },
            { id: 'global2', name: 'ê³¨ë“œ í”¼ë²„', icon: 'ğŸ”¥', price: 1000000000, desc: 'ëª¨ë“  ìƒì‚°ëŸ‰ 2ë°°', globalMultiplier: 2 }
        ];

        let globalMultiplier = 1;
        let generatorMultipliers = {};

        // Format number
        function formatNumber(num) {
            if (num < 1) return num.toFixed(1); // 0.1 ê°™ì€ ì†Œìˆ˜ í‘œì‹œ
            if (num < 1000) return Math.floor(num).toLocaleString();

            const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc'];
            const tier = Math.floor(Math.log10(Math.abs(num)) / 3);

            if (tier >= suffixes.length) {
                return num.toExponential(2);
            }

            const suffix = suffixes[tier];
            const scale = Math.pow(10, tier * 3);
            const scaled = num / scale;

            return scaled.toFixed(scaled < 10 ? 2 : 1) + suffix;
        }

        // Calculate generator price
        function getGeneratorPrice(gen, amount = 1) {
            const owned = gameState.generators[gen.id] || 0;
            let total = 0;
            for (let i = 0; i < amount; i++) {
                total += Math.floor(gen.basePrice * Math.pow(1.15, owned + i));
            }
            return total;
        }

        // Calculate max affordable
        function getMaxAffordable(gen) {
            const owned = gameState.generators[gen.id] || 0;
            let count = 0;
            let total = 0;
            while (total + Math.floor(gen.basePrice * Math.pow(1.15, owned + count)) <= gameState.gold) {
                total += Math.floor(gen.basePrice * Math.pow(1.15, owned + count));
                count++;
                if (count > 1000) break;
            }
            return count;
        }

        // Get actual buy amount
        function getActualBuyAmount(gen) {
            if (buyAmount === 'max') {
                return getMaxAffordable(gen);
            }
            return Math.min(buyAmount, getMaxAffordable(gen));
        }

        // Calculate production
        function calculateProduction() {
            let total = 0;
            generators.forEach(gen => {
                const owned = gameState.generators[gen.id] || 0;
                const multiplier = generatorMultipliers[gen.id] || 1;
                total += owned * gen.baseProduction * multiplier * globalMultiplier;
            });

            // Prestige bonus
            const prestigeBonus = 1 + (gameState.gems * 0.01);
            total *= prestigeBonus;

            return total;
        }

        // Click handler
        function handleClick(e) {
            const prestigeBonus = 1 + (gameState.gems * 0.01);
            const earned = gameState.clickPower * prestigeBonus;
            gameState.gold += earned;
            gameState.totalGold += earned;
            gameState.totalClicks++;

            // Floating text
            const text = document.createElement('div');
            text.className = 'click-text';
            text.textContent = '+' + formatNumber(earned);
            text.style.left = (e.clientX || e.touches?.[0]?.clientX || window.innerWidth/2) + 'px';
            text.style.top = (e.clientY || e.touches?.[0]?.clientY || window.innerHeight/2) + 'px';
            text.style.fontSize = Math.min(20 + earned/100, 40) + 'px';
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 1000);

            updateUI();
        }

        // Buy generator
        function buyGenerator(genId) {
            const gen = generators.find(g => g.id === genId);
            const amount = getActualBuyAmount(gen);
            if (amount <= 0) return;

            const price = getGeneratorPrice(gen, amount);
            if (gameState.gold >= price) {
                gameState.gold -= price;
                gameState.generators[genId] = (gameState.generators[genId] || 0) + amount;
                gameState.perSecond = calculateProduction();
                fullRender(); // êµ¬ë§¤ í›„ ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                updateUI();
            }
        }

        // Buy upgrade
        function buyUpgrade(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            if (gameState.upgrades[upgradeId]) return;
            if (gameState.gold < upgrade.price) return;

            gameState.gold -= upgrade.price;
            gameState.upgrades[upgradeId] = true;

            if (upgrade.effect) upgrade.effect();
            if (upgrade.multiplier && upgrade.requires) {
                generatorMultipliers[upgrade.requires] = (generatorMultipliers[upgrade.requires] || 1) * upgrade.multiplier;
            }
            if (upgrade.globalMultiplier) {
                globalMultiplier *= upgrade.globalMultiplier;
            }

            gameState.perSecond = calculateProduction();
            fullRender(); // êµ¬ë§¤ í›„ ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            updateUI();
        }

        // Calculate prestige gain
        function calculatePrestigeGain() {
            if (gameState.totalGold < 1000000) return 0;
            return Math.floor(Math.sqrt(gameState.totalGold / 1000000));
        }

        // Prestige
        function doPrestige() {
            const gain = calculatePrestigeGain();
            if (gain <= 0) return;

            if (!confirm(`í™˜ìƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${gain}ê°œì˜ ë³´ì„ì„ íšë“í•©ë‹ˆë‹¤.\nëª¨ë“  ê³¨ë“œì™€ ì‹œì„¤ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.`)) return;

            gameState.gems += gain;
            gameState.totalGems += gain;
            gameState.gold = 0;
            gameState.totalGold = 0;
            gameState.clickPower = 1;
            gameState.generators = {};
            gameState.upgrades = {};

            globalMultiplier = 1;
            generatorMultipliers = {};

            gameState.perSecond = calculateProduction();
            fullRender(); // í™˜ìƒ í›„ ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            updateUI();
            saveGame();
        }

        // Render generators
        function renderGenerators() {
            const container = document.getElementById('generatorList');
            container.innerHTML = generators.map(gen => {
                const owned = gameState.generators[gen.id] || 0;
                const amount = buyAmount === 'max' ? getMaxAffordable(gen) : buyAmount;
                const price = getGeneratorPrice(gen, amount);
                const canBuy = gameState.gold >= price && amount > 0;
                const multiplier = generatorMultipliers[gen.id] || 1;
                const production = gen.baseProduction * multiplier * globalMultiplier;

                return `
                    <div class="generator-item">
                        <div class="generator-info">
                            <div class="generator-icon">${gen.icon}</div>
                            <div class="generator-details">
                                <h3>${gen.name}</h3>
                                <p>ì´ˆë‹¹ ${formatNumber(production)} ê³¨ë“œ</p>
                                <p class="generator-owned">ë³´ìœ : ${owned}ê°œ</p>
                            </div>
                        </div>
                        <div class="generator-right">
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buyGenerator('${gen.id}')">
                                ${amount > 0 ? `x${amount} - ${formatNumber(price)}` : 'êµ¬ë§¤ ë¶ˆê°€'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render upgrades
        function renderUpgrades() {
            const container = document.getElementById('upgradeList');
            container.innerHTML = upgrades.map(upgrade => {
                const purchased = gameState.upgrades[upgrade.id];
                const canBuy = !purchased && gameState.gold >= upgrade.price;

                return `
                    <div class="upgrade-item ${purchased ? 'purchased' : ''}">
                        <div class="upgrade-info">
                            <div class="upgrade-icon">${upgrade.icon}</div>
                            <div class="generator-details">
                                <h3>${upgrade.name}</h3>
                                <p>${upgrade.desc}</p>
                            </div>
                        </div>
                        <div class="generator-right">
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buyUpgrade('${upgrade.id}')">
                                ${purchased ? 'êµ¬ë§¤ì™„ë£Œ' : formatNumber(upgrade.price)}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update UI (ìˆ«ìë§Œ ì—…ë°ì´íŠ¸, DOM ì¬ìƒì„± ì•ˆí•¨)
        function updateUI() {
            document.getElementById('goldAmount').textContent = formatNumber(gameState.gold);
            document.getElementById('clickPower').textContent = formatNumber(gameState.clickPower);
            document.getElementById('perSecond').textContent = formatNumber(gameState.perSecond);
            document.getElementById('gems').textContent = formatNumber(gameState.gems);

            // Prestige
            const gain = calculatePrestigeGain();
            document.getElementById('prestigeGain').textContent = formatNumber(gain);
            document.getElementById('prestigeBonus').textContent = gameState.gems;
            document.getElementById('prestigeBtn').disabled = gain <= 0;
            document.getElementById('prestigeReq').textContent = gain > 0 ?
                'í™˜ìƒ ê°€ëŠ¥!' : `${formatNumber(1000000)} ê³¨ë“œ í•„ìš”`;

            // ë²„íŠ¼ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸ (DOM ì¬ìƒì„± ì•ˆí•¨)
            updateButtonStates();
        }

        // ë²„íŠ¼ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸
        function updateButtonStates() {
            // Generator ë²„íŠ¼ë“¤
            document.querySelectorAll('#generatorList .buy-btn').forEach((btn, i) => {
                const gen = generators[i];
                if (!gen) return;
                const amount = buyAmount === 'max' ? getMaxAffordable(gen) : buyAmount;
                const price = getGeneratorPrice(gen, amount);
                const canBuy = gameState.gold >= price && amount > 0;
                btn.disabled = !canBuy;
                btn.textContent = amount > 0 ? `x${amount} - ${formatNumber(price)}` : 'êµ¬ë§¤ ë¶ˆê°€';
            });

            // Upgrade ë²„íŠ¼ë“¤
            document.querySelectorAll('#upgradeList .buy-btn').forEach((btn, i) => {
                const upgrade = upgrades[i];
                if (!upgrade) return;
                const purchased = gameState.upgrades[upgrade.id];
                const canBuy = !purchased && gameState.gold >= upgrade.price;
                btn.disabled = !canBuy || purchased;
                btn.textContent = purchased ? 'êµ¬ë§¤ì™„ë£Œ' : formatNumber(upgrade.price);
            });
        }

        // ì „ì²´ UI ë‹¤ì‹œ ê·¸ë¦¬ê¸° (êµ¬ë§¤ í›„ì—ë§Œ í˜¸ì¶œ)
        function fullRender() {
            renderGenerators();
            renderUpgrades();
        }

        // ìë™ ìƒì‚° ì• ë‹ˆë©”ì´ì…˜ íƒ€ì´ë¨¸
        let autoAnimationTimer = 0;

        // ìë™ ìƒì‚° í”Œë¡œíŒ… í…ìŠ¤íŠ¸
        function showAutoEarning(amount) {
            const coinBtn = document.getElementById('coinBtn');
            const rect = coinBtn.getBoundingClientRect();

            const text = document.createElement('div');
            text.className = 'click-text';
            text.textContent = '+' + formatNumber(amount);
            text.style.left = (rect.left + rect.width / 2 + (Math.random() - 0.5) * 60) + 'px';
            text.style.top = (rect.top + rect.height / 2 + (Math.random() - 0.5) * 40) + 'px';
            text.style.fontSize = '18px';
            text.style.color = '#90EE90'; // ì—°ë‘ìƒ‰ìœ¼ë¡œ êµ¬ë¶„
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 1000);
        }

        // Game loop
        function gameLoop() {
            // ë§¤ í‹±ë§ˆë‹¤ ìƒì‚°ëŸ‰ ì¬ê³„ì‚°
            gameState.perSecond = calculateProduction();

            if (gameState.perSecond > 0) {
                const earned = gameState.perSecond / 10; // 100msë§ˆë‹¤ ì‹¤í–‰ë˜ë¯€ë¡œ 10ìœ¼ë¡œ ë‚˜ëˆ”
                gameState.gold += earned;
                gameState.totalGold += earned;

                // 0.5ì´ˆë§ˆë‹¤ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
                autoAnimationTimer += 100;
                if (autoAnimationTimer >= 500) {
                    showAutoEarning(gameState.perSecond / 2); // 0.5ì´ˆì¹˜ í‘œì‹œ
                    autoAnimationTimer = 0;
                }
            }
            updateUI();
        }

        // Save game
        function saveGame() {
            gameState.lastSave = Date.now();
            localStorage.setItem('goldRushClicker', JSON.stringify(gameState));
            localStorage.setItem('goldRushMultipliers', JSON.stringify({
                global: globalMultiplier,
                generators: generatorMultipliers
            }));
        }

        // Load game
        function loadGame() {
            const saved = localStorage.getItem('goldRushClicker');
            const multipliers = localStorage.getItem('goldRushMultipliers');

            if (saved) {
                gameState = JSON.parse(saved);

                if (multipliers) {
                    const m = JSON.parse(multipliers);
                    globalMultiplier = m.global || 1;
                    generatorMultipliers = m.generators || {};
                }

                // Calculate offline earnings
                const now = Date.now();
                const elapsed = (now - gameState.lastSave) / 1000;

                if (elapsed > 60 && gameState.perSecond > 0) {
                    const maxOfflineTime = 8 * 60 * 60; // 8 hours max
                    const offlineTime = Math.min(elapsed, maxOfflineTime);
                    const offlineEarnings = gameState.perSecond * offlineTime * 0.5; // 50% efficiency

                    document.getElementById('offlineTime').textContent =
                        `${Math.floor(offlineTime / 3600)}ì‹œê°„ ${Math.floor((offlineTime % 3600) / 60)}ë¶„ ë™ì•ˆ`;
                    document.getElementById('offlineEarnings').textContent = '+' + formatNumber(offlineEarnings);
                    document.getElementById('offlinePopup').classList.remove('hidden');

                    gameState.gold += offlineEarnings;
                    gameState.totalGold += offlineEarnings;
                }

                gameState.perSecond = calculateProduction();
            }
        }

        function closeOfflinePopup() {
            document.getElementById('offlinePopup').classList.add('hidden');
        }

        // Reset game
        function resetGame() {
            if (!confirm('ì •ë§ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤!')) return;

            localStorage.removeItem('goldRushClicker');
            localStorage.removeItem('goldRushMultipliers');
            location.reload();
        }

        // Show stats
        function showStats() {
            const playTime = Math.floor((Date.now() - gameState.startTime) / 1000);
            const hours = Math.floor(playTime / 3600);
            const minutes = Math.floor((playTime % 3600) / 60);

            alert(`ğŸ“Š ê²Œì„ í†µê³„\n\n` +
                `ì´ íšë“ ê³¨ë“œ: ${formatNumber(gameState.totalGold)}\n` +
                `ì´ í´ë¦­ ìˆ˜: ${formatNumber(gameState.totalClicks)}\n` +
                `ì´ íšë“ ë³´ì„: ${formatNumber(gameState.totalGems)}\n` +
                `í”Œë ˆì´ ì‹œê°„: ${hours}ì‹œê°„ ${minutes}ë¶„`);
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Buy amount buttons
        document.querySelectorAll('.amount-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                buyAmount = btn.dataset.amount === 'max' ? 'max' : parseInt(btn.dataset.amount);
                fullRender(); // ìˆ˜ëŸ‰ ë³€ê²½ ì‹œ ê°€ê²© ì¬ê³„ì‚°
                updateUI();
            });
        });

        // Initialize
        document.getElementById('coinBtn').addEventListener('click', handleClick);
        document.getElementById('coinBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick(e);
        });
        document.getElementById('prestigeBtn').addEventListener('click', doPrestige);

        loadGame();
        gameState.perSecond = calculateProduction(); // ì´ˆê¸° ìƒì‚°ëŸ‰ ê³„ì‚°
        fullRender(); // ì´ˆê¸° ë Œë”ë§
        updateUI();

        // Game loops
        setInterval(gameLoop, 100);
        setInterval(saveGame, 30000);
    </script>
</body>
</html>
