<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨ë“œëŸ¬ì‹œ í´ë¦¬ì»¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
            transition: background 0.3s;
        }

        body.light-mode {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            margin-bottom: 20px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ffd700, #ffaa00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
        }

        .gold-display {
            font-size: 2em;
            margin: 15px 0;
            color: #ffd700;
        }

        body.light-mode .gold-display {
            color: #b8860b;
        }

        .gold-display .amount {
            font-weight: bold;
            font-size: 1.3em;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 0.9em;
            color: #aaa;
        }

        body.light-mode .stats-row {
            color: #666;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Buff indicator */
        .buff-indicator {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            animation: pulse 1s infinite;
            display: none;
        }

        .buff-indicator.active {
            display: inline-block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Clicker Area */
        .clicker-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
            position: relative;
        }

        .coin-button {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: 6px solid #daa520;
            cursor: pointer;
            font-size: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                inset 0 5px 20px rgba(255, 255, 255, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            z-index: 10;
        }

        .coin-button:hover {
            transform: scale(1.05);
            box-shadow:
                0 15px 40px rgba(255, 215, 0, 0.4),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                inset 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .coin-button:active {
            transform: scale(0.95);
        }

        /* Golden Coin Bonus */
        .golden-coin {
            position: fixed;
            width: 80px;
            height: 80px;
            font-size: 50px;
            cursor: pointer;
            animation: float 2s ease-in-out infinite, glow 0.5s ease-in-out infinite alternate;
            z-index: 1000;
            filter: drop-shadow(0 0 20px gold);
            transition: transform 0.1s;
        }

        .golden-coin:hover {
            transform: scale(1.2);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px gold); }
            to { filter: drop-shadow(0 0 30px gold); }
        }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 20px;
            z-index: 999;
        }

        .click-text {
            position: fixed;
            pointer-events: none;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: floatUp 1s ease-out forwards;
            z-index: 1000;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            color: #aaa;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        body.light-mode .tab {
            background: rgba(0, 0, 0, 0.1);
            color: #666;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .tab.active {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
        }

        .tab .notification {
            background: #ff4444;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7em;
            margin-left: 5px;
        }

        /* Panels */
        .panel {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0 0 15px 15px;
            padding: 15px;
            min-height: 300px;
        }

        body.light-mode .panel {
            background: rgba(255, 255, 255, 0.8);
        }

        .panel.active {
            display: block;
        }

        /* Generator & Upgrade Items */
        .generator-item, .upgrade-item, .achievement-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        body.light-mode .generator-item,
        body.light-mode .upgrade-item,
        body.light-mode .achievement-item {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
        }

        .generator-item:hover, .upgrade-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .generator-info, .upgrade-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .generator-icon, .upgrade-icon {
            font-size: 2.5em;
            width: 60px;
            text-align: center;
        }

        .generator-details h3 {
            color: #fff;
            margin-bottom: 5px;
        }

        body.light-mode .generator-details h3 {
            color: #333;
        }

        .generator-details p {
            color: #aaa;
            font-size: 0.85em;
        }

        .generator-owned {
            color: #ffd700;
            font-size: 0.9em;
            margin-top: 3px;
        }

        .generator-right {
            text-align: right;
        }

        .buy-btn {
            padding: 10px 20px;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            min-width: 120px;
        }

        .buy-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .buy-amount {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            justify-content: flex-end;
        }

        .amount-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .amount-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .amount-btn.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
            color: #ffd700;
        }

        /* Achievements */
        .achievement-item {
            opacity: 0.5;
        }

        .achievement-item.unlocked {
            opacity: 1;
            border-color: rgba(255, 215, 0, 0.5);
            background: rgba(255, 215, 0, 0.1);
        }

        .achievement-icon {
            font-size: 2em;
            width: 50px;
            text-align: center;
            filter: grayscale(100%);
        }

        .achievement-item.unlocked .achievement-icon {
            filter: none;
        }

        .achievement-reward {
            color: #ffd700;
            font-size: 0.85em;
        }

        /* Lucky Spin */
        .spin-area {
            text-align: center;
            padding: 20px;
        }

        .spin-wheel {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: conic-gradient(
                #ff6b6b 0deg 45deg,
                #ffd93d 45deg 90deg,
                #6bcb77 90deg 135deg,
                #4d96ff 135deg 180deg,
                #ff6b6b 180deg 225deg,
                #ffd93d 225deg 270deg,
                #6bcb77 270deg 315deg,
                #4d96ff 315deg 360deg
            );
            margin: 20px auto;
            position: relative;
            border: 5px solid #ffd700;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .spin-wheel::before {
            content: 'â–¼';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            color: #ffd700;
        }

        .spin-wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .spin-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: none;
            border-radius: 10px;
            color: #1a1a2e;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .spin-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .spin-cooldown {
            color: #aaa;
            margin-top: 10px;
        }

        /* Chart */
        .chart-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            height: 200px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        /* Prestige */
        .prestige-area {
            text-align: center;
            padding: 30px;
        }

        .prestige-info {
            background: linear-gradient(145deg, rgba(147, 112, 219, 0.2), rgba(138, 43, 226, 0.2));
            border: 2px solid rgba(147, 112, 219, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .prestige-info h2 {
            color: #dda0dd;
            margin-bottom: 15px;
        }

        .prestige-gems {
            font-size: 2em;
            color: #da70d6;
            margin: 15px 0;
        }

        .prestige-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #9370db, #8a2be2);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .prestige-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        /* Settings */
        .settings-area {
            padding: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .setting-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .setting-btn.danger {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.3);
        }

        /* Records */
        .records-area {
            padding: 20px;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .record-value {
            color: #ffd700;
            font-weight: bold;
        }

        /* Offline Popup */
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .popup.hidden {
            display: none;
        }

        .popup-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
        }

        .popup-content h2 {
            color: #ffd700;
            margin-bottom: 20px;
        }

        .popup-earnings {
            font-size: 2em;
            color: #ffd700;
            margin: 20px 0;
        }

        .popup-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #ffd700, #b8860b);
            border: none;
            border-radius: 10px;
            color: #1a1a2e;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
        }

        /* Buff Popup */
        .buff-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #ff6b6b, #ffd93d);
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            color: #1a1a2e;
            z-index: 2000;
            animation: buffPopup 2s forwards;
        }

        @keyframes buffPopup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8em; }
            .gold-display { font-size: 1.5em; }
            .coin-button { width: 150px; height: 150px; font-size: 60px; }
            .stats-row { flex-direction: column; gap: 5px; }
            .generator-item, .upgrade-item { flex-direction: column; gap: 15px; text-align: center; }
            .generator-right { text-align: center; }
            .tab { padding: 10px 5px; font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <!-- Offline Popup -->
    <div id="offlinePopup" class="popup hidden">
        <div class="popup-content">
            <h2>ë‹¤ì‹œ ì˜¤ì…¨êµ°ìš”! ğŸ‰</h2>
            <p id="offlineTime"></p>
            <p>ì˜¤í”„ë¼ì¸ ë™ì•ˆ ë²Œì–´ë“¤ì¸ ê³¨ë“œ:</p>
            <div class="popup-earnings" id="offlineEarnings">+0</div>
            <button class="popup-btn" onclick="closeOfflinePopup()">ë°›ê¸°!</button>
        </div>
    </div>

    <!-- Spin Result Popup -->
    <div id="spinResultPopup" class="popup hidden">
        <div class="popup-content">
            <h2>ğŸ° ëŸ­í‚¤ ìŠ¤í•€ ê²°ê³¼!</h2>
            <div class="popup-earnings" id="spinResult"></div>
            <button class="popup-btn" onclick="closeSpinPopup()">í™•ì¸</button>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">ğŸŒ™</button>
            <h1>ê³¨ë“œëŸ¬ì‹œ í´ë¦¬ì»¤</h1>
            <div class="gold-display">
                ğŸ’° <span class="amount" id="goldAmount">0</span> ê³¨ë“œ
            </div>
            <div class="stats-row">
                <div class="stat">ğŸ‘† í´ë¦­ë‹¹: <span id="clickPower">1</span></div>
                <div class="stat">âš¡ ì´ˆë‹¹: <span id="perSecond">0</span></div>
                <div class="stat">ğŸ’ ë³´ì„: <span id="gems">0</span></div>
                <div class="stat">â° <span id="playTime">00:00:00</span></div>
            </div>
            <div class="buff-indicator" id="buffIndicator">ğŸ”¥ 2ë°° ë²„í”„! <span id="buffTimer">30</span>ì´ˆ</div>
        </div>

        <!-- Clicker -->
        <div class="clicker-area" id="clickerArea">
            <button class="coin-button" id="coinBtn">ğŸ’°</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="generators">ğŸ­ ìƒì‚°</button>
            <button class="tab" data-tab="upgrades">â¬†ï¸ ê°•í™”</button>
            <button class="tab" data-tab="achievements">ğŸ¯ ë„ì „</button>
            <button class="tab" data-tab="spin">ğŸ° ìŠ¤í•€</button>
            <button class="tab" data-tab="stats">ğŸ“Š í†µê³„</button>
            <button class="tab" data-tab="prestige">ğŸ’ í™˜ìƒ</button>
            <button class="tab" data-tab="settings">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- Panels -->
        <div id="generators" class="panel active">
            <div class="buy-amount" style="margin-bottom: 15px;">
                <span style="color: #aaa; margin-right: 10px;">êµ¬ë§¤ ìˆ˜ëŸ‰:</span>
                <button class="amount-btn active" data-amount="1">x1</button>
                <button class="amount-btn" data-amount="10">x10</button>
                <button class="amount-btn" data-amount="100">x100</button>
                <button class="amount-btn" data-amount="max">MAX</button>
            </div>
            <div id="generatorList"></div>
        </div>

        <div id="upgrades" class="panel">
            <div id="upgradeList"></div>
        </div>

        <div id="achievements" class="panel">
            <div id="achievementList"></div>
        </div>

        <div id="spin" class="panel">
            <div class="spin-area">
                <h2 style="margin-bottom: 20px;">ğŸ° ëŸ­í‚¤ ìŠ¤í•€</h2>
                <p style="color: #aaa; margin-bottom: 20px;">ë¬´ë£Œ ìŠ¤í•€ìœ¼ë¡œ ë³´ìƒì„ ë°›ìœ¼ì„¸ìš”!</p>
                <div class="spin-wheel" id="spinWheel">
                    <div class="spin-wheel-center">ğŸ</div>
                </div>
                <button class="spin-btn" id="spinBtn" onclick="doSpin()">ìŠ¤í•€!</button>
                <p class="spin-cooldown" id="spinCooldown"></p>
            </div>
        </div>

        <div id="stats" class="panel">
            <div class="records-area">
                <h3 style="margin-bottom: 20px;">ğŸ“Š í†µê³„ & ê¸°ë¡</h3>
                <div class="chart-container">
                    <canvas id="goldChart" class="chart-canvas"></canvas>
                </div>
                <div style="margin-top: 20px;">
                    <div class="record-item">
                        <span>ğŸ† ìµœê³  ê³¨ë“œ</span>
                        <span class="record-value" id="recordGold">0</span>
                    </div>
                    <div class="record-item">
                        <span>ğŸ‘† ì´ í´ë¦­ ìˆ˜</span>
                        <span class="record-value" id="recordClicks">0</span>
                    </div>
                    <div class="record-item">
                        <span>ğŸ’° ì´ íšë“ ê³¨ë“œ</span>
                        <span class="record-value" id="recordTotalGold">0</span>
                    </div>
                    <div class="record-item">
                        <span>ğŸ’ ì´ íšë“ ë³´ì„</span>
                        <span class="record-value" id="recordGems">0</span>
                    </div>
                    <div class="record-item">
                        <span>ğŸ”„ í™˜ìƒ íšŸìˆ˜</span>
                        <span class="record-value" id="recordPrestige">0</span>
                    </div>
                    <div class="record-item">
                        <span>ğŸ¯ ë‹¬ì„± ì—…ì </span>
                        <span class="record-value" id="recordAchievements">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="prestige" class="panel">
            <div class="prestige-area">
                <div class="prestige-info">
                    <h2>ğŸ’ í™˜ìƒ ì‹œìŠ¤í…œ</h2>
                    <p>ëª¨ë“  ê³¨ë“œì™€ ì‹œì„¤ì„ ì´ˆê¸°í™”í•˜ê³ <br>ì˜êµ¬ ë³´ë„ˆìŠ¤ë¥¼ ì–»ìœ¼ì„¸ìš”!</p>
                    <div class="prestige-gems">
                        íšë“ ì˜ˆì •: <span id="prestigeGain">0</span> ğŸ’
                    </div>
                    <p style="color: #aaa;">í˜„ì¬ ë³´ë„ˆìŠ¤: <span id="prestigeBonus">0</span>% ì¶”ê°€ ê³¨ë“œ</p>
                    <button class="prestige-btn" id="prestigeBtn" disabled onclick="doPrestige()">í™˜ìƒí•˜ê¸°</button>
                    <p style="color: #888; margin-top: 15px;" id="prestigeReq">1,000,000 ê³¨ë“œ í•„ìš”</p>
                </div>
            </div>
        </div>

        <div id="settings" class="panel">
            <div class="settings-area">
                <div class="setting-item">
                    <span>ğŸ”Š ì‚¬ìš´ë“œ</span>
                    <button class="setting-btn" id="soundToggle" onclick="toggleSound()">ON</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ’¾ ìˆ˜ë™ ì €ì¥</span>
                    <button class="setting-btn" onclick="saveGame()">ì €ì¥í•˜ê¸°</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ—‘ï¸ ê²Œì„ ì´ˆê¸°í™”</span>
                    <button class="setting-btn danger" onclick="resetGame()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GAME STATE ====================
        let gameState = {
            gold: 0,
            totalGold: 0,
            totalClicks: 0,
            clickPower: 1,
            perSecond: 0,
            gems: 0,
            totalGems: 0,
            prestigeCount: 0,
            generators: {},
            upgrades: {},
            achievements: {},
            lastSave: Date.now(),
            startTime: Date.now(),
            sessionStart: Date.now(),
            lastSpinTime: 0,
            highestGold: 0,
            darkMode: true,
            soundEnabled: true
        };

        let buyAmount = 1;
        let globalMultiplier = 1;
        let generatorMultipliers = {};
        let buffActive = false;
        let buffEndTime = 0;
        let goldHistory = [];

        // ==================== GAME DATA ====================
        const generators = [
            { id: 'cursor', name: 'ìë™ ì»¤ì„œ', icon: 'ğŸ‘†', basePrice: 15, baseProduction: 0.1 },
            { id: 'miner', name: 'ê´‘ë¶€', icon: 'â›ï¸', basePrice: 100, baseProduction: 1 },
            { id: 'mine', name: 'ê¸ˆê´‘', icon: 'ğŸ”ï¸', basePrice: 1100, baseProduction: 8 },
            { id: 'factory', name: 'ê³µì¥', icon: 'ğŸ­', basePrice: 12000, baseProduction: 47 },
            { id: 'bank', name: 'ì€í–‰', icon: 'ğŸ¦', basePrice: 130000, baseProduction: 260 },
            { id: 'temple', name: 'í™©ê¸ˆ ì‚¬ì›', icon: 'ğŸ›•', basePrice: 1400000, baseProduction: 1400 },
            { id: 'wizard', name: 'ì—°ê¸ˆìˆ ì‚¬', icon: 'ğŸ§™', basePrice: 20000000, baseProduction: 7800 },
            { id: 'portal', name: 'ì°¨ì›ë¬¸', icon: 'ğŸŒ€', basePrice: 330000000, baseProduction: 44000 },
            { id: 'timemachine', name: 'íƒ€ì„ë¨¸ì‹ ', icon: 'â°', basePrice: 5100000000, baseProduction: 260000 }
        ];

        const upgrades = [
            { id: 'click1', name: 'ê°•í™”ëœ ì†ê°€ë½', icon: 'ğŸ‘†', price: 100, desc: 'í´ë¦­ë‹¹ +1', effect: () => gameState.clickPower += 1 },
            { id: 'click2', name: 'í™©ê¸ˆ ì†ê°€ë½', icon: 'âœ¨', price: 500, desc: 'í´ë¦­ë‹¹ +5', effect: () => gameState.clickPower += 5 },
            { id: 'click3', name: 'ë‹¤ì´ì•„ëª¬ë“œ ì†ê°€ë½', icon: 'ğŸ’', price: 10000, desc: 'í´ë¦­ë‹¹ +50', effect: () => gameState.clickPower += 50 },
            { id: 'cursor1', name: 'ì»¤ì„œ ì—…ê·¸ë ˆì´ë“œ', icon: 'ğŸ–±ï¸', price: 100, desc: 'ì»¤ì„œ íš¨ìœ¨ 2ë°°', requires: 'cursor', multiplier: 2 },
            { id: 'miner1', name: 'ë” ì¢‹ì€ ê³¡ê´­ì´', icon: 'â›ï¸', price: 1000, desc: 'ê´‘ë¶€ íš¨ìœ¨ 2ë°°', requires: 'miner', multiplier: 2 },
            { id: 'mine1', name: 'ê¹Šì€ êµ´ì°©', icon: 'ğŸ•³ï¸', price: 11000, desc: 'ê¸ˆê´‘ íš¨ìœ¨ 2ë°°', requires: 'mine', multiplier: 2 },
            { id: 'factory1', name: 'ìë™í™”', icon: 'ğŸ¤–', price: 120000, desc: 'ê³µì¥ íš¨ìœ¨ 2ë°°', requires: 'factory', multiplier: 2 },
            { id: 'bank1', name: 'ë³µë¦¬ ì´ì', icon: 'ğŸ“ˆ', price: 1300000, desc: 'ì€í–‰ íš¨ìœ¨ 2ë°°', requires: 'bank', multiplier: 2 },
            { id: 'global1', name: 'í™©ê¸ˆ ì¶•ë³µ', icon: 'ğŸŒŸ', price: 10000000, desc: 'ëª¨ë“  ìƒì‚°ëŸ‰ +50%', globalMultiplier: 1.5 },
            { id: 'click4', name: 'ë¯¸ë‹¤ìŠ¤ì˜ ì†', icon: 'ğŸ‘‘', price: 100000000, desc: 'í´ë¦­ë‹¹ +500', effect: () => gameState.clickPower += 500 },
            { id: 'global2', name: 'ê³¨ë“œ í”¼ë²„', icon: 'ğŸ”¥', price: 1000000000, desc: 'ëª¨ë“  ìƒì‚°ëŸ‰ 2ë°°', globalMultiplier: 2 }
        ];

        const achievements = [
            { id: 'click10', name: 'ì´ˆë³´ í´ë¦¬ì»¤', icon: 'ğŸ‘†', desc: '10ë²ˆ í´ë¦­í•˜ê¸°', condition: () => gameState.totalClicks >= 10, reward: 10 },
            { id: 'click100', name: 'ì—´ì • í´ë¦¬ì»¤', icon: 'ğŸ”¥', desc: '100ë²ˆ í´ë¦­í•˜ê¸°', condition: () => gameState.totalClicks >= 100, reward: 50 },
            { id: 'click1000', name: 'í´ë¦­ ë§ˆìŠ¤í„°', icon: 'âš¡', desc: '1,000ë²ˆ í´ë¦­í•˜ê¸°', condition: () => gameState.totalClicks >= 1000, reward: 200 },
            { id: 'gold100', name: 'ë™ì „ ìˆ˜ì§‘ê°€', icon: 'ğŸª™', desc: '100 ê³¨ë“œ ëª¨ìœ¼ê¸°', condition: () => gameState.highestGold >= 100, reward: 20 },
            { id: 'gold10000', name: 'ë¶€ìì˜ ì‹œì‘', icon: 'ğŸ’°', desc: '10,000 ê³¨ë“œ ëª¨ìœ¼ê¸°', condition: () => gameState.highestGold >= 10000, reward: 100 },
            { id: 'gold1m', name: 'ë°±ë§Œì¥ì', icon: 'ğŸ’', desc: '1,000,000 ê³¨ë“œ ëª¨ìœ¼ê¸°', condition: () => gameState.highestGold >= 1000000, reward: 1000 },
            { id: 'gold1b', name: 'ì–µë§Œì¥ì', icon: 'ğŸ‘‘', desc: '1,000,000,000 ê³¨ë“œ ëª¨ìœ¼ê¸°', condition: () => gameState.highestGold >= 1000000000, reward: 10000 },
            { id: 'prestige1', name: 'í™˜ìƒì', icon: 'ğŸ”„', desc: 'ì²« í™˜ìƒí•˜ê¸°', condition: () => gameState.prestigeCount >= 1, reward: 500 },
            { id: 'prestige5', name: 'ìœ¤íšŒì˜ ë‹¬ì¸', icon: 'ğŸŒ€', desc: '5ë²ˆ í™˜ìƒí•˜ê¸°', condition: () => gameState.prestigeCount >= 5, reward: 2000 },
            { id: 'gen10', name: 'ì‚°ì—…í˜ëª…', icon: 'ğŸ­', desc: 'ìƒì‚°ì‹œì„¤ 10ê°œ ë³´ìœ ', condition: () => Object.values(gameState.generators).reduce((a,b) => a+b, 0) >= 10, reward: 100 },
            { id: 'gen100', name: 'ì‚°ì—…ì™•', icon: 'ğŸ°', desc: 'ìƒì‚°ì‹œì„¤ 100ê°œ ë³´ìœ ', condition: () => Object.values(gameState.generators).reduce((a,b) => a+b, 0) >= 100, reward: 1000 }
        ];

        const spinRewards = [
            { type: 'gold', multiplier: 10, label: 'ê³¨ë“œ x10', color: '#ffd700' },
            { type: 'gold', multiplier: 50, label: 'ê³¨ë“œ x50', color: '#ffd700' },
            { type: 'gold', multiplier: 100, label: 'ê³¨ë“œ x100', color: '#ffd700' },
            { type: 'buff', duration: 30, label: '30ì´ˆ 2ë°°', color: '#ff6b6b' },
            { type: 'buff', duration: 60, label: '60ì´ˆ 2ë°°', color: '#ff6b6b' },
            { type: 'clickPower', amount: 5, label: 'í´ë¦­+5', color: '#6bcb77' },
            { type: 'clickPower', amount: 20, label: 'í´ë¦­+20', color: '#6bcb77' },
            { type: 'gems', amount: 1, label: 'ë³´ì„+1', color: '#da70d6' }
        ];

        // ==================== AUDIO ====================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function playSound(type) {
            if (!gameState.soundEnabled) return;
            if (!audioCtx) audioCtx = new AudioContext();

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const sounds = {
                click: { freq: 800, duration: 0.05 },
                buy: { freq: 600, duration: 0.1 },
                achievement: { freq: 1000, duration: 0.2 },
                spin: { freq: 400, duration: 0.3 },
                bonus: { freq: 1200, duration: 0.15 }
            };

            const sound = sounds[type] || sounds.click;
            oscillator.frequency.setValueAtTime(sound.freq, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + sound.duration);

            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + sound.duration);
        }

        // ==================== UTILITIES ====================
        function formatNumber(num) {
            if (num < 1) return num.toFixed(1);
            if (num < 1000) return Math.floor(num).toLocaleString();

            const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc'];
            const tier = Math.floor(Math.log10(Math.abs(num)) / 3);

            if (tier >= suffixes.length) return num.toExponential(2);

            const suffix = suffixes[tier];
            const scale = Math.pow(10, tier * 3);
            const scaled = num / scale;

            return scaled.toFixed(scaled < 10 ? 2 : 1) + suffix;
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // ==================== PARTICLES ====================
        function createParticles(x, y, count = 5) {
            const emojis = ['âœ¨', 'â­', 'ğŸ’«', 'ğŸŒŸ'];
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';

                const angle = (Math.random() * 360) * (Math.PI / 180);
                const velocity = 50 + Math.random() * 100;
                const dx = Math.cos(angle) * velocity;
                const dy = Math.sin(angle) * velocity;

                document.body.appendChild(particle);

                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${dx}px, ${dy}px) scale(0)`, opacity: 0 }
                ], { duration: 1000, easing: 'ease-out' });

                setTimeout(() => particle.remove(), 1000);
            }
        }

        // ==================== GOLDEN COIN ====================
        let goldenCoinTimeout = null;

        function spawnGoldenCoin() {
            if (document.querySelector('.golden-coin')) return;

            const coin = document.createElement('div');
            coin.className = 'golden-coin';
            coin.textContent = 'ğŸŒŸ';
            coin.style.left = (Math.random() * (window.innerWidth - 100) + 50) + 'px';
            coin.style.top = (Math.random() * (window.innerHeight - 200) + 100) + 'px';

            coin.onclick = () => {
                const bonus = Math.max(gameState.perSecond * 30, gameState.clickPower * 100);
                gameState.gold += bonus;
                gameState.totalGold += bonus;

                playSound('bonus');
                createParticles(parseFloat(coin.style.left), parseFloat(coin.style.top), 15);

                showBuffPopup(`+${formatNumber(bonus)} ê³¨ë“œ!`);
                coin.remove();
                scheduleGoldenCoin();
            };

            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 10000);
        }

        function scheduleGoldenCoin() {
            const delay = 30000 + Math.random() * 60000; // 30-90ì´ˆ
            goldenCoinTimeout = setTimeout(spawnGoldenCoin, delay);
        }

        // ==================== BUFF SYSTEM ====================
        function activateBuff(duration) {
            buffActive = true;
            buffEndTime = Date.now() + duration * 1000;
            document.getElementById('buffIndicator').classList.add('active');
            showBuffPopup(`ğŸ”¥ ${duration}ì´ˆ 2ë°° ë²„í”„!`);
            playSound('bonus');
        }

        function showBuffPopup(text) {
            const popup = document.createElement('div');
            popup.className = 'buff-popup';
            popup.textContent = text;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2000);
        }

        // ==================== CALCULATIONS ====================
        function getGeneratorPrice(gen, amount = 1) {
            const owned = gameState.generators[gen.id] || 0;
            let total = 0;
            for (let i = 0; i < amount; i++) {
                total += Math.floor(gen.basePrice * Math.pow(1.15, owned + i));
            }
            return total;
        }

        function getMaxAffordable(gen) {
            const owned = gameState.generators[gen.id] || 0;
            let count = 0, total = 0;
            while (total + Math.floor(gen.basePrice * Math.pow(1.15, owned + count)) <= gameState.gold) {
                total += Math.floor(gen.basePrice * Math.pow(1.15, owned + count));
                count++;
                if (count > 1000) break;
            }
            return count;
        }

        function getActualBuyAmount(gen) {
            if (buyAmount === 'max') return getMaxAffordable(gen);
            return Math.min(buyAmount, getMaxAffordable(gen));
        }

        function calculateProduction() {
            let total = 0;
            generators.forEach(gen => {
                const owned = gameState.generators[gen.id] || 0;
                const multiplier = generatorMultipliers[gen.id] || 1;
                total += owned * gen.baseProduction * multiplier * globalMultiplier;
            });

            const prestigeBonus = 1 + (gameState.gems * 0.01);
            total *= prestigeBonus;

            if (buffActive) total *= 2;

            return total;
        }

        function calculatePrestigeGain() {
            if (gameState.totalGold < 1000000) return 0;
            return Math.floor(Math.sqrt(gameState.totalGold / 1000000));
        }

        // ==================== GAME ACTIONS ====================
        function handleClick(e) {
            const prestigeBonus = 1 + (gameState.gems * 0.01);
            let earned = gameState.clickPower * prestigeBonus;
            if (buffActive) earned *= 2;

            gameState.gold += earned;
            gameState.totalGold += earned;
            gameState.totalClicks++;

            if (gameState.gold > gameState.highestGold) {
                gameState.highestGold = gameState.gold;
            }

            playSound('click');

            const x = e.clientX || e.touches?.[0]?.clientX || window.innerWidth/2;
            const y = e.clientY || e.touches?.[0]?.clientY || window.innerHeight/2;

            // Floating text
            const text = document.createElement('div');
            text.className = 'click-text';
            text.textContent = '+' + formatNumber(earned);
            text.style.left = x + 'px';
            text.style.top = y + 'px';
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 1000);

            // Particles
            createParticles(x, y, 3);

            checkAchievements();
            updateUI();
        }

        function buyGenerator(genId) {
            const gen = generators.find(g => g.id === genId);
            const amount = getActualBuyAmount(gen);
            if (amount <= 0) return;

            const price = getGeneratorPrice(gen, amount);
            if (gameState.gold >= price) {
                gameState.gold -= price;
                gameState.generators[genId] = (gameState.generators[genId] || 0) + amount;
                gameState.perSecond = calculateProduction();
                playSound('buy');
                checkAchievements();
                fullRender();
                updateUI();
            }
        }

        function buyUpgrade(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            if (gameState.upgrades[upgradeId]) return;
            if (gameState.gold < upgrade.price) return;

            gameState.gold -= upgrade.price;
            gameState.upgrades[upgradeId] = true;

            if (upgrade.effect) upgrade.effect();
            if (upgrade.multiplier && upgrade.requires) {
                generatorMultipliers[upgrade.requires] = (generatorMultipliers[upgrade.requires] || 1) * upgrade.multiplier;
            }
            if (upgrade.globalMultiplier) {
                globalMultiplier *= upgrade.globalMultiplier;
            }

            gameState.perSecond = calculateProduction();
            playSound('buy');
            fullRender();
            updateUI();
        }

        function doPrestige() {
            const gain = calculatePrestigeGain();
            if (gain <= 0) return;
            if (!confirm(`í™˜ìƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${gain}ê°œì˜ ë³´ì„ì„ íšë“í•©ë‹ˆë‹¤.\nëª¨ë“  ê³¨ë“œì™€ ì‹œì„¤ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.`)) return;

            gameState.gems += gain;
            gameState.totalGems += gain;
            gameState.prestigeCount++;
            gameState.gold = 0;
            gameState.totalGold = 0;
            gameState.clickPower = 1;
            gameState.generators = {};
            gameState.upgrades = {};

            globalMultiplier = 1;
            generatorMultipliers = {};

            gameState.perSecond = calculateProduction();
            playSound('achievement');
            checkAchievements();
            fullRender();
            updateUI();
            saveGame();
        }

        // ==================== LUCKY SPIN ====================
        function doSpin() {
            const now = Date.now();
            const cooldown = 5 * 60 * 1000; // 5ë¶„
            if (now - gameState.lastSpinTime < cooldown) return;

            gameState.lastSpinTime = now;
            playSound('spin');

            const wheel = document.getElementById('spinWheel');
            const spins = 5 + Math.floor(Math.random() * 5);
            const extraDegrees = Math.random() * 360;
            const totalRotation = spins * 360 + extraDegrees;

            wheel.style.transform = `rotate(${totalRotation}deg)`;

            setTimeout(() => {
                const rewardIndex = Math.floor((360 - (extraDegrees % 360)) / 45) % 8;
                const reward = spinRewards[rewardIndex];

                let resultText = '';
                switch (reward.type) {
                    case 'gold':
                        const goldReward = Math.max(gameState.perSecond, gameState.clickPower) * reward.multiplier;
                        gameState.gold += goldReward;
                        gameState.totalGold += goldReward;
                        resultText = `+${formatNumber(goldReward)} ê³¨ë“œ!`;
                        break;
                    case 'buff':
                        activateBuff(reward.duration);
                        resultText = `${reward.duration}ì´ˆ 2ë°° ë²„í”„!`;
                        break;
                    case 'clickPower':
                        gameState.clickPower += reward.amount;
                        resultText = `í´ë¦­ íŒŒì›Œ +${reward.amount}!`;
                        break;
                    case 'gems':
                        gameState.gems += reward.amount;
                        gameState.totalGems += reward.amount;
                        resultText = `ë³´ì„ +${reward.amount}!`;
                        break;
                }

                document.getElementById('spinResult').textContent = resultText;
                document.getElementById('spinResultPopup').classList.remove('hidden');
                playSound('achievement');
                updateUI();
            }, 3000);
        }

        function closeSpinPopup() {
            document.getElementById('spinResultPopup').classList.add('hidden');
        }

        // ==================== ACHIEVEMENTS ====================
        function checkAchievements() {
            let newAchievement = false;
            achievements.forEach(ach => {
                if (!gameState.achievements[ach.id] && ach.condition()) {
                    gameState.achievements[ach.id] = true;
                    gameState.gold += ach.reward;
                    gameState.totalGold += ach.reward;
                    newAchievement = true;
                    showBuffPopup(`ğŸ¯ ${ach.name} ë‹¬ì„±! +${ach.reward}`);
                    playSound('achievement');
                }
            });
            if (newAchievement) renderAchievements();
        }

        // ==================== THEME ====================
        function toggleTheme() {
            gameState.darkMode = !gameState.darkMode;
            document.body.classList.toggle('light-mode', !gameState.darkMode);
            document.getElementById('themeToggle').textContent = gameState.darkMode ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            document.getElementById('soundToggle').textContent = gameState.soundEnabled ? 'ON' : 'OFF';
        }

        // ==================== CHART ====================
        function updateChart() {
            goldHistory.push(gameState.gold);
            if (goldHistory.length > 60) goldHistory.shift();

            const canvas = document.getElementById('goldChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.parentElement.clientWidth;
            const height = canvas.parentElement.clientHeight;

            canvas.width = width;
            canvas.height = height;

            ctx.clearRect(0, 0, width, height);

            if (goldHistory.length < 2) return;

            const max = Math.max(...goldHistory, 1);
            const step = width / (goldHistory.length - 1);

            ctx.beginPath();
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 2;

            goldHistory.forEach((val, i) => {
                const x = i * step;
                const y = height - (val / max) * (height - 20) - 10;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });

            ctx.stroke();

            // Fill gradient
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, 'rgba(255, 215, 0, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.fill();
        }

        // ==================== RENDERING ====================
        function renderGenerators() {
            const container = document.getElementById('generatorList');
            container.innerHTML = generators.map(gen => {
                const owned = gameState.generators[gen.id] || 0;
                const amount = buyAmount === 'max' ? getMaxAffordable(gen) : buyAmount;
                const price = getGeneratorPrice(gen, amount);
                const canBuy = gameState.gold >= price && amount > 0;
                const multiplier = generatorMultipliers[gen.id] || 1;
                const production = gen.baseProduction * multiplier * globalMultiplier;

                return `
                    <div class="generator-item">
                        <div class="generator-info">
                            <div class="generator-icon">${gen.icon}</div>
                            <div class="generator-details">
                                <h3>${gen.name}</h3>
                                <p>ì´ˆë‹¹ ${formatNumber(production)} ê³¨ë“œ</p>
                                <p class="generator-owned">ë³´ìœ : ${owned}ê°œ</p>
                            </div>
                        </div>
                        <div class="generator-right">
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buyGenerator('${gen.id}')">
                                ${amount > 0 ? `x${amount} - ${formatNumber(price)}` : 'êµ¬ë§¤ ë¶ˆê°€'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderUpgrades() {
            const container = document.getElementById('upgradeList');
            container.innerHTML = upgrades.map(upgrade => {
                const purchased = gameState.upgrades[upgrade.id];
                const canBuy = !purchased && gameState.gold >= upgrade.price;

                return `
                    <div class="upgrade-item ${purchased ? 'purchased' : ''}">
                        <div class="upgrade-info">
                            <div class="upgrade-icon">${upgrade.icon}</div>
                            <div class="generator-details">
                                <h3>${upgrade.name}</h3>
                                <p>${upgrade.desc}</p>
                            </div>
                        </div>
                        <div class="generator-right">
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buyUpgrade('${upgrade.id}')">
                                ${purchased ? 'êµ¬ë§¤ì™„ë£Œ' : formatNumber(upgrade.price)}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAchievements() {
            const container = document.getElementById('achievementList');
            const unlocked = Object.keys(gameState.achievements).length;
            container.innerHTML = achievements.map(ach => {
                const isUnlocked = gameState.achievements[ach.id];
                return `
                    <div class="achievement-item ${isUnlocked ? 'unlocked' : ''}">
                        <div class="generator-info">
                            <div class="achievement-icon">${ach.icon}</div>
                            <div class="generator-details">
                                <h3>${ach.name}</h3>
                                <p>${ach.desc}</p>
                                <p class="achievement-reward">ë³´ìƒ: +${ach.reward} ê³¨ë“œ</p>
                            </div>
                        </div>
                        <div>${isUnlocked ? 'âœ…' : 'ğŸ”’'}</div>
                    </div>
                `;
            }).join('');
        }

        function fullRender() {
            renderGenerators();
            renderUpgrades();
            renderAchievements();
        }

        function updateButtonStates() {
            document.querySelectorAll('#generatorList .buy-btn').forEach((btn, i) => {
                const gen = generators[i];
                if (!gen) return;
                const amount = buyAmount === 'max' ? getMaxAffordable(gen) : buyAmount;
                const price = getGeneratorPrice(gen, amount);
                const canBuy = gameState.gold >= price && amount > 0;
                btn.disabled = !canBuy;
                btn.textContent = amount > 0 ? `x${amount} - ${formatNumber(price)}` : 'êµ¬ë§¤ ë¶ˆê°€';
            });

            document.querySelectorAll('#upgradeList .buy-btn').forEach((btn, i) => {
                const upgrade = upgrades[i];
                if (!upgrade) return;
                const purchased = gameState.upgrades[upgrade.id];
                const canBuy = !purchased && gameState.gold >= upgrade.price;
                btn.disabled = !canBuy || purchased;
                btn.textContent = purchased ? 'êµ¬ë§¤ì™„ë£Œ' : formatNumber(upgrade.price);
            });
        }

        function updateUI() {
            document.getElementById('goldAmount').textContent = formatNumber(gameState.gold);
            document.getElementById('clickPower').textContent = formatNumber(gameState.clickPower);
            document.getElementById('perSecond').textContent = formatNumber(gameState.perSecond);
            document.getElementById('gems').textContent = formatNumber(gameState.gems);

            // Play time
            const playSeconds = Math.floor((Date.now() - gameState.sessionStart) / 1000);
            document.getElementById('playTime').textContent = formatTime(playSeconds);

            // Buff
            if (buffActive) {
                const remaining = Math.max(0, Math.ceil((buffEndTime - Date.now()) / 1000));
                document.getElementById('buffTimer').textContent = remaining;
                if (remaining <= 0) {
                    buffActive = false;
                    document.getElementById('buffIndicator').classList.remove('active');
                }
            }

            // Prestige
            const gain = calculatePrestigeGain();
            document.getElementById('prestigeGain').textContent = formatNumber(gain);
            document.getElementById('prestigeBonus').textContent = gameState.gems;
            document.getElementById('prestigeBtn').disabled = gain <= 0;
            document.getElementById('prestigeReq').textContent = gain > 0 ? 'í™˜ìƒ ê°€ëŠ¥!' : `${formatNumber(1000000)} ê³¨ë“œ í•„ìš”`;

            // Spin cooldown
            const spinCooldown = 5 * 60 * 1000;
            const spinRemaining = Math.max(0, spinCooldown - (Date.now() - gameState.lastSpinTime));
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.disabled = spinRemaining > 0;
            document.getElementById('spinCooldown').textContent = spinRemaining > 0 ?
                `ë‹¤ìŒ ìŠ¤í•€ê¹Œì§€: ${Math.ceil(spinRemaining / 1000)}ì´ˆ` : 'ìŠ¤í•€ ê°€ëŠ¥!';

            // Records
            document.getElementById('recordGold').textContent = formatNumber(gameState.highestGold);
            document.getElementById('recordClicks').textContent = formatNumber(gameState.totalClicks);
            document.getElementById('recordTotalGold').textContent = formatNumber(gameState.totalGold);
            document.getElementById('recordGems').textContent = formatNumber(gameState.totalGems);
            document.getElementById('recordPrestige').textContent = gameState.prestigeCount;
            document.getElementById('recordAchievements').textContent = Object.keys(gameState.achievements).length + '/' + achievements.length;

            updateButtonStates();
        }

        // ==================== GAME LOOP ====================
        let autoAnimationTimer = 0;

        function showAutoEarning(amount) {
            const coinBtn = document.getElementById('coinBtn');
            const rect = coinBtn.getBoundingClientRect();

            const text = document.createElement('div');
            text.className = 'click-text';
            text.textContent = '+' + formatNumber(amount);
            text.style.left = (rect.left + rect.width/2 + (Math.random()-0.5)*60) + 'px';
            text.style.top = (rect.top + rect.height/2 + (Math.random()-0.5)*40) + 'px';
            text.style.fontSize = '18px';
            text.style.color = '#90EE90';
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 1000);
        }

        function gameLoop() {
            gameState.perSecond = calculateProduction();

            if (gameState.perSecond > 0) {
                const earned = gameState.perSecond / 10;
                gameState.gold += earned;
                gameState.totalGold += earned;

                if (gameState.gold > gameState.highestGold) {
                    gameState.highestGold = gameState.gold;
                }

                autoAnimationTimer += 100;
                if (autoAnimationTimer >= 500) {
                    showAutoEarning(gameState.perSecond / 2);
                    autoAnimationTimer = 0;
                }
            }

            checkAchievements();
            updateUI();
        }

        // ==================== SAVE/LOAD ====================
        function saveGame() {
            gameState.lastSave = Date.now();
            localStorage.setItem('goldRushClicker', JSON.stringify(gameState));
            localStorage.setItem('goldRushMultipliers', JSON.stringify({
                global: globalMultiplier,
                generators: generatorMultipliers
            }));
        }

        function loadGame() {
            const saved = localStorage.getItem('goldRushClicker');
            const multipliers = localStorage.getItem('goldRushMultipliers');

            if (saved) {
                const loaded = JSON.parse(saved);
                gameState = { ...gameState, ...loaded };
                gameState.sessionStart = Date.now();

                if (multipliers) {
                    const m = JSON.parse(multipliers);
                    globalMultiplier = m.global || 1;
                    generatorMultipliers = m.generators || {};
                }

                // Theme
                document.body.classList.toggle('light-mode', !gameState.darkMode);
                document.getElementById('themeToggle').textContent = gameState.darkMode ? 'ğŸŒ™' : 'â˜€ï¸';
                document.getElementById('soundToggle').textContent = gameState.soundEnabled ? 'ON' : 'OFF';

                // Offline earnings
                const now = Date.now();
                const elapsed = (now - gameState.lastSave) / 1000;

                if (elapsed > 60 && gameState.perSecond > 0) {
                    const maxOfflineTime = 8 * 60 * 60;
                    const offlineTime = Math.min(elapsed, maxOfflineTime);
                    const offlineEarnings = gameState.perSecond * offlineTime * 0.5;

                    document.getElementById('offlineTime').textContent =
                        `${Math.floor(offlineTime/3600)}ì‹œê°„ ${Math.floor((offlineTime%3600)/60)}ë¶„ ë™ì•ˆ`;
                    document.getElementById('offlineEarnings').textContent = '+' + formatNumber(offlineEarnings);
                    document.getElementById('offlinePopup').classList.remove('hidden');

                    gameState.gold += offlineEarnings;
                    gameState.totalGold += offlineEarnings;
                }

                gameState.perSecond = calculateProduction();
            }
        }

        function closeOfflinePopup() {
            document.getElementById('offlinePopup').classList.add('hidden');
        }

        function resetGame() {
            if (!confirm('ì •ë§ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤!')) return;
            localStorage.removeItem('goldRushClicker');
            localStorage.removeItem('goldRushMultipliers');
            location.reload();
        }

        // ==================== INITIALIZATION ====================
        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Buy amount
        document.querySelectorAll('.amount-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                buyAmount = btn.dataset.amount === 'max' ? 'max' : parseInt(btn.dataset.amount);
                fullRender();
                updateUI();
            });
        });

        // Click handlers
        document.getElementById('coinBtn').addEventListener('click', handleClick);
        document.getElementById('coinBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick(e);
        });

        // Load and start
        loadGame();
        gameState.perSecond = calculateProduction();
        fullRender();
        updateUI();
        scheduleGoldenCoin();

        // Game loops
        setInterval(gameLoop, 100);
        setInterval(saveGame, 30000);
        setInterval(updateChart, 1000);
    </script>
</body>
</html>
