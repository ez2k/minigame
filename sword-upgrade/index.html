<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Í≤Ä Í∞ïÌôî ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ - Î©ÄÌã∞ÌîåÎ†àÏù¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

```
    html, body {
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
    }
    
    body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
        color: white;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }
    
    /* ÏãúÏûë ÌôîÎ©¥ */
    #startScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.95);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    #startScreen h1 {
        font-size: 3rem;
        color: #ffd700;
        margin-bottom: 10px;
        text-shadow: 0 0 30px rgba(255,215,0,0.5);
    }
    
    #startScreen .subtitle {
        color: #888;
        margin-bottom: 40px;
        font-size: 1.1rem;
    }
    
    #startScreen input {
        padding: 15px 30px;
        font-size: 1.2rem;
        border: 2px solid #ffd700;
        border-radius: 10px;
        background: rgba(255,255,255,0.1);
        color: white;
        text-align: center;
        width: 300px;
        margin-bottom: 20px;
    }
    
    #startScreen input:focus {
        outline: none;
        background: rgba(255,255,255,0.15);
    }
    
    #startScreen button {
        padding: 15px 50px;
        font-size: 1.3rem;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        border: none;
        border-radius: 10px;
        color: #1a1a2e;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    #startScreen button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(255,215,0,0.5);
    }
    
    @media (max-width: 600px) {
        #startScreen h1 {
            font-size: 1.8rem;
        }
        
        #startScreen .subtitle {
            font-size: 0.85rem;
            padding: 0 20px;
            text-align: center;
        }
        
        #startScreen input {
            width: 80%;
            max-width: 250px;
            padding: 12px 20px;
            font-size: 1rem;
        }
        
        #startScreen button {
            padding: 12px 40px;
            font-size: 1.1rem;
        }
    }
    
    /* Ìó§Îçî */
    .header {
        background: rgba(0,0,0,0.5);
        padding: 8px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .header h1 {
        font-size: 1.1rem;
        color: #ffd700;
    }
    
    .header-stats {
        display: flex;
        gap: 20px;
        align-items: center;
    }
    
    .header-stat {
        text-align: center;
    }
    
    .header-stat .label {
        font-size: 0.65rem;
        color: #888;
    }
    
    .header-stat .value {
        font-size: 0.95rem;
        font-weight: bold;
        color: #ffd700;
    }
    
    .online-count {
        background: rgba(78,205,196,0.2);
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.75rem;
    }
    
    .online-count span {
        color: #4ecdc4;
        font-weight: bold;
    }
    
    /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ */
    .main-container {
        display: flex;
        height: calc(100vh - 45px);
        flex-wrap: wrap;
    }
    
    /* ÏôºÏ™Ω: Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§ */
    .players-panel {
        width: 240px;
        min-width: 240px;
        background: rgba(0,0,0,0.3);
        border-right: 1px solid rgba(255,255,255,0.1);
        overflow-y: auto;
        padding: 10px;
    }
    
    .players-title {
        font-size: 0.85rem;
        color: #ffd700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .player-card {
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 6px;
        transition: all 0.3s;
        border: 1px solid transparent;
    }
    
    .player-card:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .player-card.upgrading {
        border-color: #ffd700;
        animation: pulse 0.5s infinite;
    }
    
    .player-card.success {
        border-color: #4ecdc4;
        background: rgba(78,205,196,0.1);
    }
    
    .player-card.fail {
        border-color: #ffa502;
        background: rgba(255,165,2,0.1);
    }
    
    .player-card.destroy {
        border-color: #ff6b6b;
        background: rgba(255,107,107,0.1);
    }
    
    @keyframes pulse {
        0%, 100% { box-shadow: 0 0 5px rgba(255,215,0,0.3); }
        50% { box-shadow: 0 0 20px rgba(255,215,0,0.6); }
    }
    
    .player-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
    }
    
    .player-name {
        font-weight: bold;
        font-size: 0.8rem;
    }
    
    .player-level {
        color: #ffd700;
        font-weight: bold;
        font-size: 0.8rem;
    }
    
    .player-sword {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.7rem;
        color: #aaa;
    }
    
    .player-sword-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
    }
    
    .player-status {
        font-size: 0.65rem;
        margin-top: 3px;
        min-height: 14px;
    }
    
    /* Ï§ëÏïô: ÎÇ¥ Í∞ïÌôî */
    .upgrade-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        overflow-y: auto;
    }
    
    .my-sword-display {
        text-align: center;
        margin-bottom: 15px;
    }
    
    .sword-visual {
        width: 80px;
        height: 80px;
        margin: 0 auto 5px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .sword-visual.shaking {
        animation: shake 0.1s infinite;
    }
    
    .sword-visual.success {
        animation: successPop 0.6s ease-out;
    }
    
    .sword-visual.fail {
        animation: failShake 0.4s ease-out;
    }
    
    .sword-visual.destroy {
        animation: explode 0.8s ease-out forwards;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0) rotate(0); }
        25% { transform: translateX(-3px) rotate(-1deg); }
        75% { transform: translateX(3px) rotate(1deg); }
    }
    
    @keyframes successPop {
        0% { transform: scale(1); filter: drop-shadow(0 0 20px rgba(255,215,0,0.3)); }
        50% { transform: scale(1.3); filter: drop-shadow(0 0 50px rgba(78,205,196,1)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 20px rgba(255,215,0,0.3)); }
    }
    
    @keyframes failShake {
        0%, 100% { transform: translateX(0); }
        20% { transform: translateX(-15px); }
        40% { transform: translateX(15px); }
        60% { transform: translateX(-10px); }
        80% { transform: translateX(10px); }
    }
    
    @keyframes explode {
        0% { transform: scale(1); opacity: 1; }
        30% { transform: scale(1.5); filter: brightness(2) hue-rotate(30deg); }
        100% { transform: scale(0); opacity: 0; }
    }
    
    .sword-name {
        font-size: 1rem;
        color: #fff;
        margin-bottom: 2px;
    }
    
    .sword-level-display {
        font-size: 2rem;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 0 0 15px rgba(255,215,0,0.5);
    }
    
    .sword-level-display.max-level {
        background: linear-gradient(135deg, #ff6b6b, #ffd700, #4ecdc4, #a55eea);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: rainbow 2s linear infinite;
        background-size: 400% 400%;
    }
    
    @keyframes rainbow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .sword-atk {
        color: #ff6b6b;
        font-size: 0.85rem;
        margin-top: 5px;
    }
    
    /* Í∞ïÌôî Ìå®ÎÑê */
    .upgrade-panel {
        background: rgba(0,0,0,0.4);
        border-radius: 15px;
        padding: 15px;
        width: 100%;
        max-width: 380px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    
    .prob-section {
        margin-bottom: 12px;
    }
    
    .prob-title {
        font-size: 0.75rem;
        color: #888;
        margin-bottom: 6px;
    }
    
    .prob-bar {
        height: 25px;
        background: #222;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        margin-bottom: 6px;
    }
    
    .prob-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: bold;
        transition: width 0.3s;
    }
    
    .prob-segment.success { background: #4ecdc4; color: #1a1a2e; }
    .prob-segment.fail { background: #ffa502; color: #1a1a2e; }
    .prob-segment.down { background: #a55eea; color: white; }
    .prob-segment.destroy { background: #ff6b6b; color: white; }
    
    .prob-legend {
        display: flex;
        justify-content: space-around;
        font-size: 0.65rem;
    }
    
    .prob-legend-item {
        display: flex;
        align-items: center;
        gap: 3px;
    }
    
    .prob-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .cost-section {
        background: rgba(255,215,0,0.1);
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        margin-bottom: 12px;
    }
    
    .cost-label { color: #888; font-size: 0.75rem; }
    .cost-value { color: #ffd700; font-size: 1.3rem; font-weight: bold; }
    
    .options-section {
        margin-bottom: 12px;
    }
    
    .option-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255,255,255,0.05);
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 6px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .option-row:hover { background: rgba(255,255,255,0.1); }
    .option-row.disabled { opacity: 0.4; pointer-events: none; }
    
    .option-left {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .option-left input {
        width: 16px;
        height: 16px;
        accent-color: #ffd700;
    }
    
    .option-name { font-size: 0.8rem; }
    .option-cost { color: #ffd700; font-size: 0.8rem; }
    
    .upgrade-btn {
        width: 100%;
        padding: 12px;
        font-size: 1.1rem;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        color: #1a1a2e;
        transition: all 0.3s;
    }
    
    .upgrade-btn:hover:not(:disabled) {
        transform: scale(1.02);
        box-shadow: 0 0 30px rgba(255,215,0,0.5);
    }
    
    .upgrade-btn:disabled {
        background: #444;
        color: #888;
        cursor: not-allowed;
    }
    
    .new-sword-btn {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        font-size: 0.85rem;
        background: #4ecdc4;
        border: none;
        border-radius: 8px;
        color: #1a1a2e;
        cursor: pointer;
        font-weight: bold;
    }
    
    .new-sword-btn:hover { background: #3dbdb5; }
    
    .sell-section {
        margin-top: 10px;
        background: linear-gradient(135deg, rgba(78,205,196,0.2), rgba(46,204,113,0.2));
        border: 1px solid rgba(78,205,196,0.3);
        border-radius: 10px;
        padding: 10px;
    }
    
    .sell-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .sell-label {
        color: #aaa;
        font-size: 0.75rem;
    }
    
    .sell-price {
        color: #4ecdc4;
        font-size: 1.1rem;
        font-weight: bold;
    }
    
    .sell-btn {
        width: 100%;
        padding: 10px;
        font-size: 0.9rem;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: linear-gradient(135deg, #4ecdc4, #2ecc71);
        color: #1a1a2e;
        transition: all 0.3s;
    }
    
    .sell-btn:hover:not(:disabled) {
        transform: scale(1.02);
        box-shadow: 0 0 25px rgba(78,205,196,0.5);
    }
    
    .sell-btn:disabled {
        background: #444;
        color: #888;
        cursor: not-allowed;
    }
    
    /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
    @media (max-width: 900px) {
        .main-container {
            flex-direction: column;
            height: auto;
            min-height: calc(100vh - 45px);
            width: 100%;
        }
        
        .players-panel {
            display: none;
        }
        
        .upgrade-area {
            width: 100%;
        }
        
        .side-panel {
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
            border-left: none;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-direction: column;
            height: auto;
        }
        
        .leaderboard {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            width: 100% !important;
        }
        
        #leaderboardList {
            display: flex;
            gap: 6px;
            flex: 1;
        }
        
        .leaderboard-item {
            flex: 1;
            text-align: center;
            padding: 4px 8px;
            min-width: 0;
        }
        
        .chat-section {
            width: 100% !important;
        }
        
        .chat-messages {
            width: 100% !important;
        }
        
        .chat-input {
            width: 100% !important;
        }
        
        .upgrade-panel {
            max-width: 100%;
        }
    }
    
    @media (max-width: 600px) {
        .header {
            padding: 8px 12px;
        }
        
        .header h1 {
            font-size: 0.95rem;
        }
        
        .header-stats {
            gap: 12px;
        }
        
        .header-stat .label {
            font-size: 0.6rem;
        }
        
        .header-stat .value {
            font-size: 0.85rem;
        }
        
        .online-count {
            padding: 4px 10px;
            font-size: 0.7rem;
        }
        
        .main-container {
            height: auto;
        }
        
        .upgrade-area {
            padding: 10px 8px;
        }
        
        .my-sword-display {
            margin-bottom: 12px;
        }
        
        .sword-visual {
            font-size: 55px;
            margin-bottom: 3px;
        }
        
        .sword-name {
            font-size: 0.9rem;
        }
        
        .sword-level-display {
            font-size: 1.6rem;
        }
        
        .sword-atk {
            font-size: 0.8rem;
            margin-top: 3px;
        }
        
        .upgrade-panel {
            padding: 12px;
            border-radius: 12px;
        }
        
        .prob-section {
            margin-bottom: 10px;
        }
        
        .prob-title {
            font-size: 0.7rem;
            margin-bottom: 5px;
        }
        
        .prob-bar {
            height: 22px;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        
        .prob-segment {
            font-size: 0.65rem;
        }
        
        .prob-legend {
            font-size: 0.6rem;
        }
        
        .prob-dot {
            width: 7px;
            height: 7px;
        }
        
        .cost-section {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .cost-label {
            font-size: 0.7rem;
        }
        
        .cost-value {
            font-size: 1.15rem;
        }
        
        .options-section {
            margin-bottom: 10px;
        }
        
        .option-row {
            padding: 8px 10px;
            margin-bottom: 5px;
            border-radius: 6px;
        }
        
        .option-left {
            gap: 8px;
        }
        
        .option-left input {
            width: 16px;
            height: 16px;
        }
        
        .option-name {
            font-size: 0.75rem;
        }
        
        .option-cost {
            font-size: 0.75rem;
        }
        
        .upgrade-btn {
            padding: 14px;
            font-size: 1.05rem;
            border-radius: 10px;
        }
        
        .sell-section {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .sell-info {
            margin-bottom: 8px;
        }
        
        .sell-label {
            font-size: 0.7rem;
        }
        
        .sell-price {
            font-size: 1rem;
        }
        
        .sell-btn {
            padding: 10px;
            font-size: 0.85rem;
            border-radius: 8px;
        }
        
        .new-sword-btn {
            padding: 10px;
            margin-top: 10px;
            font-size: 0.8rem;
            border-radius: 8px;
        }
        
        /* Î™®Î∞îÏùº ÏÇ¨Ïù¥Îìú Ìå®ÎÑê - ÌîåÎ°úÌåÖ ÏóÜÏù¥ ÌïòÎã® Î∞∞Ïπò */
        .side-panel {
            flex-direction: column;
            height: auto;
            max-height: none;
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
            position: relative;
            background: rgba(0,0,0,0.5);
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .leaderboard {
            border-right: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 8px 10px;
            max-height: none;
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            width: 100% !important;
        }
        
        .leaderboard-title {
            font-size: 0.75rem;
            margin-bottom: 0;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        #leaderboardList {
            display: flex;
            gap: 6px;
            flex: 1;
        }
        
        .leaderboard-item {
            padding: 4px 8px;
            margin-bottom: 0;
            border-radius: 4px;
            white-space: nowrap;
            flex: 1;
            text-align: center;
            min-width: 0;
        }
        
        .leaderboard-rank {
            width: auto;
            font-size: 0.7rem;
            margin-right: 4px;
        }
        
        .leaderboard-info {
            display: inline;
        }
        
        .leaderboard-name {
            font-size: 0.65rem;
            display: inline;
        }
        
        .leaderboard-level {
            font-size: 0.7rem;
            display: inline;
            margin-left: 3px;
        }
        
        .chat-section {
            padding: 8px 10px;
            height: auto;
            width: 100% !important;
        }
        
        .chat-title {
            display: none;
        }
        
        .chat-messages {
            height: 85px;
            max-height: 85px;
            min-height: 85px;
            padding: 6px;
            margin-bottom: 6px;
            border-radius: 6px;
            width: 100% !important;
        }
        
        .chat-msg {
            font-size: 0.65rem;
            margin-bottom: 3px;
            line-height: 1.3;
        }
        
        .chat-input {
            gap: 6px;
            width: 100% !important;
            display: flex;
        }
        
        .chat-input input {
            padding: 10px;
            font-size: 0.8rem;
            border-radius: 6px;
            flex: 1;
            min-width: 0;
        }
        }
        
        .chat-input button {
            padding: 10px 15px;
            font-size: 0.8rem;
            border-radius: 6px;
        }
        
        /* ÌîåÎ°úÌåÖ Ï†úÍ±∞ÌñàÏúºÎØÄÎ°ú Ïó¨Î∞± Î∂àÌïÑÏöî */
        .main-container {
            padding-bottom: 0;
        }
        
        .result-popup {
            padding: 18px 30px;
            font-size: 1.1rem;
            border-radius: 12px;
        }
    }
    
    /* ÏïÑÏ£º ÏûëÏùÄ ÌôîÎ©¥ */
    @media (max-width: 380px) {
        .header h1 {
            font-size: 0.85rem;
        }
        
        .header-stats {
            gap: 8px;
        }
        
        .header-stat .value {
            font-size: 0.75rem;
        }
        
        .sword-visual {
            font-size: 45px;
        }
        
        .sword-level-display {
            font-size: 1.4rem;
        }
        
        .upgrade-btn {
            padding: 12px;
            font-size: 0.95rem;
        }
    }
    
    /* ÌÑ∞Ïπò ÎîîÎ∞îÏù¥Ïä§ ÏµúÏ†ÅÌôî */
    @media (hover: none) {
        .upgrade-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .sell-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .option-row:active {
            background: rgba(255,255,255,0.15);
        }
        
        .new-sword-btn:active {
            transform: scale(0.98);
        }
    }
    
    /* Ïò§Î•∏Ï™Ω: ÏàúÏúÑ & Ï±ÑÌåÖ */
    .side-panel {
        width: 280px;
        min-width: 280px;
        background: rgba(0,0,0,0.3);
        border-left: 1px solid rgba(255,255,255,0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    
    .leaderboard {
        padding: 8px 10px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        gap: 8px;
        overflow-x: auto;
    }
    
    .leaderboard-title {
        font-size: 0.8rem;
        color: #ffd700;
        display: flex;
        align-items: center;
        gap: 5px;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    #leaderboardList {
        display: flex;
        gap: 6px;
        flex: 1;
    }
    
    .leaderboard-item {
        display: flex;
        align-items: center;
        padding: 4px 8px;
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    .leaderboard-item.me {
        background: rgba(78,205,196,0.15);
        border: 1px solid rgba(78,205,196,0.3);
    }
    
    .leaderboard-rank {
        font-weight: bold;
        color: #ffd700;
        font-size: 0.75rem;
        margin-right: 4px;
    }
    
    .leaderboard-rank.gold { color: #ffd700; }
    .leaderboard-rank.silver { color: #c0c0c0; }
    .leaderboard-rank.bronze { color: #cd7f32; }
    
    .leaderboard-info {
        display: inline;
    }
    
    .leaderboard-name { 
        font-size: 0.7rem; 
        display: inline;
    }
    .leaderboard-level { 
        color: #ffd700; 
        font-weight: bold; 
        font-size: 0.75rem; 
        display: inline;
        margin-left: 3px;
    }
    
    .chat-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 10px;
        min-height: 0;
        overflow: hidden;
    }
    
    .chat-title {
        font-size: 0.85rem;
        color: #ffd700;
        margin-bottom: 8px;
        flex-shrink: 0;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 8px;
        min-height: 100px;
        max-height: 200px;
    }
    
    .chat-msg {
        margin-bottom: 4px;
        font-size: 0.7rem;
        word-wrap: break-word;
        line-height: 1.4;
    }
    
    .chat-msg .name {
        font-weight: bold;
        margin-right: 4px;
    }
    
    .chat-msg.system {
        color: #ffd700;
        font-style: italic;
    }
    
    .chat-msg.upgrade-success { color: #4ecdc4; }
    .chat-msg.upgrade-fail { color: #ffa502; }
    .chat-msg.upgrade-destroy { color: #ff6b6b; }
    
    .chat-input {
        display: flex;
        gap: 5px;
        flex-shrink: 0;
    }
    
    .chat-input {
        display: flex;
        gap: 5px;
    }
    
    .chat-input input {
        flex: 1;
        padding: 8px;
        border: none;
        border-radius: 6px;
        background: rgba(255,255,255,0.1);
        color: white;
        font-size: 0.75rem;
    }
    
    .chat-input input:focus { outline: none; background: rgba(255,255,255,0.15); }
    
    .chat-input button {
        padding: 8px 12px;
        background: #ffd700;
        border: none;
        border-radius: 6px;
        color: #1a1a2e;
        font-weight: bold;
        cursor: pointer;
        font-size: 0.75rem;
    }
    
    /* Í≤∞Í≥º ÌåùÏóÖ */
    .result-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px 35px;
        border-radius: 15px;
        font-size: 1.3rem;
        font-weight: bold;
        z-index: 500;
        text-align: center;
        animation: popIn 0.3s ease-out;
    }
    
    .result-popup.success {
        background: linear-gradient(135deg, #4ecdc4, #2ecc71);
        box-shadow: 0 0 50px rgba(78,205,196,0.7);
    }
    
    .result-popup.fail {
        background: linear-gradient(135deg, #ffa502, #e67e22);
        box-shadow: 0 0 50px rgba(255,165,2,0.7);
    }
    
    .result-popup.down {
        background: linear-gradient(135deg, #a55eea, #8e44ad);
        box-shadow: 0 0 50px rgba(165,94,234,0.7);
    }
    
    .result-popup.destroy {
        background: linear-gradient(135deg, #ff6b6b, #c0392b);
        box-shadow: 0 0 50px rgba(255,107,107,0.7);
    }
    
    @keyframes popIn {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        70% { transform: translate(-50%, -50%) scale(1.1); }
        100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    /* ÌååÌã∞ÌÅ¥ */
    .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 400;
    }
    
    .particle {
        position: absolute;
        border-radius: 50%;
        animation: particleFly 1s ease-out forwards;
    }
    
    @keyframes particleFly {
        0% { transform: translate(0, 0) scale(1); opacity: 1; }
        100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }
    
    /* Îì±Í∏â ÏÉâÏÉÅ */
    .grade-S { color: #ff6b6b; }
    .grade-A { color: #a55eea; }
    .grade-B { color: #4ecdc4; }
    .grade-C { color: #ffd700; }
    .grade-D { color: #aaa; }
</style>
```

</head>
<body>
    <!-- ÏãúÏûë ÌôîÎ©¥ -->
    <div id="startScreen">
        <h1>‚öîÔ∏è Í≤Ä Í∞ïÌôî ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</h1>
        <p class="subtitle">Í≤ÄÏùÑ Í∞ïÌôîÌïòÍ≥† ÌåêÎß§Ìï¥ÏÑú Î∂ÄÏûêÍ∞Ä ÎêòÏûê! üí∞</p>
        <input type="text" id="nameInput" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•" maxlength="10">
        <button onclick="startGame()">Í≤åÏûÑ ÏãúÏûë</button>
    </div>

```
<!-- Î©îÏù∏ Í≤åÏûÑ -->
<div id="gameScreen" style="display: none;">
    <div class="header">
        <h1>‚öîÔ∏è Í≤Ä Í∞ïÌôî ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</h1>
        <div class="header-stats">
            <div class="header-stat">
                <div class="label">Î≥¥Ïú† Í≥®Îìú</div>
                <div class="value" id="headerGold">50,000</div>
            </div>
            <div class="header-stat">
                <div class="label">Ï¥ù ÌåêÎß§ ÏàòÏùµ</div>
                <div class="value" id="headerSold" style="color: #4ecdc4;">0</div>
            </div>
            <div class="header-stat">
                <div class="label">ÏµúÍ≥† Í∏∞Î°ù</div>
                <div class="value" id="headerMax">+0</div>
            </div>
            <div class="online-count">
                Ï†ëÏÜçÏûê <span id="onlineCount">1</span>Î™Ö
            </div>
        </div>
    </div>
    
    <div class="main-container">
        <!-- ÏôºÏ™Ω: Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§ -->
        <div class="players-panel">
            <div class="players-title">üë• Ï†ëÏÜç Ï§ëÏù∏ ÌîåÎ†àÏù¥Ïñ¥</div>
            <div id="playersList"></div>
        </div>
        
        <!-- Ï§ëÏïô: ÎÇ¥ Í∞ïÌôî -->
        <div class="upgrade-area">
            <div class="my-sword-display">
                <div class="sword-visual" id="mySword">üó°Ô∏è</div>
                <div class="sword-name" id="mySwordName">Ï¥àÎ≥¥ÏûêÏùò Í≤Ä</div>
                <div class="sword-level-display" id="mySwordLevel">+0</div>
                <div class="sword-atk">Í≥µÍ≤©Î†•: <span id="mySwordAtk">100</span></div>
            </div>
            
            <div class="upgrade-panel">
                <div class="prob-section">
                    <div class="prob-title">Í∞ïÌôî ÌôïÎ•†</div>
                    <div class="prob-bar" id="probBar">
                        <div class="prob-segment success" style="width: 95%">95%</div>
                        <div class="prob-segment fail" style="width: 5%">5%</div>
                    </div>
                    <div class="prob-legend">
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #4ecdc4"></div>
                            <span>ÏÑ±Í≥µ</span>
                        </div>
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #ffa502"></div>
                            <span>Ïã§Ìå®</span>
                        </div>
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #a55eea"></div>
                            <span>ÌïòÎùΩ</span>
                        </div>
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #ff6b6b"></div>
                            <span>ÌååÍ¥¥</span>
                        </div>
                    </div>
                </div>
                
                <div class="cost-section">
                    <div class="cost-label">Í∞ïÌôî ÎπÑÏö©</div>
                    <div class="cost-value" id="upgradeCost">üí∞ 1,000</div>
                </div>
                
                <div class="options-section">
                    <div class="option-row" id="safeRow" onclick="toggleCheck('safeCheck')">
                        <div class="option-left">
                            <input type="checkbox" id="safeCheck" onclick="event.stopPropagation()">
                            <span class="option-name">üõ°Ô∏è ÌååÍ¥¥ Î∞©ÏßÄ</span>
                        </div>
                        <span class="option-cost" id="safeCost">+500</span>
                    </div>
                    <div class="option-row" id="catchRow" onclick="toggleCheck('catchCheck')">
                        <div class="option-left">
                            <input type="checkbox" id="catchCheck" onclick="event.stopPropagation()">
                            <span class="option-name">ü™§ ÌïòÎùΩ Î∞©ÏßÄ</span>
                        </div>
                        <span class="option-cost" id="catchCost">+300</span>
                    </div>
                </div>
                
                <button class="upgrade-btn" id="upgradeBtn" onclick="upgrade()">
                    ‚öíÔ∏è Í∞ïÌôîÌïòÍ∏∞
                </button>
                
                <div class="sell-section">
                    <div class="sell-info">
                        <span class="sell-label">ÌåêÎß§ Í∞ÄÍ≤©</span>
                        <span class="sell-price" id="sellPrice">üí∞ 0</span>
                    </div>
                    <button class="sell-btn" id="sellBtn" onclick="sellSword()">
                        üíé Í≤Ä ÌåêÎß§ÌïòÍ∏∞
                    </button>
                </div>
                
                <button class="new-sword-btn" onclick="newSword()">
                    üó°Ô∏è ÏÉà Í≤Ä Íµ¨Îß§ (1,000G)
                </button>
            </div>
        </div>
        
        <!-- Ïò§Î•∏Ï™Ω: ÏàúÏúÑ & Ï±ÑÌåÖ -->
        <div class="side-panel">
            <div class="leaderboard">
                <div class="leaderboard-title">üèÜ Ïã§ÏãúÍ∞Ñ ÏàúÏúÑ</div>
                <div id="leaderboardList"></div>
            </div>
            
            <div class="chat-section">
                <div class="chat-title">üí¨ Ï±ÑÌåÖ</div>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Î©îÏãúÏßÄ ÏûÖÎ†•..." maxlength="100">
                    <button onclick="sendChat()">Ï†ÑÏÜ°</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="particles" id="particles"></div>

<script>
    // Í≤åÏûÑ ÏÉÅÌÉú
    let myId = null;
    let myName = '';
    let players = {};
    let myState = {
        level: 0,
        gold: 50000,  // ÏãúÏûë Í≥®Îìú ÎäòÎ¶º
        maxLevel: 0,
        destroyed: false,
        upgrading: false,
        totalSold: 0,
        swordsSold: 0
    };
    
    // ÌôïÎ•† ÌÖåÏù¥Î∏î (Ïâ¨Ïö¥ Î≤ÑÏ†Ñ)
    const probTable = [
        { success: 100, fail: 0, down: 0, destroy: 0 },   // +0 ‚Üí +1 (100%)
        { success: 100, fail: 0, down: 0, destroy: 0 },   // +1 ‚Üí +2 (100%)
        { success: 95, fail: 5, down: 0, destroy: 0 },    // +2 ‚Üí +3
        { success: 95, fail: 5, down: 0, destroy: 0 },    // +3 ‚Üí +4
        { success: 90, fail: 10, down: 0, destroy: 0 },   // +4 ‚Üí +5
        { success: 85, fail: 15, down: 0, destroy: 0 },   // +5 ‚Üí +6
        { success: 80, fail: 20, down: 0, destroy: 0 },   // +6 ‚Üí +7
        { success: 75, fail: 25, down: 0, destroy: 0 },   // +7 ‚Üí +8
        { success: 70, fail: 25, down: 5, destroy: 0 },   // +8 ‚Üí +9
        { success: 65, fail: 25, down: 10, destroy: 0 },  // +9 ‚Üí +10
        { success: 60, fail: 25, down: 13, destroy: 2 },  // +10 ‚Üí +11
        { success: 55, fail: 25, down: 15, destroy: 5 },  // +11 ‚Üí +12
        { success: 50, fail: 25, down: 17, destroy: 8 },  // +12 ‚Üí +13
        { success: 45, fail: 25, down: 18, destroy: 12 }, // +13 ‚Üí +14
        { success: 40, fail: 25, down: 20, destroy: 15 }, // +14 ‚Üí +15
        { success: 35, fail: 25, down: 22, destroy: 18 }, // +15 ‚Üí +16
        { success: 30, fail: 25, down: 23, destroy: 22 }, // +16 ‚Üí +17
        { success: 25, fail: 25, down: 25, destroy: 25 }, // +17 ‚Üí +18
        { success: 22, fail: 23, down: 25, destroy: 30 }, // +18 ‚Üí +19
        { success: 20, fail: 22, down: 25, destroy: 33 }, // +19 ‚Üí +20
        { success: 18, fail: 22, down: 25, destroy: 35 }, // +20 ‚Üí +21
        { success: 15, fail: 20, down: 25, destroy: 40 }, // +21 ‚Üí +22
        { success: 12, fail: 18, down: 25, destroy: 45 }, // +22 ‚Üí +23
        { success: 10, fail: 15, down: 25, destroy: 50 }, // +23 ‚Üí +24
        { success: 8, fail: 12, down: 25, destroy: 55 },  // +24 ‚Üí +25
    ];
    
    const swordNames = {
        0: "Ï¥àÎ≥¥ÏûêÏùò Í≤Ä",
        5: "ÏàòÎ†®ÏûêÏùò Í≤Ä",
        10: "ÏàôÎ†®ÏûêÏùò Í≤Ä",
        15: "Îã¨Ïù∏Ïùò Í≤Ä",
        20: "Ï†ÑÏÑ§Ïùò Í≤Ä",
        25: "Ïã†ÌôîÏùò Í≤Ä"
    };
    
    // Î†àÎ≤®Î≥Ñ Í≤Ä Ïù¥Î™®ÏßÄ/Ïù¥ÎØ∏ÏßÄ
    // Î†àÎ≤®Î≥Ñ SVG Í≤Ä Ïù¥ÎØ∏ÏßÄ
    function getSwordSVG(level, size = 70) {
        const uniqueId = Math.random().toString(36).substr(2, 9);
        
        // Î†àÎ≤® 25: Ïã†ÌôîÏùò Í≤Ä (Ìô©Í∏àÎπõ + Î∂àÍΩÉ Ïò§Îùº)
        if (level >= 25) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="blade25_${uniqueId}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#FFF8DC"/>
                        <stop offset="50%" style="stop-color:#FFD700"/>
                        <stop offset="100%" style="stop-color:#FFF8DC"/>
                    </linearGradient>
                    <filter id="glow25_${uniqueId}" x="-100%" y="-100%" width="300%" height="300%">
                        <feGaussianBlur stdDeviation="3" result="blur"/>
                        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                    <radialGradient id="aura25_${uniqueId}">
                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:0.8"/>
                        <stop offset="100%" style="stop-color:#FF4500;stop-opacity:0"/>
                    </radialGradient>
                </defs>
                <!-- Ïò§Îùº -->
                <ellipse cx="50" cy="45" rx="25" ry="35" fill="url(#aura25_${uniqueId})">
                    <animate attributeName="rx" values="22;28;22" dur="1.5s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.6;0.9;0.6" dur="1.5s" repeatCount="indefinite"/>
                </ellipse>
                <g filter="url(#glow25_${uniqueId})">
                    <!-- Î∏îÎ†àÏù¥Îìú -->
                    <polygon points="50,2 58,45 50,52 42,45" fill="url(#blade25_${uniqueId})" stroke="#FFD700" stroke-width="1.5"/>
                    <line x1="50" y1="8" x2="50" y2="42" stroke="rgba(255,255,255,0.8)" stroke-width="2"/>
                    <!-- Í∞ÄÎìú (ÎÇ†Í∞úÌòï) -->
                    <path d="M25,47 Q38,42 50,50 Q62,42 75,47 Q62,56 50,52 Q38,56 25,47" fill="#FFD700" stroke="#B8860B" stroke-width="1"/>
                    <!-- ÏÜêÏû°Ïù¥ -->
                    <rect x="46" y="52" width="8" height="22" rx="2" fill="#8B4513"/>
                    <line x1="46" y1="58" x2="54" y2="58" stroke="#FFD700" stroke-width="2"/>
                    <line x1="46" y1="65" x2="54" y2="65" stroke="#FFD700" stroke-width="2"/>
                    <!-- ÌèºÎ©ú (ÏôïÍ¥Ä) -->
                    <path d="M42,74 L45,82 L47,77 L50,85 L53,77 L55,82 L58,74 Z" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                    <!-- Ï§ëÏïô Î≥¥ÏÑù -->
                    <circle cx="50" cy="50" r="5" fill="#FF0000" stroke="#FFD700" stroke-width="1">
                        <animate attributeName="r" values="4;6;4" dur="1s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="50" cy="50" r="2" fill="#FF6B6B"/>
                </g>
                <!-- ÌååÌã∞ÌÅ¥ -->
                <circle cx="35" cy="25" r="2" fill="#FFD700"><animate attributeName="cy" values="25;10;25" dur="2s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="2s" repeatCount="indefinite"/></circle>
                <circle cx="65" cy="30" r="1.5" fill="#FFA500"><animate attributeName="cy" values="30;15;30" dur="1.7s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="1.7s" repeatCount="indefinite"/></circle>
                <circle cx="50" cy="15" r="1.5" fill="#FFFF00"><animate attributeName="cy" values="15;0;15" dur="2.3s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="2.3s" repeatCount="indefinite"/></circle>
            </svg>`;
        }
        
        // Î†àÎ≤® 20+: Ï†ÑÏÑ§Ïùò Í≤Ä (ÌïëÌÅ¨Îπõ ÎßàÎ≤ïÍ≤Ä)
        if (level >= 20) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="blade20_${uniqueId}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#FFB6C1"/>
                        <stop offset="50%" style="stop-color:#FF1493"/>
                        <stop offset="100%" style="stop-color:#FFB6C1"/>
                    </linearGradient>
                    <filter id="glow20_${uniqueId}" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="2.5" result="blur"/>
                        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                </defs>
                <ellipse cx="50" cy="40" rx="20" ry="30" fill="rgba(255,20,147,0.2)">
                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="2s" repeatCount="indefinite"/>
                </ellipse>
                <g filter="url(#glow20_${uniqueId})">
                    <polygon points="50,5 56,48 50,54 44,48" fill="url(#blade20_${uniqueId})" stroke="#FF1493" stroke-width="1"/>
                    <line x1="50" y1="10" x2="50" y2="44" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"/>
                    <ellipse cx="50" cy="54" rx="14" ry="5" fill="#C0C0C0" stroke="#A0A0A0" stroke-width="1"/>
                    <rect x="46" y="56" width="8" height="18" rx="1" fill="#4A3728"/>
                    <circle cx="50" cy="78" r="4" fill="#C0C0C0"/>
                    <circle cx="50" cy="54" r="4" fill="#9333EA" stroke="#FFD700" stroke-width="1">
                        <animate attributeName="r" values="3;5;3" dur="1.5s" repeatCount="indefinite"/>
                    </circle>
                </g>
            </svg>`;
        }
        
        // Î†àÎ≤® 15+: Îã¨Ïù∏Ïùò Í≤Ä (Î≥¥ÎùºÎπõ)
        if (level >= 15) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="blade15_${uniqueId}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#D8B4FE"/>
                        <stop offset="50%" style="stop-color:#8B5CF6"/>
                        <stop offset="100%" style="stop-color:#D8B4FE"/>
                    </linearGradient>
                    <filter id="glow15_${uniqueId}" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="2" result="blur"/>
                        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                </defs>
                <g filter="url(#glow15_${uniqueId})">
                    <polygon points="50,8 55,48 50,54 45,48" fill="url(#blade15_${uniqueId})" stroke="#8B5CF6" stroke-width="1"/>
                    <line x1="50" y1="12" x2="50" y2="44" stroke="rgba(255,255,255,0.5)" stroke-width="1"/>
                    <rect x="36" y="52" width="28" height="5" rx="2" fill="#FFD700" stroke="#B8860B" stroke-width="1"/>
                    <rect x="46" y="57" width="8" height="16" rx="1" fill="#4A3728"/>
                    <ellipse cx="50" cy="76" rx="5" ry="3" fill="#FFD700"/>
                    <circle cx="50" cy="54" r="3" fill="#3B82F6">
                        <animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/>
                    </circle>
                </g>
            </svg>`;
        }
        
        // Î†àÎ≤® 10+: ÏàôÎ†®ÏûêÏùò Í≤Ä (ÌååÎûÄÎπõ)
        if (level >= 10) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="blade10_${uniqueId}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#93C5FD"/>
                        <stop offset="50%" style="stop-color:#3B82F6"/>
                        <stop offset="100%" style="stop-color:#93C5FD"/>
                    </linearGradient>
                    <filter id="glow10_${uniqueId}" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="1.5" result="blur"/>
                        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                </defs>
                <g filter="url(#glow10_${uniqueId})">
                    <polygon points="50,10 54,48 50,54 46,48" fill="url(#blade10_${uniqueId})" stroke="#3B82F6" stroke-width="1"/>
                    <line x1="50" y1="14" x2="50" y2="44" stroke="rgba(255,255,255,0.4)" stroke-width="1"/>
                    <rect x="38" y="52" width="24" height="4" rx="1" fill="#C0C0C0" stroke="#A0A0A0" stroke-width="1"/>
                    <rect x="46" y="56" width="8" height="15" rx="1" fill="#4A3728"/>
                    <circle cx="50" cy="74" r="3" fill="#C0C0C0"/>
                    <circle cx="50" cy="54" r="2.5" fill="#10B981"/>
                </g>
            </svg>`;
        }
        
        // Î†àÎ≤® 5+: ÏàòÎ†®ÏûêÏùò Í≤Ä (Ï¥àÎ°ùÎπõ)
        if (level >= 5) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="blade5_${uniqueId}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#6EE7B7"/>
                        <stop offset="50%" style="stop-color:#10B981"/>
                        <stop offset="100%" style="stop-color:#6EE7B7"/>
                    </linearGradient>
                </defs>
                <polygon points="50,12 53,48 50,54 47,48" fill="url(#blade5_${uniqueId})" stroke="#10B981" stroke-width="1"/>
                <line x1="50" y1="16" x2="50" y2="44" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                <rect x="40" y="52" width="20" height="4" rx="1" fill="#8B7355"/>
                <rect x="46" y="56" width="8" height="14" rx="1" fill="#4A3728"/>
                <circle cx="50" cy="73" r="3" fill="#8B7355"/>
                <circle cx="50" cy="54" r="2" fill="#F59E0B"/>
            </svg>`;
        }
        
        // Í∏∞Î≥∏ Í≤Ä (ÌöåÏÉâ)
        return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
            <defs>
                <linearGradient id="blade0_${uniqueId}" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#E5E7EB"/>
                    <stop offset="50%" style="stop-color:#9CA3AF"/>
                    <stop offset="100%" style="stop-color:#E5E7EB"/>
                </linearGradient>
            </defs>
            <polygon points="50,15 52,48 50,54 48,48" fill="url(#blade0_${uniqueId})" stroke="#9CA3AF" stroke-width="1"/>
            <rect x="42" y="52" width="16" height="4" rx="1" fill="#8B7355"/>
            <rect x="46" y="56" width="8" height="13" rx="1" fill="#4A3728"/>
            <circle cx="50" cy="72" r="3" fill="#8B7355"/>
        </svg>`;
    }
    
    function getSwordIcon(level) {
        return getSwordSVG(level, 70);
    }
    
    function getSwordIconSmall(level) {
        return getSwordSVG(level, 24);
    }
    
    function getSwordStyle(level) {
        return ""; // SVGÏóêÏÑú ÏßÅÏ†ë Ï≤òÎ¶¨
    }
    
    const aiNames = ['Í≤ÄÏà†ÏÇ¨', 'ÎåÄÏû•Ïû•Ïù¥', 'Î™®ÌóòÍ∞Ä', 'Í∏∞ÏÇ¨Îã®Ïû•', 'Ïö©ÏÇ¨', 'ÎßàÍ≤ÄÏÇ¨', 'ÏÑ±Í∏∞ÏÇ¨', 'ÏïîÏÇ¥Ïûê', 'Í≤ÄÍ∑Ä', 'ÎèÑÍ≤ÄÏû•Ïù∏', 'Ï¥àÎ≥¥Ïûê', 'Í≤ÄÌò∏', 'Î¨¥Î¶ºÍ≥†Ïàò', 'ÎèÑÏ†Å', 'Ï†ÑÏÇ¨', 'Í¥ëÏ†ÑÏÇ¨', 'ÎìÄÏñºÎ¶¨Ïä§Ìä∏', 'Í≤ÄÏÑ±', 'ÏÜåÎìúÎßàÏä§ÌÑ∞', 'Î∏îÎ†àÏù¥Îìú'];
    
    // AI ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ± (Ï≤òÏùåÏóêÎäî Ï†ÅÍ≤å, Ï†êÏ†ê ÎäòÏñ¥ÎÇ®)
    function initAIPlayers() {
        const count = 3 + Math.floor(Math.random() * 3); // Ï≤òÏùå 3~5Î™Ö
        for (let i = 0; i < count; i++) {
            addAIPlayer();
        }
    }
    
    function addAIPlayer() {
        const id = 'ai_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
        players[id] = {
            name: aiNames[Math.floor(Math.random() * aiNames.length)] + Math.floor(Math.random() * 1000),
            level: Math.floor(Math.random() * 12),
            maxLevel: 0,
            destroyed: false,
            status: '',
            statusType: '',
            isAI: true,
            lastAction: Date.now() - Math.random() * 3000
        };
        players[id].maxLevel = players[id].level;
        return players[id].name;
    }
    
    // Í∞ÄÎÅî ÏÉà ÌîåÎ†àÏù¥Ïñ¥ ÏûÖÏû•
    function randomPlayerJoin() {
        if (Object.keys(players).length < 30 && Math.random() < 0.3) {
            const name = addAIPlayer();
            addChat('system', `${name}ÎãòÏù¥ ÏûÖÏû•ÌñàÏäµÎãàÎã§.`);
            updateUI();
        }
        
        // Í∞ÄÎÅî Ìá¥Ïû•
        const aiList = Object.entries(players).filter(([id, p]) => p.isAI);
        if (aiList.length > 5 && Math.random() < 0.1) {
            const [id, player] = aiList[Math.floor(Math.random() * aiList.length)];
            addChat('system', `${player.name}ÎãòÏù¥ Ìá¥Ïû•ÌñàÏäµÎãàÎã§.`);
            delete players[id];
            updateUI();
        }
    }
    
    // AI ÌñâÎèô
    function aiAction() {
        Object.entries(players).forEach(([id, player]) => {
            if (!player.isAI) return;
            if (Date.now() - player.lastAction < 2000 + Math.random() * 5000) return;
            
            player.lastAction = Date.now();
            
            // ÌååÍ¥¥Îêú Í≤ÄÏù¥Î©¥ ÏÉà Í≤Ä Íµ¨Îß§
            if (player.destroyed) {
                if (Math.random() < 0.3) {
                    player.destroyed = false;
                    player.level = 0;
                    player.status = 'ÏÉà Í≤Ä Íµ¨Îß§!';
                    player.statusType = '';
                    addChat('system', `${player.name}ÎãòÏù¥ ÏÉà Í≤ÄÏùÑ Íµ¨Îß§ÌñàÏäµÎãàÎã§.`);
                    setTimeout(() => { player.status = ''; updateUI(); }, 2000);
                }
                return;
            }
            
            // Í∞ÄÎÅî Í≤Ä ÌåêÎß§ (ÎÜíÏùÄ Í∞ïÌôîÏùºÏàòÎ°ù ÌåêÎß§ ÌôïÎ•† Ï¶ùÍ∞Ä)
            if (player.level >= 8 && Math.random() < 0.05 + player.level * 0.01) {
                const sellPrice = getSellPrice(player.level);
                const soldLevel = player.level;
                player.status = `+${soldLevel} ÌåêÎß§! üí∞`;
                player.statusType = 'success';
                player.level = 0;
                addChat('system', `${player.name}ÎãòÏù¥ +${soldLevel} Í≤ÄÏùÑ ${sellPrice.toLocaleString()}GÏóê ÌåêÎß§!`);
                setTimeout(() => { player.status = ''; updateUI(); }, 3000);
                updateUI();
                return;
            }
            
            // Í∞ïÌôî ÏãúÎèÑ
            if (player.level < 25 && Math.random() < 0.4) {
                const probs = probTable[player.level];
                const roll = Math.random() * 100;
                
                // Í∞ïÌôî Ï§ë ÌëúÏãú
                player.status = 'Í∞ïÌôî Ï§ë...';
                player.statusType = 'upgrading';
                updateUI();
                
                setTimeout(() => {
                    let result;
                    if (roll < probs.success) {
                        result = 'success';
                        player.level++;
                        if (player.level > player.maxLevel) player.maxLevel = player.level;
                        player.status = `+${player.level} ÏÑ±Í≥µ! ‚ú®`;
                        player.statusType = 'success';
                        addChat('upgrade-success', `${player.name}ÎãòÏù¥ +${player.level} Í∞ïÌôîÏóê ÏÑ±Í≥µ!`);
                    } else if (roll < probs.success + probs.fail) {
                        result = 'fail';
                        player.status = 'Ïã§Ìå® (Ïú†ÏßÄ)';
                        player.statusType = 'fail';
                    } else if (roll < probs.success + probs.fail + probs.down) {
                        result = 'down';
                        player.level = Math.max(0, player.level - 1);
                        player.status = `+${player.level}Î°ú ÌïòÎùΩ üìâ`;
                        player.statusType = 'fail';
                        addChat('upgrade-fail', `${player.name}ÎãòÏùò Í≤ÄÏù¥ +${player.level}Î°ú ÌïòÎùΩ...`);
                    } else {
                        result = 'destroy';
                        player.destroyed = true;
                        player.status = 'üí• ÌååÍ¥¥Îê®!';
                        player.statusType = 'destroy';
                        addChat('upgrade-destroy', `${player.name}ÎãòÏùò +${player.level} Í≤ÄÏù¥ ÌååÍ¥¥ÎêòÏóàÏäµÎãàÎã§!`);
                    }
                    
                    updateUI();
                    
                    setTimeout(() => {
                        player.status = '';
                        player.statusType = '';
                        updateUI();
                    }, 3000);
                }, 800 + Math.random() * 500);
            }
        });
    }
    
    // Í≤åÏûÑ ÏãúÏûë
    function startGame() {
        const nameInput = document.getElementById('nameInput');
        myName = nameInput.value.trim() || 'Í≤ÄÏÇ¨' + Math.floor(Math.random() * 1000);
        myId = 'player_' + Date.now();
        
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        
        initAIPlayers();
        
        addChat('system', `${myName}ÎãòÏù¥ ÏûÖÏû•ÌñàÏäµÎãàÎã§!`);
        
        updateUI();
        
        // AI ÌñâÎèô Î£®ÌîÑ
        setInterval(aiAction, 1000);
        
        // Í∞ÄÎÅî ÌîåÎ†àÏù¥Ïñ¥ ÏûÖÏû•/Ìá¥Ïû•
        setInterval(randomPlayerJoin, 5000);
        
        // Í∞ÄÎÅî AI Ï±ÑÌåÖ
        setInterval(() => {
            const aiList = Object.values(players).filter(p => p.isAI && !p.destroyed);
            if (aiList.length > 0 && Math.random() < 0.1) {
                const ai = aiList[Math.floor(Math.random() * aiList.length)];
                const messages = [
                    'Ïò§ÎäòÏùÄ Ïö¥Ïù¥ Ï¢ãÏùÑ Í≤É Í∞ôÏïÑ!',
                    '+25 Í∞ÄÎ≥¥ÏûêÍ≥†~',
                    'ÌååÍ¥¥Î∞©ÏßÄ ÏºúÏïºÌïòÎÇò...',
                    'ÏïÑ Îòê ÌÑ∞Ïßà Í≤É Í∞ôÏïÑ',
                    'Ïù¥Î≤àÏóî ÏÑ±Í≥µÏù¥Îã§!',
                    'Í∞ïÌôî ÌôïÎ•† ÎÑàÎ¨¥ ÎÇÆÏïÑ...',
                    'ÌïúÎ≤àÎßå Îçî!',
                    'Ïò§Îäò Ïª®ÎîîÏÖò Ï¢ãÎã§',
                ];
                addChat('chat', messages[Math.floor(Math.random() * messages.length)], ai.name);
            }
        }, 8000);
    }
    
    // UI ÏóÖÎç∞Ïù¥Ìä∏
    function updateUI() {
        const probs = myState.level < 25 ? probTable[myState.level] : { success: 0, fail: 100, down: 0, destroy: 0 };
        const cost = getCost(myState.level);
        const bonusAtk = getBonusAtk(myState.level);
        
        // Ìó§Îçî
        document.getElementById('headerGold').textContent = myState.gold.toLocaleString();
        document.getElementById('headerSold').textContent = myState.totalSold.toLocaleString();
        document.getElementById('headerMax').textContent = `+${myState.maxLevel}`;
        document.getElementById('onlineCount').textContent = Object.keys(players).length + 1;
        
        // ÎÇ¥ Í≤Ä
        let swordName = "Ï¥àÎ≥¥ÏûêÏùò Í≤Ä";
        for (const [lv, name] of Object.entries(swordNames)) {
            if (myState.level >= parseInt(lv)) swordName = name;
        }
        
        document.getElementById('mySwordName').textContent = swordName;
        
        // Í≤Ä ÏïÑÏù¥ÏΩò & Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏ (SVG)
        const swordEl = document.getElementById('mySword');
        swordEl.innerHTML = getSwordIcon(myState.level);
        
        const levelEl = document.getElementById('mySwordLevel');
        levelEl.textContent = `+${myState.level}`;
        levelEl.className = myState.level >= 25 ? 'sword-level-display max-level' : 'sword-level-display';
        
        document.getElementById('mySwordAtk').textContent = (100 + bonusAtk).toLocaleString();
        
        // ÌôïÎ•† Î∞î
        const probBar = document.getElementById('probBar');
        probBar.innerHTML = `
            <div class="prob-segment success" style="width: ${probs.success}%">${probs.success > 8 ? probs.success + '%' : ''}</div>
            <div class="prob-segment fail" style="width: ${probs.fail}%">${probs.fail > 8 ? probs.fail + '%' : ''}</div>
            <div class="prob-segment down" style="width: ${probs.down}%">${probs.down > 8 ? probs.down + '%' : ''}</div>
            <div class="prob-segment destroy" style="width: ${probs.destroy}%">${probs.destroy > 8 ? probs.destroy + '%' : ''}</div>
        `;
        
        // ÎπÑÏö©
        const safeCheck = document.getElementById('safeCheck').checked;
        const catchCheck = document.getElementById('catchCheck').checked;
        let totalCost = cost;
        if (safeCheck && probs.destroy > 0) totalCost += Math.floor(cost * 2.0);  // ÌååÍ¥¥ Î∞©ÏßÄ: 200%
        if (catchCheck && probs.down > 0) totalCost += Math.floor(cost * 1.5);    // ÌïòÎùΩ Î∞©ÏßÄ: 150%
        
        document.getElementById('upgradeCost').textContent = `üí∞ ${totalCost.toLocaleString()}`;
        document.getElementById('safeCost').textContent = `+${Math.floor(cost * 2.0).toLocaleString()}`;
        document.getElementById('catchCost').textContent = `+${Math.floor(cost * 1.5).toLocaleString()}`;
        
        document.getElementById('safeRow').classList.toggle('disabled', probs.destroy === 0);
        document.getElementById('catchRow').classList.toggle('disabled', probs.down === 0);
        
        // ÌåêÎß§ Í∞ÄÍ≤© & Î≤ÑÌäº
        const sellPrice = getSellPrice(myState.level);
        document.getElementById('sellPrice').textContent = `üí∞ ${sellPrice.toLocaleString()}`;
        
        const sellBtn = document.getElementById('sellBtn');
        if (myState.destroyed) {
            sellBtn.disabled = true;
            sellBtn.textContent = 'üíÄ ÌååÍ¥¥Îêú Í≤Ä';
        } else if (myState.level === 0) {
            sellBtn.disabled = true;
            sellBtn.textContent = 'üì¶ ÌåêÎß§Ìï† Ïàò ÏóÜÏùå';
        } else {
            sellBtn.disabled = false;
            sellBtn.textContent = `üíé +${myState.level} Í≤Ä ÌåêÎß§ÌïòÍ∏∞`;
        }
        
        // Î≤ÑÌäº
        const btn = document.getElementById('upgradeBtn');
        if (myState.destroyed) {
            btn.disabled = true;
            btn.textContent = 'üíÄ ÌååÍ¥¥Îê®';
        } else if (myState.level >= 25) {
            btn.disabled = true;
            btn.textContent = 'üéâ ÏµúÎåÄ Í∞ïÌôî!';
        } else if (myState.gold < totalCost) {
            btn.disabled = true;
            btn.textContent = 'üí∏ Í≥®Îìú Î∂ÄÏ°±';
        } else if (myState.upgrading) {
            btn.disabled = true;
            btn.textContent = '‚è≥ Í∞ïÌôî Ï§ë...';
        } else {
            btn.disabled = false;
            btn.textContent = '‚öíÔ∏è Í∞ïÌôîÌïòÍ∏∞';
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥ Î™©Î°ù
        const playersList = document.getElementById('playersList');
        playersList.innerHTML = Object.entries(players).map(([id, p]) => `
            <div class="player-card ${p.statusType}">
                <div class="player-header">
                    <span class="player-name">${p.name}</span>
                    <span class="player-level">${p.destroyed ? 'üíÄ' : '+' + p.level}</span>
                </div>
                <div class="player-sword">
                    <span class="player-sword-icon">${p.destroyed ? 'üíî' : getSwordIconSmall(p.level)}</span>
                    <span>${p.destroyed ? 'ÌååÍ¥¥Îê®' : getSwordName(p.level)}</span>
                </div>
                <div class="player-status ${p.statusType}">${p.status}</div>
            </div>
        `).join('');
        
        // Î¶¨ÎçîÎ≥¥Îìú
        const allPlayers = [
            { name: myName, level: myState.level, isMe: true, destroyed: myState.destroyed },
            ...Object.values(players).map(p => ({ name: p.name, level: p.level, destroyed: p.destroyed }))
        ];
        allPlayers.sort((a, b) => b.level - a.level);
        
        const leaderboardList = document.getElementById('leaderboardList');
        leaderboardList.innerHTML = allPlayers.slice(0, 5).map((p, i) => {
            const rankClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
            return `
                <div class="leaderboard-item ${p.isMe ? 'me' : ''}">
                    <span class="leaderboard-rank ${rankClass}">${i + 1}</span>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${p.name}${p.isMe ? ' (ÎÇò)' : ''}</div>
                    </div>
                    <span class="leaderboard-level">${p.destroyed ? 'üíÄ' : '+' + p.level}</span>
                </div>
            `;
        }).join('');
    }
    
    function getSwordName(level) {
        let name = "Ï¥àÎ≥¥ÏûêÏùò Í≤Ä";
        for (const [lv, n] of Object.entries(swordNames)) {
            if (level >= parseInt(lv)) name = n;
        }
        return name;
    }
    
    function getCost(level) {
        return Math.floor(500 * Math.pow(1.3, level));  // ÎπÑÏö© ÎÇÆÏ∂§
    }
    
    function getBonusAtk(level) {
        let bonus = 0;
        for (let i = 1; i <= level; i++) {
            bonus += Math.floor(10 * Math.pow(1.15, i));
        }
        return bonus;
    }
    
    // ÌåêÎß§ Í∞ÄÍ≤© Í≥ÑÏÇ∞ (Ìù¨Í∑ÄÎèÑ Í∏∞Î∞ò, ÏôÑÎßåÌïú Ï¶ùÍ∞Ä)
    function getSellPrice(level) {
        if (level === 0) return 0;
        
        // 1. ÎàÑÏ†Å Í∞ïÌôîÎπÑÏö©
        let minCost = 0;
        for (let i = 0; i < level; i++) {
            minCost += getCost(i);
        }
        
        // 2. Ìù¨Í∑ÄÎèÑ Í≥ÑÏÇ∞ (Ìï¥Îãπ Î†àÎ≤®ÍπåÏßÄ ÎèÑÎã¨Ìï† ÌôïÎ•†)
        let probability = 1;
        for (let i = 0; i < level; i++) {
            probability *= probTable[i].success / 100;
        }
        
        // 3. Ìù¨Í∑ÄÎèÑ Î∞∞Ïú® (Î°úÍ∑∏Î°ú ÏôÑÎßåÌïòÍ≤å)
        // ÌôïÎ•† 100% = 1.2Î∞∞, 10% = 2Î∞∞, 1% = 2.8Î∞∞, 0.1% = 3.6Î∞∞
        const rarityMultiplier = 1.2 + Math.log10(1 / probability) * 0.8;
        
        // 4. ÏµúÏ¢Ö Í∞ÄÍ≤© = ÎàÑÏ†ÅÎπÑÏö© √ó Ìù¨Í∑ÄÎèÑÎ∞∞Ïú®
        const price = Math.floor(minCost * Math.max(1.2, rarityMultiplier));
        
        return price;
    }
    
    // Í≤Ä ÌåêÎß§
    function sellSword() {
        if (myState.destroyed || myState.level === 0) return;
        
        const price = getSellPrice(myState.level);
        const soldLevel = myState.level;
        
        myState.gold += price;
        myState.totalSold += price;
        myState.swordsSold++;
        myState.level = 0;
        
        // ÌåêÎß§ Ìö®Í≥º
        const sword = document.getElementById('mySword');
        sword.style.transition = 'all 0.3s';
        sword.style.transform = 'scale(0)';
        sword.style.opacity = '0';
        
        setTimeout(() => {
            sword.style.transform = 'scale(1)';
            sword.style.opacity = '1';
        }, 300);
        
        createParticles('#ffd700', 25);
        showResult('success', `üí∞ ÌåêÎß§ ÏôÑÎ£å!<br>+${price.toLocaleString()}G`);
        addChat('system', `${myName}ÎãòÏù¥ +${soldLevel} Í≤ÄÏùÑ ${price.toLocaleString()}GÏóê ÌåêÎß§ÌñàÏäµÎãàÎã§!`);
        
        updateUI();
    }
    
    // Í∞ïÌôî
    async function upgrade() {
        if (myState.destroyed || myState.level >= 25 || myState.upgrading) return;
        
        const probs = probTable[myState.level];
        const cost = getCost(myState.level);
        
        const safeCheck = document.getElementById('safeCheck').checked && probs.destroy > 0;
        const catchCheck = document.getElementById('catchCheck').checked && probs.down > 0;
        
        let totalCost = cost;
        if (safeCheck) totalCost += Math.floor(cost * 2.0);  // ÌååÍ¥¥ Î∞©ÏßÄ: 200%
        if (catchCheck) totalCost += Math.floor(cost * 1.5); // ÌïòÎùΩ Î∞©ÏßÄ: 150%
        
        if (myState.gold < totalCost) return;
        
        myState.gold -= totalCost;
        myState.upgrading = true;
        updateUI();
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò
        const sword = document.getElementById('mySword');
        sword.classList.add('shaking');
        
        await new Promise(r => setTimeout(r, 800));
        
        sword.classList.remove('shaking');
        
        // ÌôïÎ•† Í≥ÑÏÇ∞
        const roll = Math.random() * 100;
        let result;
        
        if (roll < probs.success) {
            result = 'success';
        } else if (roll < probs.success + probs.fail) {
            result = 'fail';
        } else if (roll < probs.success + probs.fail + probs.down) {
            // ÌïòÎùΩ Íµ¨Í∞Ñ
            result = catchCheck ? 'fail' : 'down';
        } else {
            // ÌååÍ¥¥ Íµ¨Í∞Ñ
            if (safeCheck) {
                // ÌååÍ¥¥ Î∞©ÏßÄ ‚Üí ÌïòÎùΩÏúºÎ°ú Î≥ÄÌôò, Í∑ºÎç∞ ÌïòÎùΩ Î∞©ÏßÄÎèÑ ÏºúÏ†∏ÏûàÏúºÎ©¥ Ïú†ÏßÄ
                result = catchCheck ? 'fail' : 'down';
            } else {
                result = 'destroy';
            }
        }
        
        // Í≤∞Í≥º Ï≤òÎ¶¨
        const oldLevel = myState.level;
        
        switch (result) {
            case 'success':
                myState.level++;
                if (myState.level > myState.maxLevel) myState.maxLevel = myState.level;
                
                sword.classList.add('success');
                setTimeout(() => sword.classList.remove('success'), 600);
                
                createParticles('#4ecdc4', 30);
                showResult('success', `‚ú® ÏÑ±Í≥µ!<br>+${myState.level}`);
                addChat('upgrade-success', `${myName}ÎãòÏù¥ +${myState.level} Í∞ïÌôîÏóê ÏÑ±Í≥µ!`);
                
                if (myState.level === 25) {
                    addChat('system', `üéâüéâüéâ ${myName}ÎãòÏù¥ +25 Ïã†ÌôîÏùò Í≤ÄÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§! üéâüéâüéâ`);
                }
                break;
                
            case 'fail':
                sword.classList.add('fail');
                setTimeout(() => sword.classList.remove('fail'), 400);
                
                showResult('fail', 'üòÖ Ïã§Ìå®<br>Ïú†ÏßÄ');
                break;
                
            case 'down':
                myState.level = Math.max(0, myState.level - 1);
                
                sword.classList.add('fail');
                setTimeout(() => sword.classList.remove('fail'), 400);
                
                createParticles('#a55eea', 15);
                showResult('down', `üìâ ÌïòÎùΩ<br>+${myState.level}`);
                addChat('upgrade-fail', `${myName}ÎãòÏùò Í≤ÄÏù¥ +${myState.level}Î°ú ÌïòÎùΩ...`);
                break;
                
            case 'destroy':
                myState.destroyed = true;
                
                sword.classList.add('destroy');
                
                createParticles('#ff6b6b', 50);
                showResult('destroy', 'üí• ÌååÍ¥¥!');
                addChat('upgrade-destroy', `${myName}ÎãòÏùò +${oldLevel} Í≤ÄÏù¥ ÌååÍ¥¥ÎêòÏóàÏäµÎãàÎã§!`);
                break;
        }
        
        myState.upgrading = false;
        updateUI();
    }
    
    // ÏÉà Í≤Ä
    function newSword() {
        if (myState.gold < 1000) {
            alert('Í≥®ÎìúÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');
            return;
        }
        
        myState.gold -= 1000;
        myState.level = 0;
        myState.destroyed = false;
        
        const sword = document.getElementById('mySword');
        sword.classList.remove('destroy');
        sword.innerHTML = getSwordIcon(0);
        
        addChat('system', `${myName}ÎãòÏù¥ ÏÉà Í≤ÄÏùÑ Íµ¨Îß§ÌñàÏäµÎãàÎã§.`);
        updateUI();
    }
    
    // Ï±ÑÌåÖ
    function addChat(type, message, name = '') {
        const chatMessages = document.getElementById('chatMessages');
        const msg = document.createElement('div');
        msg.className = `chat-msg ${type}`;
        
        if (type === 'chat') {
            msg.innerHTML = `<span class="name" style="color: #ffd700">${name}:</span> ${message}`;
        } else {
            msg.textContent = message;
        }
        
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // ÏµúÎåÄ 100Í∞ú
        while (chatMessages.children.length > 100) {
            chatMessages.removeChild(chatMessages.firstChild);
        }
    }
    
    function sendChat() {
        const input = document.getElementById('chatInput');
        const msg = input.value.trim();
        if (msg) {
            addChat('chat', msg, myName);
            input.value = '';
        }
    }
    
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChat();
    });
    
    document.getElementById('nameInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') startGame();
    });
    
    // Í≤∞Í≥º ÌåùÏóÖ
    function showResult(type, message) {
        document.querySelectorAll('.result-popup').forEach(p => p.remove());
        
        const popup = document.createElement('div');
        popup.className = `result-popup ${type}`;
        popup.innerHTML = message;
        document.body.appendChild(popup);
        
        setTimeout(() => popup.remove(), 1500);
    }
    
    // ÌååÌã∞ÌÅ¥
    function createParticles(color, count) {
        const container = document.getElementById('particles');
        const sword = document.getElementById('mySword');
        const rect = sword.getBoundingClientRect();
        
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.backgroundColor = color;
            particle.style.width = (5 + Math.random() * 10) + 'px';
            particle.style.height = particle.style.width;
            particle.style.left = (rect.left + rect.width / 2) + 'px';
            particle.style.top = (rect.top + rect.height / 2) + 'px';
            particle.style.setProperty('--tx', (Math.random() - 0.5) * 200 + 'px');
            particle.style.setProperty('--ty', (Math.random() - 0.5) * 200 + 'px');
            container.appendChild(particle);
            
            setTimeout(() => particle.remove(), 1000);
        }
    }
    
    // ÏòµÏÖò Ï≤¥ÌÅ¨Î∞ïÏä§ ÌÜ†Í∏Ä
    function toggleCheck(id) {
        const checkbox = document.getElementById(id);
        const row = checkbox.closest('.option-row');
        if (row.classList.contains('disabled')) return;
        checkbox.checked = !checkbox.checked;
        updateUI();
    }
    
    // ÏòµÏÖò Ï≤¥ÌÅ¨Î∞ïÏä§ Ïù¥Î≤§Ìä∏
    document.getElementById('safeCheck').addEventListener('change', updateUI);
    document.getElementById('catchCheck').addEventListener('change', updateUI);
</script>
```

</body>
</html>