<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Í≤Ä Í∞ïÌôî ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ - Î©ÄÌã∞ÌîåÎ†àÏù¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

```
    html, body {
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
    }
    
    body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
        color: white;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }
    
    /* ÏãúÏûë ÌôîÎ©¥ */
    #startScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.95);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    #startScreen h1 {
        font-size: 3rem;
        color: #ffd700;
        margin-bottom: 10px;
        text-shadow: 0 0 30px rgba(255,215,0,0.5);
    }
    
    #startScreen .subtitle {
        color: #888;
        margin-bottom: 40px;
        font-size: 1.1rem;
    }
    
    #startScreen input {
        padding: 15px 30px;
        font-size: 1.2rem;
        border: 2px solid #ffd700;
        border-radius: 10px;
        background: rgba(255,255,255,0.1);
        color: white;
        text-align: center;
        width: 300px;
        margin-bottom: 20px;
    }
    
    #startScreen input:focus {
        outline: none;
        background: rgba(255,255,255,0.15);
    }
    
    #startScreen button {
        padding: 15px 50px;
        font-size: 1.3rem;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        border: none;
        border-radius: 10px;
        color: #1a1a2e;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    #startScreen button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(255,215,0,0.5);
    }
    
    @media (max-width: 600px) {
        #startScreen h1 {
            font-size: 1.8rem;
        }
        
        #startScreen .subtitle {
            font-size: 0.85rem;
            padding: 0 20px;
            text-align: center;
        }
        
        #startScreen input {
            width: 80%;
            max-width: 250px;
            padding: 12px 20px;
            font-size: 1rem;
        }
        
        #startScreen button {
            padding: 12px 40px;
            font-size: 1.1rem;
        }
    }
    
    /* Ìó§Îçî */
    .header {
        background: rgba(0,0,0,0.5);
        padding: 8px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .header h1 {
        font-size: 1.1rem;
        color: #ffd700;
    }
    
    .header-stats {
        display: flex;
        gap: 20px;
        align-items: center;
    }
    
    .header-stat {
        text-align: center;
    }
    
    .header-stat .label {
        font-size: 0.65rem;
        color: #888;
    }
    
    .header-stat .value {
        font-size: 0.95rem;
        font-weight: bold;
        color: #ffd700;
    }
    
    .online-count {
        background: rgba(78,205,196,0.2);
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.75rem;
    }
    
    .online-count span {
        color: #4ecdc4;
        font-weight: bold;
    }
    
    /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ */
    .main-container {
        display: flex;
        height: calc(100vh - 45px);
        flex-wrap: wrap;
    }
    
    /* ÏôºÏ™Ω: Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§ */
    .players-panel {
        width: 240px;
        min-width: 240px;
        background: rgba(0,0,0,0.3);
        border-right: 1px solid rgba(255,255,255,0.1);
        overflow-y: auto;
        padding: 10px;
    }
    
    .players-title {
        font-size: 0.85rem;
        color: #ffd700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .player-card {
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 6px;
        transition: all 0.3s;
        border: 1px solid transparent;
    }
    
    .player-card:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .player-card.upgrading {
        border-color: #ffd700;
        animation: pulse 0.5s infinite;
    }
    
    .player-card.success {
        border-color: #4ecdc4;
        background: rgba(78,205,196,0.1);
    }
    
    .player-card.fail {
        border-color: #ffa502;
        background: rgba(255,165,2,0.1);
    }
    
    .player-card.destroy {
        border-color: #ff6b6b;
        background: rgba(255,107,107,0.1);
    }
    
    @keyframes pulse {
        0%, 100% { box-shadow: 0 0 5px rgba(255,215,0,0.3); }
        50% { box-shadow: 0 0 20px rgba(255,215,0,0.6); }
    }
    
    .player-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
    }
    
    .player-name {
        font-weight: bold;
        font-size: 0.8rem;
    }
    
    .player-level {
        color: #ffd700;
        font-weight: bold;
        font-size: 0.8rem;
    }
    
    .player-sword {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.7rem;
        color: #aaa;
    }
    
    .player-sword-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
    }
    
    .player-status {
        font-size: 0.65rem;
        margin-top: 3px;
        min-height: 14px;
    }
    
    /* Ï§ëÏïô: ÎÇ¥ Í∞ïÌôî */
    .upgrade-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        overflow-y: auto;
    }
    
    .my-sword-display {
        text-align: center;
        margin-bottom: 15px;
    }
    
    .sword-visual {
        width: 140px;
        height: 140px;
        margin: 0 auto 10px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .sword-visual::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
        animation: breathe 3s ease-in-out infinite;
    }
    
    @keyframes breathe {
        0%, 100% { transform: scale(1); opacity: 0.5; }
        50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .sword-visual.shaking {
        animation: shake 0.08s infinite;
    }
    
    .sword-visual.shaking::before {
        background: radial-gradient(circle, rgba(255,165,0,0.4) 0%, transparent 70%);
        animation: chargeUp 0.8s ease-out;
    }
    
    @keyframes chargeUp {
        0% { transform: scale(0.8); opacity: 0.3; }
        100% { transform: scale(1.5); opacity: 0.8; }
    }
    
    .sword-visual.success {
        animation: successPop 0.8s ease-out;
    }
    
    .sword-visual.success::before {
        background: radial-gradient(circle, rgba(78,205,196,0.6) 0%, rgba(255,215,0,0.3) 50%, transparent 70%);
        animation: successBurst 0.8s ease-out;
    }
    
    @keyframes successBurst {
        0% { transform: scale(0.5); opacity: 1; }
        50% { transform: scale(2); opacity: 0.8; }
        100% { transform: scale(2.5); opacity: 0; }
    }
    
    .sword-visual.fail {
        animation: failShake 0.5s ease-out;
    }
    
    .sword-visual.destroy {
        animation: explode 1s ease-out forwards;
    }
    
    .sword-visual.destroy::before {
        background: radial-gradient(circle, rgba(255,0,0,0.8) 0%, rgba(255,100,0,0.5) 50%, transparent 70%);
        animation: explosionWave 1s ease-out;
    }
    
    @keyframes explosionWave {
        0% { transform: scale(0.5); opacity: 1; }
        100% { transform: scale(4); opacity: 0; }
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0) rotate(0); }
        25% { transform: translateX(-5px) rotate(-2deg); }
        75% { transform: translateX(5px) rotate(2deg); }
    }
    
    @keyframes successPop {
        0% { transform: scale(1); filter: brightness(1); }
        30% { transform: scale(1.4) rotate(-5deg); filter: brightness(1.5) drop-shadow(0 0 30px rgba(78,205,196,1)); }
        50% { transform: scale(1.5) rotate(5deg); filter: brightness(2) drop-shadow(0 0 50px rgba(255,215,0,1)); }
        70% { transform: scale(1.3) rotate(-3deg); filter: brightness(1.5) drop-shadow(0 0 40px rgba(78,205,196,0.8)); }
        100% { transform: scale(1) rotate(0); filter: brightness(1) drop-shadow(0 0 20px rgba(255,215,0,0.3)); }
    }
    
    @keyframes failShake {
        0%, 100% { transform: translateX(0); filter: brightness(1); }
        10% { transform: translateX(-20px) rotate(-5deg); filter: brightness(0.7); }
        30% { transform: translateX(20px) rotate(5deg); filter: brightness(0.8); }
        50% { transform: translateX(-15px) rotate(-3deg); }
        70% { transform: translateX(15px) rotate(3deg); }
        90% { transform: translateX(-5px); }
    }
    
    @keyframes explode {
        0% { transform: scale(1) rotate(0); opacity: 1; filter: brightness(1); }
        20% { transform: scale(1.3) rotate(10deg); filter: brightness(2) hue-rotate(30deg); }
        40% { transform: scale(1.5) rotate(-10deg); filter: brightness(3) hue-rotate(60deg); }
        60% { transform: scale(1.2) rotate(5deg); filter: brightness(2) saturate(2); opacity: 0.8; }
        100% { transform: scale(0) rotate(180deg); opacity: 0; }
    }
    
    .sword-name {
        font-size: 1rem;
        color: #fff;
        margin-bottom: 2px;
    }
    
    .sword-level-display {
        font-size: 2rem;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 0 0 15px rgba(255,215,0,0.5);
    }
    
    .sword-level-display.max-level {
        background: linear-gradient(135deg, #ff6b6b, #ffd700, #4ecdc4, #a55eea);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: rainbow 2s linear infinite;
        background-size: 400% 400%;
    }
    
    @keyframes rainbow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .sword-atk {
        color: #ff6b6b;
        font-size: 0.85rem;
        margin-top: 5px;
    }
    
    /* Í∞ïÌôî Ìå®ÎÑê */
    .upgrade-panel {
        background: rgba(0,0,0,0.4);
        border-radius: 15px;
        padding: 15px;
        width: 100%;
        max-width: 380px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    
    .prob-section {
        margin-bottom: 12px;
    }
    
    .prob-title {
        font-size: 0.75rem;
        color: #888;
        margin-bottom: 6px;
    }
    
    .prob-bar {
        height: 25px;
        background: #222;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        margin-bottom: 6px;
    }
    
    .prob-segment {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: bold;
        transition: width 0.3s;
    }
    
    .prob-segment.success { background: #4ecdc4; color: #1a1a2e; }
    .prob-segment.fail { background: #ffa502; color: #1a1a2e; }
    .prob-segment.down { background: #a55eea; color: white; }
    .prob-segment.destroy { background: #ff6b6b; color: white; }
    
    .prob-legend {
        display: flex;
        justify-content: space-around;
        font-size: 0.65rem;
    }
    
    .prob-legend-item {
        display: flex;
        align-items: center;
        gap: 3px;
    }
    
    .prob-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .cost-section {
        background: rgba(255,215,0,0.1);
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        margin-bottom: 12px;
    }
    
    .cost-label { color: #888; font-size: 0.75rem; }
    .cost-value { color: #ffd700; font-size: 1.3rem; font-weight: bold; }
    
    .options-section {
        margin-bottom: 12px;
    }
    
    .option-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255,255,255,0.05);
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 6px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .option-row:hover { background: rgba(255,255,255,0.1); }
    .option-row.disabled { opacity: 0.4; pointer-events: none; }
    
    .option-left {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .option-left input {
        width: 16px;
        height: 16px;
        accent-color: #ffd700;
    }
    
    .option-name { font-size: 0.8rem; }
    .option-cost { color: #ffd700; font-size: 0.8rem; }
    
    .upgrade-btn {
        width: 100%;
        padding: 12px;
        font-size: 1.1rem;
        font-weight: bold;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        color: #1a1a2e;
        transition: all 0.3s;
    }
    
    .upgrade-btn:hover:not(:disabled) {
        transform: scale(1.02);
        box-shadow: 0 0 30px rgba(255,215,0,0.5);
    }
    
    .upgrade-btn:disabled {
        background: #444;
        color: #888;
        cursor: not-allowed;
    }
    
    .new-sword-btn {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        font-size: 0.85rem;
        background: #4ecdc4;
        border: none;
        border-radius: 8px;
        color: #1a1a2e;
        cursor: pointer;
        font-weight: bold;
    }
    
    .new-sword-btn:hover { background: #3dbdb5; }
    
    .sell-section {
        margin-top: 10px;
        background: linear-gradient(135deg, rgba(78,205,196,0.2), rgba(46,204,113,0.2));
        border: 1px solid rgba(78,205,196,0.3);
        border-radius: 10px;
        padding: 10px;
    }
    
    .sell-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .sell-label {
        color: #aaa;
        font-size: 0.75rem;
    }
    
    .sell-price {
        color: #4ecdc4;
        font-size: 1.1rem;
        font-weight: bold;
    }
    
    .sell-btn {
        width: 100%;
        padding: 10px;
        font-size: 0.9rem;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: linear-gradient(135deg, #4ecdc4, #2ecc71);
        color: #1a1a2e;
        transition: all 0.3s;
    }
    
    .sell-btn:hover:not(:disabled) {
        transform: scale(1.02);
        box-shadow: 0 0 25px rgba(78,205,196,0.5);
    }
    
    .sell-btn:disabled {
        background: #444;
        color: #888;
        cursor: not-allowed;
    }
    
    /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
    @media (max-width: 900px) {
        .main-container {
            flex-direction: column;
            height: auto;
            min-height: calc(100vh - 45px);
            width: 100%;
        }
        
        .players-panel {
            display: none;
        }
        
        .upgrade-area {
            width: 100%;
        }
        
        .side-panel {
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
            border-left: none;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-direction: column;
            height: auto;
        }
        
        .leaderboard {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            width: 100% !important;
        }
        
        #leaderboardList {
            display: flex;
            gap: 6px;
            flex: 1;
        }
        
        .leaderboard-item {
            flex: 1;
            text-align: center;
            padding: 4px 8px;
            min-width: 0;
        }
        
        .chat-section {
            width: 100% !important;
        }
        
        .chat-messages {
            width: 100% !important;
        }
        
        .chat-input {
            width: 100% !important;
        }
        
        .upgrade-panel {
            max-width: 100%;
        }
    }
    
    @media (max-width: 600px) {
        .header {
            padding: 8px 12px;
        }
        
        .header h1 {
            font-size: 0.95rem;
        }
        
        .header-stats {
            gap: 12px;
        }
        
        .header-stat .label {
            font-size: 0.6rem;
        }
        
        .header-stat .value {
            font-size: 0.85rem;
        }
        
        .online-count {
            padding: 4px 10px;
            font-size: 0.7rem;
        }
        
        .main-container {
            height: auto;
        }
        
        .upgrade-area {
            padding: 10px 8px;
        }
        
        .my-sword-display {
            margin-bottom: 12px;
        }
        
        .sword-visual {
            font-size: 55px;
            margin-bottom: 3px;
        }
        
        .sword-name {
            font-size: 0.9rem;
        }
        
        .sword-level-display {
            font-size: 1.6rem;
        }
        
        .sword-atk {
            font-size: 0.8rem;
            margin-top: 3px;
        }
        
        .upgrade-panel {
            padding: 12px;
            border-radius: 12px;
        }
        
        .prob-section {
            margin-bottom: 10px;
        }
        
        .prob-title {
            font-size: 0.7rem;
            margin-bottom: 5px;
        }
        
        .prob-bar {
            height: 22px;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        
        .prob-segment {
            font-size: 0.65rem;
        }
        
        .prob-legend {
            font-size: 0.6rem;
        }
        
        .prob-dot {
            width: 7px;
            height: 7px;
        }
        
        .cost-section {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .cost-label {
            font-size: 0.7rem;
        }
        
        .cost-value {
            font-size: 1.15rem;
        }
        
        .options-section {
            margin-bottom: 10px;
        }
        
        .option-row {
            padding: 8px 10px;
            margin-bottom: 5px;
            border-radius: 6px;
        }
        
        .option-left {
            gap: 8px;
        }
        
        .option-left input {
            width: 16px;
            height: 16px;
        }
        
        .option-name {
            font-size: 0.75rem;
        }
        
        .option-cost {
            font-size: 0.75rem;
        }
        
        .upgrade-btn {
            padding: 14px;
            font-size: 1.05rem;
            border-radius: 10px;
        }
        
        .sell-section {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
        }
        
        .sell-info {
            margin-bottom: 8px;
        }
        
        .sell-label {
            font-size: 0.7rem;
        }
        
        .sell-price {
            font-size: 1rem;
        }
        
        .sell-btn {
            padding: 10px;
            font-size: 0.85rem;
            border-radius: 8px;
        }
        
        .new-sword-btn {
            padding: 10px;
            margin-top: 10px;
            font-size: 0.8rem;
            border-radius: 8px;
        }
        
        /* Î™®Î∞îÏùº ÏÇ¨Ïù¥Îìú Ìå®ÎÑê - ÌîåÎ°úÌåÖ ÏóÜÏù¥ ÌïòÎã® Î∞∞Ïπò */
        .side-panel {
            flex-direction: column;
            height: auto;
            max-height: none;
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
            position: relative;
            background: rgba(0,0,0,0.5);
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .leaderboard {
            border-right: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 8px 10px;
            max-height: none;
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            width: 100% !important;
        }
        
        .leaderboard-title {
            font-size: 0.75rem;
            margin-bottom: 0;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        #leaderboardList {
            display: flex;
            gap: 6px;
            flex: 1;
        }
        
        .leaderboard-item {
            padding: 4px 8px;
            margin-bottom: 0;
            border-radius: 4px;
            white-space: nowrap;
            flex: 1;
            text-align: center;
            min-width: 0;
        }
        
        .leaderboard-rank {
            width: auto;
            font-size: 0.7rem;
            margin-right: 4px;
        }
        
        .leaderboard-info {
            display: inline;
        }
        
        .leaderboard-name {
            font-size: 0.65rem;
            display: inline;
        }
        
        .leaderboard-level {
            font-size: 0.7rem;
            display: inline;
            margin-left: 3px;
        }
        
        .chat-section {
            padding: 8px 10px;
            height: auto;
            width: 100% !important;
        }
        
        .chat-title {
            display: none;
        }
        
        .chat-messages {
            height: 85px;
            max-height: 85px;
            min-height: 85px;
            padding: 6px;
            margin-bottom: 6px;
            border-radius: 6px;
            width: 100% !important;
        }
        
        .chat-msg {
            font-size: 0.65rem;
            margin-bottom: 3px;
            line-height: 1.3;
        }
        
        .chat-input {
            gap: 6px;
            width: 100% !important;
            display: flex;
        }
        
        .chat-input input {
            padding: 10px;
            font-size: 0.8rem;
            border-radius: 6px;
            flex: 1;
            min-width: 0;
        }
        }
        
        .chat-input button {
            padding: 10px 15px;
            font-size: 0.8rem;
            border-radius: 6px;
        }
        
        /* ÌîåÎ°úÌåÖ Ï†úÍ±∞ÌñàÏúºÎØÄÎ°ú Ïó¨Î∞± Î∂àÌïÑÏöî */
        .main-container {
            padding-bottom: 0;
        }
        
        .result-popup {
            padding: 18px 30px;
            font-size: 1.1rem;
            border-radius: 12px;
        }
    }
    
    /* ÏïÑÏ£º ÏûëÏùÄ ÌôîÎ©¥ */
    @media (max-width: 380px) {
        .header h1 {
            font-size: 0.85rem;
        }
        
        .header-stats {
            gap: 8px;
        }
        
        .header-stat .value {
            font-size: 0.75rem;
        }
        
        .sword-visual {
            font-size: 45px;
        }
        
        .sword-level-display {
            font-size: 1.4rem;
        }
        
        .upgrade-btn {
            padding: 12px;
            font-size: 0.95rem;
        }
    }
    
    /* ÌÑ∞Ïπò ÎîîÎ∞îÏù¥Ïä§ ÏµúÏ†ÅÌôî */
    @media (hover: none) {
        .upgrade-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .sell-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .option-row:active {
            background: rgba(255,255,255,0.15);
        }
        
        .new-sword-btn:active {
            transform: scale(0.98);
        }
    }
    
    /* Ïò§Î•∏Ï™Ω: ÏàúÏúÑ & Ï±ÑÌåÖ */
    .side-panel {
        width: 280px;
        min-width: 280px;
        background: rgba(0,0,0,0.3);
        border-left: 1px solid rgba(255,255,255,0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    
    .leaderboard {
        padding: 8px 10px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        gap: 8px;
        overflow-x: auto;
    }
    
    .leaderboard-title {
        font-size: 0.8rem;
        color: #ffd700;
        display: flex;
        align-items: center;
        gap: 5px;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    #leaderboardList {
        display: flex;
        gap: 6px;
        flex: 1;
    }
    
    .leaderboard-item {
        display: flex;
        align-items: center;
        padding: 4px 8px;
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    .leaderboard-item.me {
        background: rgba(78,205,196,0.15);
        border: 1px solid rgba(78,205,196,0.3);
    }
    
    .leaderboard-rank {
        font-weight: bold;
        color: #ffd700;
        font-size: 0.75rem;
        margin-right: 4px;
    }
    
    .leaderboard-rank.gold { color: #ffd700; }
    .leaderboard-rank.silver { color: #c0c0c0; }
    .leaderboard-rank.bronze { color: #cd7f32; }
    
    .leaderboard-info {
        display: inline;
    }
    
    .leaderboard-name { 
        font-size: 0.7rem; 
        display: inline;
    }
    .leaderboard-level { 
        color: #ffd700; 
        font-weight: bold; 
        font-size: 0.75rem; 
        display: inline;
        margin-left: 3px;
    }
    
    .chat-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 10px;
        min-height: 0;
        overflow: hidden;
    }
    
    .chat-title {
        font-size: 0.85rem;
        color: #ffd700;
        margin-bottom: 8px;
        flex-shrink: 0;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 8px;
        min-height: 100px;
        max-height: 200px;
    }
    
    .chat-msg {
        margin-bottom: 4px;
        font-size: 0.7rem;
        word-wrap: break-word;
        line-height: 1.4;
    }
    
    .chat-msg .name {
        font-weight: bold;
        margin-right: 4px;
    }
    
    .chat-msg.system {
        color: #ffd700;
        font-style: italic;
    }
    
    .chat-msg.upgrade-success { color: #4ecdc4; }
    .chat-msg.upgrade-fail { color: #ffa502; }
    .chat-msg.upgrade-destroy { color: #ff6b6b; }
    
    .chat-input {
        display: flex;
        gap: 5px;
        flex-shrink: 0;
    }
    
    .chat-input {
        display: flex;
        gap: 5px;
    }
    
    .chat-input input {
        flex: 1;
        padding: 8px;
        border: none;
        border-radius: 6px;
        background: rgba(255,255,255,0.1);
        color: white;
        font-size: 0.75rem;
    }
    
    .chat-input input:focus { outline: none; background: rgba(255,255,255,0.15); }
    
    .chat-input button {
        padding: 8px 12px;
        background: #ffd700;
        border: none;
        border-radius: 6px;
        color: #1a1a2e;
        font-weight: bold;
        cursor: pointer;
        font-size: 0.75rem;
    }
    
    /* Í≤∞Í≥º ÌåùÏóÖ */
    .result-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px 35px;
        border-radius: 15px;
        font-size: 1.3rem;
        font-weight: bold;
        z-index: 500;
        text-align: center;
        animation: popIn 0.3s ease-out;
    }
    
    .result-popup.success {
        background: linear-gradient(135deg, #4ecdc4, #2ecc71);
        box-shadow: 0 0 50px rgba(78,205,196,0.7);
    }
    
    .result-popup.fail {
        background: linear-gradient(135deg, #ffa502, #e67e22);
        box-shadow: 0 0 50px rgba(255,165,2,0.7);
    }
    
    .result-popup.down {
        background: linear-gradient(135deg, #a55eea, #8e44ad);
        box-shadow: 0 0 50px rgba(165,94,234,0.7);
    }
    
    .result-popup.destroy {
        background: linear-gradient(135deg, #ff6b6b, #c0392b);
        box-shadow: 0 0 50px rgba(255,107,107,0.7);
    }
    
    @keyframes popIn {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        70% { transform: translate(-50%, -50%) scale(1.1); }
        100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    /* ÌååÌã∞ÌÅ¥ */
    .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 400;
    }
    
    .particle {
        position: absolute;
        border-radius: 50%;
        animation: particleFly 1.2s ease-out forwards;
        box-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
    }
    
    @keyframes particleFly {
        0% { transform: translate(0, 0) scale(1); opacity: 1; }
        50% { opacity: 1; }
        100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }
    
    .spark {
        position: absolute;
        width: 4px;
        height: 4px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 6px white, 0 0 12px white;
        animation: sparkFly 0.8s ease-out forwards;
    }
    
    @keyframes sparkFly {
        0% { transform: translate(0, 0) scale(1); opacity: 1; }
        100% { transform: translate(var(--tx), var(--ty)) scale(0.5); opacity: 0; }
    }
    
    .ring-effect {
        position: absolute;
        width: 20px;
        height: 20px;
        border: 3px solid;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: ringExpand 0.6s ease-out forwards;
    }
    
    @keyframes ringExpand {
        0% { width: 20px; height: 20px; opacity: 1; border-width: 3px; }
        100% { width: 200px; height: 200px; opacity: 0; border-width: 1px; }
    }
    
    /* Îì±Í∏â ÏÉâÏÉÅ */
    .grade-S { color: #ff6b6b; }
    .grade-A { color: #a55eea; }
    .grade-B { color: #4ecdc4; }
    .grade-C { color: #ffd700; }
    .grade-D { color: #aaa; }
</style>
```

</head>
<body>
    <!-- ÏãúÏûë ÌôîÎ©¥ -->
    <div id="startScreen">
        <h1>‚öîÔ∏è Í≤Ä Í∞ïÌôî ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</h1>
        <p class="subtitle">Í≤ÄÏùÑ Í∞ïÌôîÌïòÍ≥† ÌåêÎß§Ìï¥ÏÑú Î∂ÄÏûêÍ∞Ä ÎêòÏûê! üí∞</p>
        <input type="text" id="nameInput" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•" maxlength="10">
        <button onclick="startGame()">Í≤åÏûÑ ÏãúÏûë</button>
    </div>

```
<!-- Î©îÏù∏ Í≤åÏûÑ -->
<div id="gameScreen" style="display: none;">
    <div class="header">
        <h1>‚öîÔ∏è Í≤Ä Í∞ïÌôî ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</h1>
        <div class="header-stats">
            <div class="header-stat">
                <div class="label">Î≥¥Ïú† Í≥®Îìú</div>
                <div class="value" id="headerGold">50,000</div>
            </div>
            <div class="header-stat">
                <div class="label">Ï¥ù ÌåêÎß§ ÏàòÏùµ</div>
                <div class="value" id="headerSold" style="color: #4ecdc4;">0</div>
            </div>
            <div class="header-stat">
                <div class="label">ÏµúÍ≥† Í∏∞Î°ù</div>
                <div class="value" id="headerMax">+0</div>
            </div>
            <div class="online-count">
                Ï†ëÏÜçÏûê <span id="onlineCount">1</span>Î™Ö
            </div>
        </div>
    </div>
    
    <div class="main-container">
        <!-- ÏôºÏ™Ω: Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§ -->
        <div class="players-panel">
            <div class="players-title">üë• Ï†ëÏÜç Ï§ëÏù∏ ÌîåÎ†àÏù¥Ïñ¥</div>
            <div id="playersList"></div>
        </div>
        
        <!-- Ï§ëÏïô: ÎÇ¥ Í∞ïÌôî -->
        <div class="upgrade-area">
            <div class="my-sword-display">
                <div class="sword-visual" id="mySword">üó°Ô∏è</div>
                <div class="sword-name" id="mySwordName">Ï¥àÎ≥¥ÏûêÏùò Í≤Ä</div>
                <div class="sword-level-display" id="mySwordLevel">+0</div>
                <div class="sword-atk">Í≥µÍ≤©Î†•: <span id="mySwordAtk">100</span></div>
            </div>
            
            <div class="upgrade-panel">
                <div class="prob-section">
                    <div class="prob-title">Í∞ïÌôî ÌôïÎ•†</div>
                    <div class="prob-bar" id="probBar">
                        <div class="prob-segment success" style="width: 95%">95%</div>
                        <div class="prob-segment fail" style="width: 5%">5%</div>
                    </div>
                    <div class="prob-legend">
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #4ecdc4"></div>
                            <span>ÏÑ±Í≥µ</span>
                        </div>
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #ffa502"></div>
                            <span>Ïã§Ìå®</span>
                        </div>
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #a55eea"></div>
                            <span>ÌïòÎùΩ</span>
                        </div>
                        <div class="prob-legend-item">
                            <div class="prob-dot" style="background: #ff6b6b"></div>
                            <span>ÌååÍ¥¥</span>
                        </div>
                    </div>
                </div>
                
                <div class="cost-section">
                    <div class="cost-label">Í∞ïÌôî ÎπÑÏö©</div>
                    <div class="cost-value" id="upgradeCost">üí∞ 1,000</div>
                </div>
                
                <div class="options-section">
                    <div class="option-row" id="safeRow" onclick="toggleCheck('safeCheck')">
                        <div class="option-left">
                            <input type="checkbox" id="safeCheck" onclick="event.stopPropagation()">
                            <span class="option-name">üõ°Ô∏è ÌååÍ¥¥ Î∞©ÏßÄ</span>
                        </div>
                        <span class="option-cost" id="safeCost">+500</span>
                    </div>
                    <div class="option-row" id="catchRow" onclick="toggleCheck('catchCheck')">
                        <div class="option-left">
                            <input type="checkbox" id="catchCheck" onclick="event.stopPropagation()">
                            <span class="option-name">ü™§ ÌïòÎùΩ Î∞©ÏßÄ</span>
                        </div>
                        <span class="option-cost" id="catchCost">+300</span>
                    </div>
                </div>
                
                <button class="upgrade-btn" id="upgradeBtn" onclick="upgrade()">
                    ‚öíÔ∏è Í∞ïÌôîÌïòÍ∏∞
                </button>
                
                <div class="sell-section">
                    <div class="sell-info">
                        <span class="sell-label">ÌåêÎß§ Í∞ÄÍ≤©</span>
                        <span class="sell-price" id="sellPrice">üí∞ 0</span>
                    </div>
                    <button class="sell-btn" id="sellBtn" onclick="sellSword()">
                        üíé Í≤Ä ÌåêÎß§ÌïòÍ∏∞
                    </button>
                </div>
                
                <button class="new-sword-btn" onclick="newSword()">
                    üó°Ô∏è ÏÉà Í≤Ä Íµ¨Îß§ (1,000G)
                </button>
            </div>
        </div>
        
        <!-- Ïò§Î•∏Ï™Ω: ÏàúÏúÑ & Ï±ÑÌåÖ -->
        <div class="side-panel">
            <div class="leaderboard">
                <div class="leaderboard-title">üèÜ Ïã§ÏãúÍ∞Ñ ÏàúÏúÑ</div>
                <div id="leaderboardList"></div>
            </div>
            
            <div class="chat-section">
                <div class="chat-title">üí¨ Ï±ÑÌåÖ</div>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Î©îÏãúÏßÄ ÏûÖÎ†•..." maxlength="100">
                    <button onclick="sendChat()">Ï†ÑÏÜ°</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="particles" id="particles"></div>

<script>
    // Í≤åÏûÑ ÏÉÅÌÉú
    let myId = null;
    let myName = '';
    let players = {};
    let myState = {
        level: 0,
        gold: 50000,  // ÏãúÏûë Í≥®Îìú ÎäòÎ¶º
        maxLevel: 0,
        destroyed: false,
        upgrading: false,
        totalSold: 0,
        swordsSold: 0
    };
    
    // ÌôïÎ•† ÌÖåÏù¥Î∏î (Ïâ¨Ïö¥ Î≤ÑÏ†Ñ)
    const probTable = [
        { success: 100, fail: 0, down: 0, destroy: 0 },   // +0 ‚Üí +1 (100%)
        { success: 100, fail: 0, down: 0, destroy: 0 },   // +1 ‚Üí +2 (100%)
        { success: 95, fail: 5, down: 0, destroy: 0 },    // +2 ‚Üí +3
        { success: 95, fail: 5, down: 0, destroy: 0 },    // +3 ‚Üí +4
        { success: 90, fail: 10, down: 0, destroy: 0 },   // +4 ‚Üí +5
        { success: 85, fail: 15, down: 0, destroy: 0 },   // +5 ‚Üí +6
        { success: 80, fail: 20, down: 0, destroy: 0 },   // +6 ‚Üí +7
        { success: 75, fail: 25, down: 0, destroy: 0 },   // +7 ‚Üí +8
        { success: 70, fail: 25, down: 5, destroy: 0 },   // +8 ‚Üí +9
        { success: 65, fail: 25, down: 10, destroy: 0 },  // +9 ‚Üí +10
        { success: 60, fail: 25, down: 13, destroy: 2 },  // +10 ‚Üí +11
        { success: 55, fail: 25, down: 15, destroy: 5 },  // +11 ‚Üí +12
        { success: 50, fail: 25, down: 17, destroy: 8 },  // +12 ‚Üí +13
        { success: 45, fail: 25, down: 18, destroy: 12 }, // +13 ‚Üí +14
        { success: 40, fail: 25, down: 20, destroy: 15 }, // +14 ‚Üí +15
        { success: 35, fail: 25, down: 22, destroy: 18 }, // +15 ‚Üí +16
        { success: 30, fail: 25, down: 23, destroy: 22 }, // +16 ‚Üí +17
        { success: 25, fail: 25, down: 25, destroy: 25 }, // +17 ‚Üí +18
        { success: 22, fail: 23, down: 25, destroy: 30 }, // +18 ‚Üí +19
        { success: 20, fail: 22, down: 25, destroy: 33 }, // +19 ‚Üí +20
        { success: 18, fail: 22, down: 25, destroy: 35 }, // +20 ‚Üí +21
        { success: 15, fail: 20, down: 25, destroy: 40 }, // +21 ‚Üí +22
        { success: 12, fail: 18, down: 25, destroy: 45 }, // +22 ‚Üí +23
        { success: 10, fail: 15, down: 25, destroy: 50 }, // +23 ‚Üí +24
        { success: 8, fail: 12, down: 25, destroy: 55 },  // +24 ‚Üí +25
    ];
    
    const swordNames = {
        0: "Ï¥àÎ≥¥ÏûêÏùò Í≤Ä",
        5: "ÏàòÎ†®ÏûêÏùò Í≤Ä",
        10: "ÏàôÎ†®ÏûêÏùò Í≤Ä",
        15: "Îã¨Ïù∏Ïùò Í≤Ä",
        20: "Ï†ÑÏÑ§Ïùò Í≤Ä",
        25: "Ïã†ÌôîÏùò Í≤Ä"
    };
    
    // Î†àÎ≤®Î≥Ñ Í≤Ä Ïù¥Î™®ÏßÄ/Ïù¥ÎØ∏ÏßÄ
    // ÌîåÎ†àÏù¥Ïñ¥Î≥Ñ Í≤Ä ÏÉâÏÉÅ Ï†ÄÏû•
    let mySwordColor = null;
    
    // ÎûúÎç§ ÏÉâÏÉÅ ÌåîÎ†àÌä∏
    const swordColorPalettes = [
        { name: 'ruby', primary: '#E53935', secondary: '#FF8A80', accent: '#B71C1C' },
        { name: 'sapphire', primary: '#1E88E5', secondary: '#82B1FF', accent: '#0D47A1' },
        { name: 'emerald', primary: '#43A047', secondary: '#69F0AE', accent: '#1B5E20' },
        { name: 'amethyst', primary: '#8E24AA', secondary: '#EA80FC', accent: '#4A148C' },
        { name: 'topaz', primary: '#FB8C00', secondary: '#FFD180', accent: '#E65100' },
        { name: 'diamond', primary: '#90CAF9', secondary: '#FFFFFF', accent: '#42A5F5' },
        { name: 'obsidian', primary: '#37474F', secondary: '#78909C', accent: '#263238' },
        { name: 'gold', primary: '#FFD700', secondary: '#FFF8DC', accent: '#B8860B' },
        { name: 'rose', primary: '#EC407A', secondary: '#FF80AB', accent: '#AD1457' },
        { name: 'cyan', primary: '#00BCD4', secondary: '#84FFFF', accent: '#006064' },
    ];
    
    function getRandomSwordColor() {
        return swordColorPalettes[Math.floor(Math.random() * swordColorPalettes.length)];
    }
    
    // Î†àÎ≤®Î≥Ñ SVG Í≤Ä Ïù¥ÎØ∏ÏßÄ - Í≥†ÌÄÑÎ¶¨Ìã∞ Î≤ÑÏ†Ñ
    function getSwordSVG(level, size = 120, colorOverride = null) {
        const uid = Math.random().toString(36).substr(2, 9);
        const color = colorOverride || mySwordColor || getRandomSwordColor();
        
        // +25 Ïã†ÌôîÏùò Í≤Ä - Ï≤úÏÉÅÏùò Ìô©Í∏àÍ≤Ä
        if (level >= 25) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="b25_${uid}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="${color.secondary}"/>
                        <stop offset="25%" stop-color="${color.primary}"/>
                        <stop offset="50%" stop-color="#FFFFFF"/>
                        <stop offset="75%" stop-color="${color.primary}"/>
                        <stop offset="100%" stop-color="${color.secondary}"/>
                    </linearGradient>
                    <linearGradient id="h25_${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#DAA520"/>
                        <stop offset="50%" stop-color="#8B4513"/>
                        <stop offset="100%" stop-color="#4A2810"/>
                    </linearGradient>
                    <filter id="g25_${uid}"><feGaussianBlur stdDeviation="2"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <!-- ÌõÑÍ¥ë -->
                <ellipse cx="50" cy="40" rx="35" ry="40" fill="url(#r25_${uid})" opacity="0.6">
                    <animate attributeName="opacity" values="0.4;0.7;0.4" dur="2s" repeatCount="indefinite"/>
                </ellipse>
                <radialGradient id="r25_${uid}"><stop offset="0%" stop-color="${color.primary}" stop-opacity="0.8"/><stop offset="100%" stop-color="${color.accent}" stop-opacity="0"/></radialGradient>
                
                <g filter="url(#g25_${uid})">
                    <!-- Î∏îÎ†àÏù¥Îìú Ïô∏Í≥Ω -->
                    <path d="M50,2 L42,8 L40,42 L44,48 L50,52 L56,48 L60,42 L58,8 Z" fill="url(#b25_${uid})" stroke="${color.accent}" stroke-width="0.5"/>
                    <!-- Î∏îÎ†àÏù¥Îìú Ï§ëÏïô Í∑∏Î£®Î∏å -->
                    <path d="M50,6 L48,40 L50,46 L52,40 Z" fill="rgba(255,255,255,0.4)"/>
                    <!-- Î∏îÎ†àÏù¥Îìú Ïó£ÏßÄ ÌïòÏù¥ÎùºÏù¥Ìä∏ -->
                    <path d="M42,8 L40,42 L44,48" fill="none" stroke="rgba(255,255,255,0.6)" stroke-width="1"/>
                    
                    <!-- Í∞ÄÎìú - Ï≤úÏÇ¨ ÎÇ†Í∞úÌòï -->
                    <path d="M20,48 Q30,40 40,46 L44,50 L40,54 Q30,58 22,52 Z" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                    <path d="M80,48 Q70,40 60,46 L56,50 L60,54 Q70,58 78,52 Z" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                    <ellipse cx="50" cy="50" rx="8" ry="4" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                    
                    <!-- Ï§ëÏïô Î≥¥ÏÑù -->
                    <circle cx="50" cy="50" r="5" fill="${color.primary}"/>
                    <circle cx="50" cy="50" r="4" fill="${color.secondary}"/>
                    <circle cx="48" cy="48" r="1.5" fill="#FFFFFF" opacity="0.8"/>
                    <circle cx="50" cy="50" r="5" fill="none" stroke="#FFD700" stroke-width="1">
                        <animate attributeName="r" values="5;6;5" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="1;0.5;1" dur="1s" repeatCount="indefinite"/>
                    </circle>
                    
                    <!-- ÏÜêÏû°Ïù¥ -->
                    <rect x="46" y="54" width="8" height="24" rx="1" fill="url(#h25_${uid})"/>
                    <rect x="44" y="58" width="12" height="2" rx="1" fill="#FFD700"/>
                    <rect x="44" y="64" width="12" height="2" rx="1" fill="#FFD700"/>
                    <rect x="44" y="70" width="12" height="2" rx="1" fill="#FFD700"/>
                    
                    <!-- ÌèºÎ©ú - ÏôïÍ¥Ä -->
                    <path d="M42,78 L44,84 L46,80 L48,86 L50,82 L52,86 L54,80 L56,84 L58,78 Q50,82 42,78" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                    <circle cx="50" cy="80" r="2" fill="${color.primary}"/>
                </g>
                
                <!-- ÎßàÎ≤ï ÌååÌã∞ÌÅ¥ -->
                <circle cx="30" cy="25" r="2" fill="${color.primary}"><animate attributeName="cy" values="25;5;25" dur="3s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="3s" repeatCount="indefinite"/></circle>
                <circle cx="70" cy="20" r="1.5" fill="${color.secondary}"><animate attributeName="cy" values="20;0;20" dur="2.5s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="2.5s" repeatCount="indefinite"/></circle>
                <circle cx="40" cy="15" r="1" fill="${color.secondary}"><animate attributeName="cy" values="15;-5;15" dur="2.8s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="2.8s" repeatCount="indefinite"/></circle>
                <circle cx="60" cy="30" r="1.5" fill="${color.primary}"><animate attributeName="cy" values="30;10;30" dur="2.2s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0;1" dur="2.2s" repeatCount="indefinite"/></circle>
            </svg>`;
        }
        
        // +20 Ï†ÑÏÑ§Ïùò Í≤Ä - ÎßàÎ≤ïÏùò ÌÅ¨Î¶¨Ïä§ÌÉà ÏÜåÎìú
        if (level >= 20) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="b20_${uid}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="${color.secondary}"/>
                        <stop offset="30%" stop-color="${color.primary}"/>
                        <stop offset="50%" stop-color="#FFFFFF"/>
                        <stop offset="70%" stop-color="${color.primary}"/>
                        <stop offset="100%" stop-color="${color.secondary}"/>
                    </linearGradient>
                    <linearGradient id="h20_${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="${color.accent}"/>
                        <stop offset="100%" stop-color="#1a1a1a"/>
                    </linearGradient>
                    <filter id="g20_${uid}"><feGaussianBlur stdDeviation="1.5"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <ellipse cx="50" cy="35" rx="25" ry="35" fill="${color.primary}" opacity="0.15">
                    <animate attributeName="opacity" values="0.1;0.25;0.1" dur="2s" repeatCount="indefinite"/>
                </ellipse>
                <g filter="url(#g20_${uid})">
                    <!-- ÌÅ¨Î¶¨Ïä§ÌÉà Î∏îÎ†àÏù¥Îìú -->
                    <path d="M50,3 L44,10 L42,45 L46,50 L50,54 L54,50 L58,45 L56,10 Z" fill="url(#b20_${uid})" stroke="${color.accent}" stroke-width="0.5"/>
                    <path d="M50,8 L48,42 L50,48 L52,42 Z" fill="rgba(255,255,255,0.5)"/>
                    <path d="M44,10 L42,45 L46,50" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1"/>
                    
                    <!-- Í∞ÄÎìú - ÌÅ¨Î¶¨Ïä§ÌÉàÌòï -->
                    <path d="M28,48 L38,44 L44,50 L38,56 L28,52 Z" fill="#C0C0C0" stroke="#808080" stroke-width="0.5"/>
                    <path d="M72,48 L62,44 L56,50 L62,56 L72,52 Z" fill="#C0C0C0" stroke="#808080" stroke-width="0.5"/>
                    <ellipse cx="50" cy="52" rx="10" ry="4" fill="#C0C0C0" stroke="#808080" stroke-width="0.5"/>
                    
                    <!-- Î≥¥ÏÑù -->
                    <circle cx="50" cy="52" r="4" fill="${color.primary}"/>
                    <circle cx="50" cy="52" r="3" fill="${color.secondary}"/>
                    <circle cx="48" cy="50" r="1" fill="#FFFFFF" opacity="0.8"/>
                    
                    <!-- ÏÜêÏû°Ïù¥ -->
                    <rect x="46" y="56" width="8" height="20" rx="1" fill="url(#h20_${uid})"/>
                    <rect x="44" y="60" width="12" height="2" rx="1" fill="${color.primary}"/>
                    <rect x="44" y="66" width="12" height="2" rx="1" fill="${color.primary}"/>
                    
                    <!-- ÌèºÎ©ú -->
                    <ellipse cx="50" cy="78" rx="6" ry="4" fill="${color.accent}" stroke="#333" stroke-width="0.5"/>
                    <circle cx="50" cy="78" r="2" fill="${color.primary}"/>
                </g>
            </svg>`;
        }
        
        // +15 Îã¨Ïù∏Ïùò Í≤Ä - Î£¨ ÏÜåÎìú
        if (level >= 15) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="b15_${uid}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="${color.primary}"/>
                        <stop offset="50%" stop-color="${color.secondary}"/>
                        <stop offset="100%" stop-color="${color.primary}"/>
                    </linearGradient>
                    <linearGradient id="h15_${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#1E3A5F"/>
                        <stop offset="100%" stop-color="#0F1C2E"/>
                    </linearGradient>
                    <filter id="g15_${uid}"><feGaussianBlur stdDeviation="1"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <g filter="url(#g15_${uid})">
                    <!-- Î∏îÎ†àÏù¥Îìú -->
                    <path d="M50,5 L45,12 L43,46 L47,52 L50,55 L53,52 L57,46 L55,12 Z" fill="url(#b15_${uid})" stroke="${color.accent}" stroke-width="0.5"/>
                    <path d="M50,10 L48,44 L50,50 L52,44 Z" fill="rgba(255,255,255,0.3)"/>
                    <!-- Î£¨ Î¨∏Ïñë -->
                    <path d="M48,20 L52,20 M50,18 L50,28 M48,25 L52,25" stroke="${color.secondary}" stroke-width="0.8" fill="none" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                    </path>
                    <path d="M48,32 L52,32 M50,30 L50,38" stroke="${color.secondary}" stroke-width="0.8" fill="none" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Í∞ÄÎìú -->
                    <rect x="32" y="52" width="36" height="5" rx="2" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                    <circle cx="35" cy="54.5" r="2" fill="${color.primary}"/>
                    <circle cx="65" cy="54.5" r="2" fill="${color.primary}"/>
                    
                    <!-- Î≥¥ÏÑù -->
                    <circle cx="50" cy="54" r="3.5" fill="${color.primary}"/>
                    <circle cx="48.5" cy="52.5" r="1" fill="#FFFFFF" opacity="0.7"/>
                    
                    <!-- ÏÜêÏû°Ïù¥ -->
                    <rect x="46" y="57" width="8" height="18" rx="1" fill="url(#h15_${uid})"/>
                    <path d="M46,61 L54,61 M46,65 L54,65 M46,69 L54,69" stroke="#FFD700" stroke-width="1.5"/>
                    
                    <!-- ÌèºÎ©ú -->
                    <ellipse cx="50" cy="77" rx="5" ry="3" fill="#FFD700" stroke="#B8860B" stroke-width="0.5"/>
                </g>
            </svg>`;
        }
        
        // +10 ÏàôÎ†®ÏûêÏùò Í≤Ä - Í∞ïÏ≤† Î°±ÏÜåÎìú
        if (level >= 10) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="b10_${uid}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="${color.primary}"/>
                        <stop offset="50%" stop-color="${color.secondary}"/>
                        <stop offset="100%" stop-color="${color.primary}"/>
                    </linearGradient>
                    <linearGradient id="h10_${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#78350F"/>
                        <stop offset="100%" stop-color="#451A03"/>
                    </linearGradient>
                    <filter id="g10_${uid}"><feGaussianBlur stdDeviation="0.8"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <g filter="url(#g10_${uid})">
                    <!-- Î∏îÎ†àÏù¥Îìú -->
                    <path d="M50,8 L46,14 L44,48 L48,53 L50,56 L52,53 L56,48 L54,14 Z" fill="url(#b10_${uid})" stroke="${color.accent}" stroke-width="0.5"/>
                    <path d="M50,12 L48,46 L50,52 L52,46 Z" fill="rgba(255,255,255,0.3)"/>
                    
                    <!-- Í∞ÄÎìú -->
                    <rect x="36" y="54" width="28" height="4" rx="1" fill="#9CA3AF" stroke="#6B7280" stroke-width="0.5"/>
                    
                    <!-- Î≥¥ÏÑù -->
                    <circle cx="50" cy="56" r="3" fill="${color.primary}"/>
                    <circle cx="48.5" cy="54.5" r="1" fill="#FFFFFF" opacity="0.6"/>
                    
                    <!-- ÏÜêÏû°Ïù¥ -->
                    <rect x="46" y="58" width="8" height="16" rx="1" fill="url(#h10_${uid})"/>
                    <path d="M46,62 L54,62 M46,66 L54,66 M46,70 L54,70" stroke="#92400E" stroke-width="1"/>
                    
                    <!-- ÌèºÎ©ú -->
                    <circle cx="50" cy="76" r="4" fill="#9CA3AF" stroke="#6B7280" stroke-width="0.5"/>
                </g>
            </svg>`;
        }
        
        // +5 ÏàòÎ†®ÏûêÏùò Í≤Ä - Ï≤≠ÎèôÍ≤Ä
        if (level >= 5) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="b5_${uid}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="${color.primary}"/>
                        <stop offset="50%" stop-color="${color.secondary}"/>
                        <stop offset="100%" stop-color="${color.primary}"/>
                    </linearGradient>
                    <linearGradient id="h5_${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#5D4037"/>
                        <stop offset="100%" stop-color="#3E2723"/>
                    </linearGradient>
                </defs>
                <!-- Î∏îÎ†àÏù¥Îìú -->
                <path d="M50,10 L46,16 L45,50 L48,54 L50,57 L52,54 L55,50 L54,16 Z" fill="url(#b5_${uid})" stroke="${color.accent}" stroke-width="0.5"/>
                <path d="M50,14 L48,48 L50,53 L52,48 Z" fill="rgba(255,255,255,0.25)"/>
                
                <!-- Í∞ÄÎìú -->
                <rect x="38" y="55" width="24" height="4" rx="1" fill="#92400E" stroke="#78350F" stroke-width="0.5"/>
                
                <!-- Î≥¥ÏÑù -->
                <circle cx="50" cy="57" r="2.5" fill="${color.primary}"/>
                
                <!-- ÏÜêÏû°Ïù¥ -->
                <rect x="46" y="59" width="8" height="14" rx="1" fill="url(#h5_${uid})"/>
                <path d="M46,63 L54,63 M46,67 L54,67" stroke="#8B5A2B" stroke-width="1"/>
                
                <!-- ÌèºÎ©ú -->
                <circle cx="50" cy="75" r="3.5" fill="#92400E" stroke="#78350F" stroke-width="0.5"/>
            </svg>`;
        }
        
        // +0 Í∏∞Î≥∏ Í≤Ä - ÎÇ°ÏùÄ Ï≤†Í≤Ä
        return `<svg width="${size}" height="${size}" viewBox="0 0 100 100">
            <defs>
                <linearGradient id="b0_${uid}" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#9CA3AF"/>
                    <stop offset="50%" stop-color="#D1D5DB"/>
                    <stop offset="100%" stop-color="#9CA3AF"/>
                </linearGradient>
                <linearGradient id="h0_${uid}" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#6B5344"/>
                    <stop offset="100%" stop-color="#3D2E24"/>
                </linearGradient>
            </defs>
            <!-- Î∏îÎ†àÏù¥Îìú -->
            <path d="M50,15 L47,20 L46,52 L48,55 L50,58 L52,55 L54,52 L53,20 Z" fill="url(#b0_${uid})" stroke="#6B7280" stroke-width="0.5"/>
            <path d="M50,18 L49,50 L50,54 L51,50 Z" fill="rgba(255,255,255,0.2)"/>
            
            <!-- Í∞ÄÎìú -->
            <rect x="40" y="56" width="20" height="3" rx="1" fill="#78716C" stroke="#57534E" stroke-width="0.5"/>
            
            <!-- ÏÜêÏû°Ïù¥ -->
            <rect x="46" y="59" width="8" height="12" rx="1" fill="url(#h0_${uid})"/>
            <path d="M46,63 L54,63 M46,67 L54,67" stroke="#5D4E42" stroke-width="1"/>
            
            <!-- ÌèºÎ©ú -->
            <circle cx="50" cy="73" r="3" fill="#78716C" stroke="#57534E" stroke-width="0.5"/>
        </svg>`;
    }
    
    function getSwordIcon(level) {
        return getSwordSVG(level, 120);
    }
    
    function getSwordIconSmall(level) {
        return getSwordSVG(level, 28);
    }
    
    function getSwordStyle(level) {
        return ""; // SVGÏóêÏÑú ÏßÅÏ†ë Ï≤òÎ¶¨
    }
    
    const aiNames = ['Í≤ÄÏà†ÏÇ¨', 'ÎåÄÏû•Ïû•Ïù¥', 'Î™®ÌóòÍ∞Ä', 'Í∏∞ÏÇ¨Îã®Ïû•', 'Ïö©ÏÇ¨', 'ÎßàÍ≤ÄÏÇ¨', 'ÏÑ±Í∏∞ÏÇ¨', 'ÏïîÏÇ¥Ïûê', 'Í≤ÄÍ∑Ä', 'ÎèÑÍ≤ÄÏû•Ïù∏', 'Ï¥àÎ≥¥Ïûê', 'Í≤ÄÌò∏', 'Î¨¥Î¶ºÍ≥†Ïàò', 'ÎèÑÏ†Å', 'Ï†ÑÏÇ¨', 'Í¥ëÏ†ÑÏÇ¨', 'ÎìÄÏñºÎ¶¨Ïä§Ìä∏', 'Í≤ÄÏÑ±', 'ÏÜåÎìúÎßàÏä§ÌÑ∞', 'Î∏îÎ†àÏù¥Îìú'];
    
    // AI ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ± (Ï≤òÏùåÏóêÎäî Ï†ÅÍ≤å, Ï†êÏ†ê ÎäòÏñ¥ÎÇ®)
    function initAIPlayers() {
        const count = 3 + Math.floor(Math.random() * 3); // Ï≤òÏùå 3~5Î™Ö
        for (let i = 0; i < count; i++) {
            addAIPlayer();
        }
    }
    
    function addAIPlayer() {
        const id = 'ai_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
        players[id] = {
            name: aiNames[Math.floor(Math.random() * aiNames.length)] + Math.floor(Math.random() * 1000),
            level: Math.floor(Math.random() * 12),
            maxLevel: 0,
            destroyed: false,
            status: '',
            statusType: '',
            isAI: true,
            lastAction: Date.now() - Math.random() * 3000,
            swordColor: getRandomSwordColor()
        };
        players[id].maxLevel = players[id].level;
        return players[id].name;
    }
    
    // Í∞ÄÎÅî ÏÉà ÌîåÎ†àÏù¥Ïñ¥ ÏûÖÏû•
    function randomPlayerJoin() {
        if (Object.keys(players).length < 30 && Math.random() < 0.3) {
            const name = addAIPlayer();
            addChat('system', `${name}ÎãòÏù¥ ÏûÖÏû•ÌñàÏäµÎãàÎã§.`);
            updateUI();
        }
        
        // Í∞ÄÎÅî Ìá¥Ïû•
        const aiList = Object.entries(players).filter(([id, p]) => p.isAI);
        if (aiList.length > 5 && Math.random() < 0.1) {
            const [id, player] = aiList[Math.floor(Math.random() * aiList.length)];
            addChat('system', `${player.name}ÎãòÏù¥ Ìá¥Ïû•ÌñàÏäµÎãàÎã§.`);
            delete players[id];
            updateUI();
        }
    }
    
    // AI ÌñâÎèô
    function aiAction() {
        Object.entries(players).forEach(([id, player]) => {
            if (!player.isAI) return;
            if (Date.now() - player.lastAction < 2000 + Math.random() * 5000) return;
            
            player.lastAction = Date.now();
            
            // ÌååÍ¥¥Îêú Í≤ÄÏù¥Î©¥ ÏÉà Í≤Ä Íµ¨Îß§
            if (player.destroyed) {
                if (Math.random() < 0.3) {
                    player.destroyed = false;
                    player.level = 0;
                    player.status = 'ÏÉà Í≤Ä Íµ¨Îß§!';
                    player.statusType = '';
                    addChat('system', `${player.name}ÎãòÏù¥ ÏÉà Í≤ÄÏùÑ Íµ¨Îß§ÌñàÏäµÎãàÎã§.`);
                    setTimeout(() => { player.status = ''; updateUI(); }, 2000);
                }
                return;
            }
            
            // Í∞ÄÎÅî Í≤Ä ÌåêÎß§ (ÎÜíÏùÄ Í∞ïÌôîÏùºÏàòÎ°ù ÌåêÎß§ ÌôïÎ•† Ï¶ùÍ∞Ä)
            if (player.level >= 8 && Math.random() < 0.05 + player.level * 0.01) {
                const sellPrice = getSellPrice(player.level);
                const soldLevel = player.level;
                player.status = `+${soldLevel} ÌåêÎß§! üí∞`;
                player.statusType = 'success';
                player.level = 0;
                addChat('system', `${player.name}ÎãòÏù¥ +${soldLevel} Í≤ÄÏùÑ ${sellPrice.toLocaleString()}GÏóê ÌåêÎß§!`);
                setTimeout(() => { player.status = ''; updateUI(); }, 3000);
                updateUI();
                return;
            }
            
            // Í∞ïÌôî ÏãúÎèÑ
            if (player.level < 25 && Math.random() < 0.4) {
                const probs = probTable[player.level];
                const roll = Math.random() * 100;
                
                // Í∞ïÌôî Ï§ë ÌëúÏãú
                player.status = 'Í∞ïÌôî Ï§ë...';
                player.statusType = 'upgrading';
                updateUI();
                
                setTimeout(() => {
                    let result;
                    if (roll < probs.success) {
                        result = 'success';
                        player.level++;
                        if (player.level > player.maxLevel) player.maxLevel = player.level;
                        // ÏÑ±Í≥µ Ïãú ÎûúÎç§ ÏÉâÏÉÅ Î≥ÄÍ≤Ω
                        player.swordColor = getRandomSwordColor();
                        player.status = `+${player.level} ÏÑ±Í≥µ! ‚ú®`;
                        player.statusType = 'success';
                        addChat('upgrade-success', `${player.name}ÎãòÏù¥ +${player.level} Í∞ïÌôîÏóê ÏÑ±Í≥µ!`);
                    } else if (roll < probs.success + probs.fail) {
                        result = 'fail';
                        player.status = 'Ïã§Ìå® (Ïú†ÏßÄ)';
                        player.statusType = 'fail';
                    } else if (roll < probs.success + probs.fail + probs.down) {
                        result = 'down';
                        player.level = Math.max(0, player.level - 1);
                        player.status = `+${player.level}Î°ú ÌïòÎùΩ üìâ`;
                        player.statusType = 'fail';
                        addChat('upgrade-fail', `${player.name}ÎãòÏùò Í≤ÄÏù¥ +${player.level}Î°ú ÌïòÎùΩ...`);
                    } else {
                        result = 'destroy';
                        player.destroyed = true;
                        player.status = 'üí• ÌååÍ¥¥Îê®!';
                        player.statusType = 'destroy';
                        addChat('upgrade-destroy', `${player.name}ÎãòÏùò +${player.level} Í≤ÄÏù¥ ÌååÍ¥¥ÎêòÏóàÏäµÎãàÎã§!`);
                    }
                    
                    updateUI();
                    
                    setTimeout(() => {
                        player.status = '';
                        player.statusType = '';
                        updateUI();
                    }, 3000);
                }, 800 + Math.random() * 500);
            }
        });
    }
    
    // Í≤åÏûÑ ÏãúÏûë
    function startGame() {
        const nameInput = document.getElementById('nameInput');
        myName = nameInput.value.trim() || 'Í≤ÄÏÇ¨' + Math.floor(Math.random() * 1000);
        myId = 'player_' + Date.now();
        
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        
        initAIPlayers();
        
        addChat('system', `${myName}ÎãòÏù¥ ÏûÖÏû•ÌñàÏäµÎãàÎã§!`);
        
        updateUI();
        
        // AI ÌñâÎèô Î£®ÌîÑ
        setInterval(aiAction, 1000);
        
        // Í∞ÄÎÅî ÌîåÎ†àÏù¥Ïñ¥ ÏûÖÏû•/Ìá¥Ïû•
        setInterval(randomPlayerJoin, 5000);
        
        // Í∞ÄÎÅî AI Ï±ÑÌåÖ
        setInterval(() => {
            const aiList = Object.values(players).filter(p => p.isAI && !p.destroyed);
            if (aiList.length > 0 && Math.random() < 0.1) {
                const ai = aiList[Math.floor(Math.random() * aiList.length)];
                const messages = [
                    'Ïò§ÎäòÏùÄ Ïö¥Ïù¥ Ï¢ãÏùÑ Í≤É Í∞ôÏïÑ!',
                    '+25 Í∞ÄÎ≥¥ÏûêÍ≥†~',
                    'ÌååÍ¥¥Î∞©ÏßÄ ÏºúÏïºÌïòÎÇò...',
                    'ÏïÑ Îòê ÌÑ∞Ïßà Í≤É Í∞ôÏïÑ',
                    'Ïù¥Î≤àÏóî ÏÑ±Í≥µÏù¥Îã§!',
                    'Í∞ïÌôî ÌôïÎ•† ÎÑàÎ¨¥ ÎÇÆÏïÑ...',
                    'ÌïúÎ≤àÎßå Îçî!',
                    'Ïò§Îäò Ïª®ÎîîÏÖò Ï¢ãÎã§',
                ];
                addChat('chat', messages[Math.floor(Math.random() * messages.length)], ai.name);
            }
        }, 8000);
    }
    
    // UI ÏóÖÎç∞Ïù¥Ìä∏
    function updateUI() {
        const probs = myState.level < 25 ? probTable[myState.level] : { success: 0, fail: 100, down: 0, destroy: 0 };
        const cost = getCost(myState.level);
        const bonusAtk = getBonusAtk(myState.level);
        
        // Ìó§Îçî
        document.getElementById('headerGold').textContent = myState.gold.toLocaleString();
        document.getElementById('headerSold').textContent = myState.totalSold.toLocaleString();
        document.getElementById('headerMax').textContent = `+${myState.maxLevel}`;
        document.getElementById('onlineCount').textContent = Object.keys(players).length + 1;
        
        // ÎÇ¥ Í≤Ä
        let swordName = "Ï¥àÎ≥¥ÏûêÏùò Í≤Ä";
        for (const [lv, name] of Object.entries(swordNames)) {
            if (myState.level >= parseInt(lv)) swordName = name;
        }
        
        document.getElementById('mySwordName').textContent = swordName;
        
        // Í≤Ä ÏïÑÏù¥ÏΩò & Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏ (SVG)
        const swordEl = document.getElementById('mySword');
        swordEl.innerHTML = getSwordIcon(myState.level);
        
        const levelEl = document.getElementById('mySwordLevel');
        levelEl.textContent = `+${myState.level}`;
        levelEl.className = myState.level >= 25 ? 'sword-level-display max-level' : 'sword-level-display';
        
        document.getElementById('mySwordAtk').textContent = (100 + bonusAtk).toLocaleString();
        
        // ÌôïÎ•† Î∞î
        const probBar = document.getElementById('probBar');
        probBar.innerHTML = `
            <div class="prob-segment success" style="width: ${probs.success}%">${probs.success > 8 ? probs.success + '%' : ''}</div>
            <div class="prob-segment fail" style="width: ${probs.fail}%">${probs.fail > 8 ? probs.fail + '%' : ''}</div>
            <div class="prob-segment down" style="width: ${probs.down}%">${probs.down > 8 ? probs.down + '%' : ''}</div>
            <div class="prob-segment destroy" style="width: ${probs.destroy}%">${probs.destroy > 8 ? probs.destroy + '%' : ''}</div>
        `;
        
        // ÎπÑÏö©
        const safeCheck = document.getElementById('safeCheck').checked;
        const catchCheck = document.getElementById('catchCheck').checked;
        let totalCost = cost;
        if (safeCheck && probs.destroy > 0) totalCost += Math.floor(cost * 2.0);  // ÌååÍ¥¥ Î∞©ÏßÄ: 200%
        if (catchCheck && probs.down > 0) totalCost += Math.floor(cost * 1.5);    // ÌïòÎùΩ Î∞©ÏßÄ: 150%
        
        document.getElementById('upgradeCost').textContent = `üí∞ ${totalCost.toLocaleString()}`;
        document.getElementById('safeCost').textContent = `+${Math.floor(cost * 2.0).toLocaleString()}`;
        document.getElementById('catchCost').textContent = `+${Math.floor(cost * 1.5).toLocaleString()}`;
        
        document.getElementById('safeRow').classList.toggle('disabled', probs.destroy === 0);
        document.getElementById('catchRow').classList.toggle('disabled', probs.down === 0);
        
        // ÌåêÎß§ Í∞ÄÍ≤© & Î≤ÑÌäº
        const sellPrice = getSellPrice(myState.level);
        document.getElementById('sellPrice').textContent = `üí∞ ${sellPrice.toLocaleString()}`;
        
        const sellBtn = document.getElementById('sellBtn');
        if (myState.destroyed) {
            sellBtn.disabled = true;
            sellBtn.textContent = 'üíÄ ÌååÍ¥¥Îêú Í≤Ä';
        } else if (myState.level === 0) {
            sellBtn.disabled = true;
            sellBtn.textContent = 'üì¶ ÌåêÎß§Ìï† Ïàò ÏóÜÏùå';
        } else {
            sellBtn.disabled = false;
            sellBtn.textContent = `üíé +${myState.level} Í≤Ä ÌåêÎß§ÌïòÍ∏∞`;
        }
        
        // Î≤ÑÌäº
        const btn = document.getElementById('upgradeBtn');
        if (myState.destroyed) {
            btn.disabled = true;
            btn.textContent = 'üíÄ ÌååÍ¥¥Îê®';
        } else if (myState.level >= 25) {
            btn.disabled = true;
            btn.textContent = 'üéâ ÏµúÎåÄ Í∞ïÌôî!';
        } else if (myState.gold < totalCost) {
            btn.disabled = true;
            btn.textContent = 'üí∏ Í≥®Îìú Î∂ÄÏ°±';
        } else if (myState.upgrading) {
            btn.disabled = true;
            btn.textContent = '‚è≥ Í∞ïÌôî Ï§ë...';
        } else {
            btn.disabled = false;
            btn.textContent = '‚öíÔ∏è Í∞ïÌôîÌïòÍ∏∞';
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥ Î™©Î°ù
        const playersList = document.getElementById('playersList');
        playersList.innerHTML = Object.entries(players).map(([id, p]) => `
            <div class="player-card ${p.statusType}">
                <div class="player-header">
                    <span class="player-name">${p.name}</span>
                    <span class="player-level">${p.destroyed ? 'üíÄ' : '+' + p.level}</span>
                </div>
                <div class="player-sword">
                    <span class="player-sword-icon">${p.destroyed ? 'üíî' : getSwordSVG(p.level, 28, p.swordColor)}</span>
                    <span>${p.destroyed ? 'ÌååÍ¥¥Îê®' : getSwordName(p.level)}</span>
                </div>
                <div class="player-status ${p.statusType}">${p.status}</div>
            </div>
        `).join('');
        
        // Î¶¨ÎçîÎ≥¥Îìú
        const allPlayers = [
            { name: myName, level: myState.level, isMe: true, destroyed: myState.destroyed },
            ...Object.values(players).map(p => ({ name: p.name, level: p.level, destroyed: p.destroyed }))
        ];
        allPlayers.sort((a, b) => b.level - a.level);
        
        const leaderboardList = document.getElementById('leaderboardList');
        leaderboardList.innerHTML = allPlayers.slice(0, 5).map((p, i) => {
            const rankClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
            return `
                <div class="leaderboard-item ${p.isMe ? 'me' : ''}">
                    <span class="leaderboard-rank ${rankClass}">${i + 1}</span>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${p.name}${p.isMe ? ' (ÎÇò)' : ''}</div>
                    </div>
                    <span class="leaderboard-level">${p.destroyed ? 'üíÄ' : '+' + p.level}</span>
                </div>
            `;
        }).join('');
    }
    
    function getSwordName(level) {
        let name = "Ï¥àÎ≥¥ÏûêÏùò Í≤Ä";
        for (const [lv, n] of Object.entries(swordNames)) {
            if (level >= parseInt(lv)) name = n;
        }
        return name;
    }
    
    function getCost(level) {
        return Math.floor(500 * Math.pow(1.3, level));  // ÎπÑÏö© ÎÇÆÏ∂§
    }
    
    function getBonusAtk(level) {
        let bonus = 0;
        for (let i = 1; i <= level; i++) {
            bonus += Math.floor(10 * Math.pow(1.15, i));
        }
        return bonus;
    }
    
    // ÌåêÎß§ Í∞ÄÍ≤© Í≥ÑÏÇ∞ (Ìù¨Í∑ÄÎèÑ Í∏∞Î∞ò, ÏôÑÎßåÌïú Ï¶ùÍ∞Ä)
    function getSellPrice(level) {
        if (level === 0) return 0;
        
        // 1. ÎàÑÏ†Å Í∞ïÌôîÎπÑÏö©
        let minCost = 0;
        for (let i = 0; i < level; i++) {
            minCost += getCost(i);
        }
        
        // 2. Ìù¨Í∑ÄÎèÑ Í≥ÑÏÇ∞ (Ìï¥Îãπ Î†àÎ≤®ÍπåÏßÄ ÎèÑÎã¨Ìï† ÌôïÎ•†)
        let probability = 1;
        for (let i = 0; i < level; i++) {
            probability *= probTable[i].success / 100;
        }
        
        // 3. Ìù¨Í∑ÄÎèÑ Î∞∞Ïú® (Î°úÍ∑∏Î°ú ÏôÑÎßåÌïòÍ≤å)
        // ÌôïÎ•† 100% = 1.2Î∞∞, 10% = 2Î∞∞, 1% = 2.8Î∞∞, 0.1% = 3.6Î∞∞
        const rarityMultiplier = 1.2 + Math.log10(1 / probability) * 0.8;
        
        // 4. ÏµúÏ¢Ö Í∞ÄÍ≤© = ÎàÑÏ†ÅÎπÑÏö© √ó Ìù¨Í∑ÄÎèÑÎ∞∞Ïú®
        const price = Math.floor(minCost * Math.max(1.2, rarityMultiplier));
        
        return price;
    }
    
    // Í≤Ä ÌåêÎß§
    function sellSword() {
        if (myState.destroyed || myState.level === 0) return;
        
        const price = getSellPrice(myState.level);
        const soldLevel = myState.level;
        
        myState.gold += price;
        myState.totalSold += price;
        myState.swordsSold++;
        myState.level = 0;
        
        // ÌåêÎß§ Ìö®Í≥º
        const sword = document.getElementById('mySword');
        sword.style.transition = 'all 0.3s';
        sword.style.transform = 'scale(0)';
        sword.style.opacity = '0';
        
        setTimeout(() => {
            sword.style.transform = 'scale(1)';
            sword.style.opacity = '1';
        }, 300);
        
        createParticles('#ffd700', 25);
        showResult('success', `üí∞ ÌåêÎß§ ÏôÑÎ£å!<br>+${price.toLocaleString()}G`);
        addChat('system', `${myName}ÎãòÏù¥ +${soldLevel} Í≤ÄÏùÑ ${price.toLocaleString()}GÏóê ÌåêÎß§ÌñàÏäµÎãàÎã§!`);
        
        updateUI();
    }
    
    // Í∞ïÌôî
    async function upgrade() {
        if (myState.destroyed || myState.level >= 25 || myState.upgrading) return;
        
        const probs = probTable[myState.level];
        const cost = getCost(myState.level);
        
        const safeCheck = document.getElementById('safeCheck').checked && probs.destroy > 0;
        const catchCheck = document.getElementById('catchCheck').checked && probs.down > 0;
        
        let totalCost = cost;
        if (safeCheck) totalCost += Math.floor(cost * 2.0);  // ÌååÍ¥¥ Î∞©ÏßÄ: 200%
        if (catchCheck) totalCost += Math.floor(cost * 1.5); // ÌïòÎùΩ Î∞©ÏßÄ: 150%
        
        if (myState.gold < totalCost) return;
        
        myState.gold -= totalCost;
        myState.upgrading = true;
        updateUI();
        
        // Ïï†ÎãàÎ©îÏù¥ÏÖò
        const sword = document.getElementById('mySword');
        sword.classList.add('shaking');
        
        await new Promise(r => setTimeout(r, 800));
        
        sword.classList.remove('shaking');
        
        // ÌôïÎ•† Í≥ÑÏÇ∞
        const roll = Math.random() * 100;
        let result;
        
        if (roll < probs.success) {
            result = 'success';
        } else if (roll < probs.success + probs.fail) {
            result = 'fail';
        } else if (roll < probs.success + probs.fail + probs.down) {
            // ÌïòÎùΩ Íµ¨Í∞Ñ
            result = catchCheck ? 'fail' : 'down';
        } else {
            // ÌååÍ¥¥ Íµ¨Í∞Ñ
            if (safeCheck) {
                // ÌååÍ¥¥ Î∞©ÏßÄ ‚Üí ÌïòÎùΩÏúºÎ°ú Î≥ÄÌôò, Í∑ºÎç∞ ÌïòÎùΩ Î∞©ÏßÄÎèÑ ÏºúÏ†∏ÏûàÏúºÎ©¥ Ïú†ÏßÄ
                result = catchCheck ? 'fail' : 'down';
            } else {
                result = 'destroy';
            }
        }
        
        // Í≤∞Í≥º Ï≤òÎ¶¨
        const oldLevel = myState.level;
        
        switch (result) {
            case 'success':
                myState.level++;
                if (myState.level > myState.maxLevel) myState.maxLevel = myState.level;
                
                // ÏÑ±Í≥µÌï† ÎïåÎßàÎã§ Í≤Ä ÏÉâÏÉÅ ÎûúÎç§ Î≥ÄÍ≤Ω
                mySwordColor = getRandomSwordColor();
                
                sword.classList.add('success');
                setTimeout(() => sword.classList.remove('success'), 800);
                
                createParticles('#4ecdc4', 50);
                showResult('success', `‚ú® ÏÑ±Í≥µ!<br>+${myState.level}`);
                addChat('upgrade-success', `${myName}ÎãòÏù¥ +${myState.level} Í∞ïÌôîÏóê ÏÑ±Í≥µ!`);
                
                if (myState.level === 25) {
                    addChat('system', `üéâüéâüéâ ${myName}ÎãòÏù¥ +25 Ïã†ÌôîÏùò Í≤ÄÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§! üéâüéâüéâ`);
                }
                break;
                
            case 'fail':
                sword.classList.add('fail');
                setTimeout(() => sword.classList.remove('fail'), 400);
                
                showResult('fail', 'üòÖ Ïã§Ìå®<br>Ïú†ÏßÄ');
                break;
                
            case 'down':
                myState.level = Math.max(0, myState.level - 1);
                
                sword.classList.add('fail');
                setTimeout(() => sword.classList.remove('fail'), 400);
                
                createParticles('#a55eea', 15);
                showResult('down', `üìâ ÌïòÎùΩ<br>+${myState.level}`);
                addChat('upgrade-fail', `${myName}ÎãòÏùò Í≤ÄÏù¥ +${myState.level}Î°ú ÌïòÎùΩ...`);
                break;
                
            case 'destroy':
                myState.destroyed = true;
                
                sword.classList.add('destroy');
                
                createParticles('#ff6b6b', 50);
                showResult('destroy', 'üí• ÌååÍ¥¥!');
                addChat('upgrade-destroy', `${myName}ÎãòÏùò +${oldLevel} Í≤ÄÏù¥ ÌååÍ¥¥ÎêòÏóàÏäµÎãàÎã§!`);
                break;
        }
        
        myState.upgrading = false;
        updateUI();
    }
    
    // ÏÉà Í≤Ä
    function newSword() {
        if (myState.gold < 1000) {
            alert('Í≥®ÎìúÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!');
            return;
        }
        
        myState.gold -= 1000;
        myState.level = 0;
        myState.destroyed = false;
        
        const sword = document.getElementById('mySword');
        sword.classList.remove('destroy');
        sword.innerHTML = getSwordIcon(0);
        
        addChat('system', `${myName}ÎãòÏù¥ ÏÉà Í≤ÄÏùÑ Íµ¨Îß§ÌñàÏäµÎãàÎã§.`);
        updateUI();
    }
    
    // Ï±ÑÌåÖ
    function addChat(type, message, name = '') {
        const chatMessages = document.getElementById('chatMessages');
        const msg = document.createElement('div');
        msg.className = `chat-msg ${type}`;
        
        if (type === 'chat') {
            msg.innerHTML = `<span class="name" style="color: #ffd700">${name}:</span> ${message}`;
        } else {
            msg.textContent = message;
        }
        
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // ÏµúÎåÄ 100Í∞ú
        while (chatMessages.children.length > 100) {
            chatMessages.removeChild(chatMessages.firstChild);
        }
    }
    
    function sendChat() {
        const input = document.getElementById('chatInput');
        const msg = input.value.trim();
        if (msg) {
            addChat('chat', msg, myName);
            input.value = '';
        }
    }
    
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChat();
    });
    
    document.getElementById('nameInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') startGame();
    });
    
    // Í≤∞Í≥º ÌåùÏóÖ
    function showResult(type, message) {
        document.querySelectorAll('.result-popup').forEach(p => p.remove());
        
        const popup = document.createElement('div');
        popup.className = `result-popup ${type}`;
        popup.innerHTML = message;
        document.body.appendChild(popup);
        
        setTimeout(() => popup.remove(), 1500);
    }
    
    // ÌååÌã∞ÌÅ¥
    function createParticles(color, count) {
        const container = document.getElementById('particles');
        const sword = document.getElementById('mySword');
        const rect = sword.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        // Î©îÏù∏ ÌååÌã∞ÌÅ¥
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // Îã§ÏñëÌïú ÏÉâÏÉÅ Î≥ÄÌòï
            const hueShift = (Math.random() - 0.5) * 40;
            particle.style.backgroundColor = color;
            particle.style.filter = `hue-rotate(${hueShift}deg)`;
            
            const size = 6 + Math.random() * 14;
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';
            particle.style.left = centerX + 'px';
            particle.style.top = centerY + 'px';
            
            // Î∞©ÏÇ¨ÌòïÏúºÎ°ú ÌçºÏßÄÍ∏∞
            const angle = (Math.PI * 2 * i) / count + Math.random() * 0.5;
            const distance = 80 + Math.random() * 150;
            particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
            particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
            
            // ÏßÄÏó∞ ÏãúÍ∞Ñ
            particle.style.animationDelay = (Math.random() * 0.2) + 's';
            
            container.appendChild(particle);
            setTimeout(() => particle.remove(), 1200);
        }
        
        // Ïä§ÌååÌÅ¨ Ìö®Í≥º (ÏûëÏùÄ Îπõ)
        for (let i = 0; i < count / 2; i++) {
            const spark = document.createElement('div');
            spark.className = 'spark';
            spark.style.left = centerX + 'px';
            spark.style.top = centerY + 'px';
            
            const angle = Math.random() * Math.PI * 2;
            const distance = 50 + Math.random() * 100;
            spark.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
            spark.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
            spark.style.animationDelay = (Math.random() * 0.3) + 's';
            
            container.appendChild(spark);
            setTimeout(() => spark.remove(), 800);
        }
        
        // ÎßÅ Ïù¥ÌéôÌä∏
        const ring = document.createElement('div');
        ring.className = 'ring-effect';
        ring.style.left = centerX + 'px';
        ring.style.top = centerY + 'px';
        ring.style.borderColor = color;
        container.appendChild(ring);
        setTimeout(() => ring.remove(), 600);
    }
    
    // ÏòµÏÖò Ï≤¥ÌÅ¨Î∞ïÏä§ ÌÜ†Í∏Ä
    function toggleCheck(id) {
        const checkbox = document.getElementById(id);
        const row = checkbox.closest('.option-row');
        if (row.classList.contains('disabled')) return;
        checkbox.checked = !checkbox.checked;
        updateUI();
    }
    
    // ÏòµÏÖò Ï≤¥ÌÅ¨Î∞ïÏä§ Ïù¥Î≤§Ìä∏
    document.getElementById('safeCheck').addEventListener('change', updateUI);
    document.getElementById('catchCheck').addEventListener('change', updateUI);
</script>
```

</body>
</html>