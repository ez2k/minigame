<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ë¦½í†  ë§ˆì´ë„ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 50%, #0f2460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00ff88, #00ccff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 255, 136, 0.8)); }
        }

        .coin-display {
            font-size: 2em;
            margin: 15px 0;
            color: #f7931a;
        }

        .coin-display .amount {
            font-weight: bold;
            font-size: 1.3em;
        }

        /* Market Price */
        .market-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .price-tag {
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .price-up { color: #00ff88; }
        .price-down { color: #ff4444; }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .live-indicator.live {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .live-indicator.offline {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }

        .live-indicator .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        .live-indicator.live .dot {
            background: #00ff88;
        }

        .live-indicator.offline .dot {
            background: #ffaa00;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .usd-value {
            color: #00ff88;
            font-size: 1.1em;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 0.9em;
            color: #aaa;
            margin-top: 15px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Hashrate indicator */
        .hashrate-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .hashrate-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            border-radius: 4px;
            transition: width 0.3s;
            animation: hashPulse 1s ease-in-out infinite;
        }

        @keyframes hashPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mining Animation */
        .mining-indicator {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #000;
            animation: pulse 1s infinite;
            display: none;
            margin-top: 10px;
        }

        .mining-indicator.active {
            display: inline-block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* Clicker Area */
        .clicker-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
            position: relative;
        }

        .mine-button {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #f7931a, #e2820a);
            border: 6px solid #d4760a;
            cursor: pointer;
            font-size: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow:
                0 10px 30px rgba(247, 147, 26, 0.4),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                inset 0 5px 20px rgba(255, 255, 255, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .mine-button:hover {
            transform: scale(1.05);
            box-shadow:
                0 15px 40px rgba(247, 147, 26, 0.6),
                inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                inset 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .mine-button:active {
            transform: scale(0.95);
        }

        .mine-button::after {
            content: 'â‚¿';
            position: absolute;
            font-size: 80px;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        /* Block Found Animation */
        .block-found {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #f7931a, #00ff88);
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 1.8em;
            font-weight: bold;
            color: #000;
            z-index: 2000;
            animation: blockFound 3s forwards;
        }

        @keyframes blockFound {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 20px;
            z-index: 999;
        }

        .click-text {
            position: fixed;
            pointer-events: none;
            font-weight: bold;
            color: #f7931a;
            text-shadow: 0 0 10px rgba(247, 147, 26, 0.8);
            animation: floatUp 1s ease-out forwards;
            z-index: 1000;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 3px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 60px;
            padding: 10px 5px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            color: #aaa;
            cursor: pointer;
            font-size: 0.75em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .tab.active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border-bottom: 2px solid #00ff88;
        }

        .tab.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .tab .unlock-hint {
            font-size: 0.7em;
            display: block;
            color: #888;
        }

        /* Panels */
        .panel {
            display: none;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0 0 15px 15px;
            padding: 15px;
            min-height: 300px;
        }

        .panel.active {
            display: block;
        }

        /* Locked Panel */
        .locked-panel {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }

        .locked-panel .lock-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .locked-panel h3 {
            color: #fff;
            margin-bottom: 10px;
        }

        .unlock-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 20px;
            margin: 20px auto;
            max-width: 300px;
            overflow: hidden;
        }

        .unlock-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            transition: width 0.5s;
        }

        /* Miner & Upgrade Items */
        .miner-item, .upgrade-item, .achievement-item, .feature-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .miner-item:hover, .upgrade-item:hover, .feature-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
        }

        .miner-info, .upgrade-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .miner-icon, .upgrade-icon {
            font-size: 2.5em;
            width: 60px;
            text-align: center;
        }

        .miner-details h3 {
            color: #fff;
            margin-bottom: 5px;
        }

        .miner-details p {
            color: #aaa;
            font-size: 0.85em;
        }

        .miner-owned {
            color: #00ff88;
            font-size: 0.9em;
            margin-top: 3px;
        }

        .miner-right {
            text-align: right;
        }

        .buy-btn {
            padding: 10px 20px;
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            min-width: 120px;
        }

        .buy-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .buy-amount {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            justify-content: flex-end;
        }

        .amount-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s;
        }

        .amount-btn:hover {
            background: rgba(0, 255, 136, 0.2);
        }

        .amount-btn.active {
            background: rgba(0, 255, 136, 0.3);
            border-color: #00ff88;
            color: #00ff88;
        }

        /* Achievements */
        .achievement-item {
            opacity: 0.5;
        }

        .achievement-item.unlocked {
            opacity: 1;
            border-color: rgba(0, 255, 136, 0.5);
            background: rgba(0, 255, 136, 0.1);
        }

        .achievement-icon {
            font-size: 2em;
            width: 50px;
            text-align: center;
            filter: grayscale(100%);
        }

        .achievement-item.unlocked .achievement-icon {
            filter: none;
        }

        .achievement-reward {
            color: #f7931a;
            font-size: 0.85em;
        }

        /* Market Panel */
        .market-area {
            padding: 20px;
        }

        .coin-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .coin-option {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .coin-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .coin-option.active {
            border-color: #f7931a;
            background: rgba(247, 147, 26, 0.1);
        }

        .coin-option .coin-icon {
            font-size: 2em;
            display: block;
            margin-bottom: 5px;
        }

        .coin-option .coin-name {
            font-weight: bold;
        }

        .coin-option .coin-price {
            color: #aaa;
            font-size: 0.9em;
        }

        .price-chart {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            height: 200px;
            position: relative;
            margin-bottom: 20px;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .exchange-area {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .exchange-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sell-btn {
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            color: #000;
        }

        .sell-btn:hover:not(:disabled) {
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .sell-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        /* Event Banner */
        .event-banner {
            background: linear-gradient(90deg, #ff6b6b, #f7931a, #ff6b6b);
            background-size: 200% 100%;
            animation: eventGlow 2s linear infinite;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: #000;
        }

        @keyframes eventGlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        /* Whale Alert */
        .whale-alert {
            background: linear-gradient(145deg, #00ccff, #0099ff);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            animation: whaleAlert 1s ease-in-out infinite;
        }

        @keyframes whaleAlert {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Staking */
        .staking-item {
            background: rgba(0, 204, 255, 0.1);
            border: 2px solid rgba(0, 204, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .staking-item.active {
            border-color: #00ccff;
            animation: stakingGlow 2s ease-in-out infinite;
        }

        @keyframes stakingGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 204, 255, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 204, 255, 0.5); }
        }

        /* Security */
        .security-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .security-status.danger {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid rgba(255, 68, 68, 0.5);
            animation: dangerPulse 1s infinite;
        }

        @keyframes dangerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* DeFi */
        .defi-pool {
            background: linear-gradient(145deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }

        /* Prestige */
        .prestige-area {
            text-align: center;
            padding: 30px;
        }

        .prestige-info {
            background: linear-gradient(145deg, rgba(0, 204, 255, 0.2), rgba(0, 255, 136, 0.2));
            border: 2px solid rgba(0, 204, 255, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .prestige-info h2 {
            color: #00ccff;
            margin-bottom: 15px;
        }

        .prestige-tokens {
            font-size: 2em;
            color: #00ccff;
            margin: 15px 0;
        }

        .prestige-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #00ccff, #0099cc);
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .prestige-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }

        /* Settings */
        .settings-area {
            padding: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .setting-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .setting-btn.danger {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.3);
        }

        /* Records */
        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .record-value {
            color: #f7931a;
            font-weight: bold;
        }

        /* Popup */
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .popup.hidden {
            display: none;
        }

        .popup-content {
            background: linear-gradient(145deg, #0a0a1a, #1a1a3e);
            border: 2px solid #00ff88;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
        }

        .popup-content h2 {
            color: #00ff88;
            margin-bottom: 20px;
        }

        .popup-earnings {
            font-size: 2em;
            color: #f7931a;
            margin: 20px 0;
        }

        .popup-btn {
            padding: 15px 40px;
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
        }

        /* Bonus Popup */
        .bonus-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #00ff88, #00ccff);
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            color: #000;
            z-index: 2000;
            animation: bonusPopup 2s forwards;
        }

        @keyframes bonusPopup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        /* Hack Alert */
        .hack-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.3);
            z-index: 1999;
            animation: hackFlash 0.5s infinite;
        }

        @keyframes hackFlash {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.1; }
        }

        .hack-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #1a0a0a, #3e1a1a);
            border: 3px solid #ff4444;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 2000;
            max-width: 400px;
        }

        .hack-popup h2 {
            color: #ff4444;
            margin-bottom: 20px;
        }

        /* ==================== MOBILE OPTIMIZATION v2.0 ==================== */

        /* Mobile-First Variables */
        @media (max-width: 600px) {
            :root {
                --mobile-nav-height: 70px;
                --mobile-spacing: 12px;
                --mobile-radius: 16px;
                --touch-min: 48px;
                --glass-bg: rgba(15, 15, 35, 0.85);
                --glass-border: rgba(255, 255, 255, 0.08);
                --accent-glow: rgba(0, 255, 136, 0.15);
            }
        }

        @media (max-width: 600px) {
            body {
                padding-bottom: calc(var(--mobile-nav-height) + 10px);
                background: linear-gradient(165deg, #0a0a18 0%, #12122a 40%, #0a1628 100%);
            }

            .container {
                padding: var(--mobile-spacing);
            }

            /* ===== HEADER REDESIGN ===== */
            .header {
                padding: 16px var(--mobile-spacing);
                margin-bottom: 8px;
                background: var(--glass-bg);
                border-radius: var(--mobile-radius);
                border: 1px solid var(--glass-border);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }

            .header h1 {
                font-size: 1.4em;
                margin-bottom: 12px;
                letter-spacing: 0.5px;
            }

            /* Main Balance Card */
            .coin-display {
                font-size: 1.5em;
                margin: 0 0 12px;
                padding: 16px;
                background: linear-gradient(145deg, rgba(247, 147, 26, 0.15), rgba(247, 147, 26, 0.05));
                border-radius: 14px;
                border: 1px solid rgba(247, 147, 26, 0.25);
                position: relative;
                overflow: hidden;
            }

            .coin-display::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                animation: mobileShimmer 3s infinite;
            }

            .coin-display .amount {
                font-size: 1.15em;
                font-weight: 700;
            }

            /* Market Info - Compact 2x2 Grid */
            .market-display {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                padding: 0;
                background: transparent;
                font-size: 0.82em;
            }

            .market-display > div {
                padding: 10px 8px;
                background: rgba(0, 0, 0, 0.25);
                border-radius: 10px;
                text-align: center;
                border: 1px solid var(--glass-border);
            }

            .live-indicator {
                grid-column: span 2;
                justify-content: center;
                padding: 8px !important;
                background: rgba(0, 255, 136, 0.08) !important;
                border-color: rgba(0, 255, 136, 0.2) !important;
            }

            .price-tag {
                flex-direction: column;
                gap: 3px !important;
                font-size: 0.95em;
            }

            .usd-value {
                font-size: 0.95em;
                font-weight: 600;
            }

            /* Stats - Pill Style Horizontal Scroll */
            .stats-row {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                gap: 8px;
                padding: 12px 0 8px;
                margin: 8px calc(-1 * var(--mobile-spacing)) 0;
                padding-left: var(--mobile-spacing);
                padding-right: var(--mobile-spacing);
                scrollbar-width: none;
                -ms-overflow-style: none;
                -webkit-overflow-scrolling: touch;
            }

            .stats-row::-webkit-scrollbar {
                display: none;
            }

            .stat {
                flex-shrink: 0;
                padding: 8px 14px;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
                border-radius: 20px;
                font-size: 0.78em;
                white-space: nowrap;
                border: 1px solid var(--glass-border);
                color: #ccc;
            }

            .stat span {
                color: #00ff88;
                font-weight: 600;
            }

            /* Hashrate Bar */
            .hashrate-bar {
                height: 5px;
                margin-top: 12px;
                border-radius: 3px;
                background: rgba(255, 255, 255, 0.06);
            }

            .hashrate-fill {
                border-radius: 3px;
            }

            .mining-indicator {
                font-size: 0.75em;
                padding: 5px 14px;
                margin-top: 8px;
                border-radius: 15px;
            }

            /* ===== MINING BUTTON ===== */
            .clicker-area {
                padding: 20px 0 15px;
            }

            .mine-button {
                width: 130px;
                height: 130px;
                border-width: 5px;
                box-shadow:
                    0 8px 30px rgba(247, 147, 26, 0.35),
                    inset 0 -4px 15px rgba(0, 0, 0, 0.3),
                    inset 0 4px 15px rgba(255, 255, 255, 0.2);
            }

            .mine-button::after {
                font-size: 50px;
            }

            .mine-button:active {
                transform: scale(0.92);
                box-shadow:
                    0 4px 15px rgba(247, 147, 26, 0.25),
                    inset 0 2px 10px rgba(0, 0, 0, 0.4);
            }

            /* ===== BOTTOM NAVIGATION ===== */
            .tabs {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                display: flex;
                justify-content: space-around;
                flex-wrap: nowrap;
                gap: 0;
                margin: 0;
                padding: 0 4px;
                height: var(--mobile-nav-height);
                background: linear-gradient(180deg, rgba(10, 10, 26, 0.97) 0%, rgba(8, 8, 20, 1) 100%);
                border-top: 1px solid rgba(0, 255, 136, 0.15);
                border-radius: 0;
                z-index: 1000;
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .tabs::-webkit-scrollbar {
                display: none;
            }

            .tab {
                flex: 1 0 auto;
                min-width: 56px;
                max-width: 80px;
                padding: 8px 4px 12px;
                border-radius: 0;
                font-size: 0.65em;
                font-weight: 500;
                letter-spacing: -0.2px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 4px;
                background: transparent;
                color: rgba(255, 255, 255, 0.5);
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                border-bottom: none;
            }

            .tab::before {
                content: '';
                position: absolute;
                top: 0;
                left: 50%;
                transform: translateX(-50%) scaleX(0);
                width: 24px;
                height: 2px;
                background: linear-gradient(90deg, #00ff88, #00ccff);
                border-radius: 0 0 2px 2px;
                transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .tab.active {
                color: #00ff88;
                background: linear-gradient(180deg, rgba(0, 255, 136, 0.12) 0%, transparent 100%);
            }

            .tab.active::before {
                transform: translateX(-50%) scaleX(1);
            }

            .tab.locked {
                opacity: 0.35;
                color: rgba(255, 255, 255, 0.3);
            }

            .tab .unlock-hint {
                font-size: 0.55em;
                color: rgba(255, 255, 255, 0.4);
            }

            /* ===== PANELS ===== */
            .panel {
                background: var(--glass-bg);
                border-radius: var(--mobile-radius);
                padding: 14px;
                margin-bottom: 15px;
                min-height: auto;
                border: 1px solid var(--glass-border);
            }

            /* ===== ITEM CARDS ===== */
            .miner-item, .upgrade-item, .feature-item {
                flex-direction: column;
                gap: 14px;
                text-align: center;
                padding: 18px 14px;
                border-radius: var(--mobile-radius);
                margin-bottom: 12px;
                background: linear-gradient(145deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.01));
                border: 1px solid var(--glass-border);
                transition: all 0.2s ease;
            }

            .miner-item:active, .upgrade-item:active {
                background: rgba(0, 255, 136, 0.05);
                border-color: rgba(0, 255, 136, 0.2);
                transform: scale(0.98);
            }

            .miner-info, .upgrade-info {
                flex-direction: column;
                gap: 8px;
            }

            .miner-icon, .upgrade-icon {
                font-size: 2.4em;
                width: auto;
                filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
            }

            .miner-details h3 {
                font-size: 1.05em;
                font-weight: 600;
                color: #fff;
            }

            .miner-details p {
                font-size: 0.82em;
                color: #aaa;
                line-height: 1.4;
            }

            .miner-owned {
                font-size: 0.85em;
                padding: 4px 12px;
                background: rgba(0, 255, 136, 0.1);
                border-radius: 12px;
                display: inline-block;
            }

            .miner-right {
                text-align: center;
                width: 100%;
            }

            /* ===== BUTTONS ===== */
            .buy-btn {
                width: 100%;
                padding: 14px 20px;
                font-size: 0.95em;
                font-weight: 600;
                min-height: var(--touch-min);
                border-radius: 12px;
                background: linear-gradient(145deg, #00ff88, #00cc6a);
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.25);
                transition: all 0.15s ease;
            }

            .buy-btn:active:not(:disabled) {
                transform: scale(0.97);
                box-shadow: 0 2px 8px rgba(0, 255, 136, 0.2);
            }

            .buy-btn:disabled {
                background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
                box-shadow: none;
            }

            /* Amount Selector */
            .buy-amount {
                justify-content: center;
                gap: 6px;
                margin-bottom: 14px !important;
                flex-wrap: nowrap;
            }

            .amount-btn {
                padding: 10px 14px;
                font-size: 0.85em;
                font-weight: 500;
                min-height: 42px;
                border-radius: 10px;
                background: rgba(255, 255, 255, 0.06);
                border: 1px solid var(--glass-border);
                transition: all 0.15s ease;
            }

            .amount-btn.active {
                background: rgba(0, 255, 136, 0.15);
                border-color: rgba(0, 255, 136, 0.4);
                color: #00ff88;
            }

            .amount-btn:active {
                transform: scale(0.95);
            }

            /* ===== MARKET PANEL ===== */
            .market-area {
                padding: 0;
            }

            .market-area h3 {
                font-size: 0.95em;
                margin-bottom: 12px;
                color: #ccc;
            }

            .coin-selector {
                gap: 8px;
                margin-bottom: 16px;
            }

            .coin-option {
                min-width: calc(33.33% - 6px);
                padding: 14px 8px;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.03);
                border: 2px solid var(--glass-border);
            }

            .coin-option.active {
                border-color: #f7931a;
                background: rgba(247, 147, 26, 0.1);
                box-shadow: 0 0 20px rgba(247, 147, 26, 0.15);
            }

            .coin-option .coin-icon {
                font-size: 1.8em;
                margin-bottom: 6px;
            }

            .coin-option .coin-name {
                font-size: 0.8em;
                font-weight: 600;
            }

            .coin-option .coin-price {
                font-size: 0.7em;
                margin-top: 4px;
            }

            .price-chart {
                height: 140px;
                padding: 12px;
                border-radius: 12px;
                background: rgba(0, 0, 0, 0.25);
                border: 1px solid var(--glass-border);
            }

            .exchange-area {
                flex-direction: column;
                gap: 10px;
                margin-top: 16px;
            }

            .exchange-btn {
                padding: 16px;
                font-size: 1em;
                min-height: 52px;
                border-radius: 12px;
                font-weight: 600;
            }

            .sell-btn {
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
            }

            /* ===== SPECIAL PANELS ===== */
            .staking-item {
                padding: 16px;
                border-radius: var(--mobile-radius);
            }

            .defi-pool {
                padding: 16px;
                border-radius: var(--mobile-radius);
            }

            .security-status {
                padding: 14px;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                border-radius: 12px;
            }

            .event-banner {
                padding: 14px;
                font-size: 0.9em;
                border-radius: 12px;
            }

            .whale-alert {
                padding: 14px;
                border-radius: 12px;
            }

            /* Prestige */
            .prestige-area {
                padding: 10px;
            }

            .prestige-info {
                padding: 20px 16px;
                border-radius: var(--mobile-radius);
            }

            .prestige-tokens {
                font-size: 1.5em;
            }

            .prestige-btn {
                width: 100%;
                padding: 16px;
                border-radius: 12px;
                font-size: 1em;
            }

            /* Settings */
            .setting-item {
                padding: 14px;
                border-radius: 12px;
            }

            .setting-btn {
                min-height: 44px;
                padding: 12px 18px;
                border-radius: 10px;
            }

            .record-item {
                padding: 14px;
                border-radius: 10px;
            }

            /* Locked Panel */
            .locked-panel {
                padding: 35px 16px;
            }

            .locked-panel .lock-icon {
                font-size: 3.5em;
                opacity: 0.7;
            }

            .unlock-progress {
                border-radius: 10px;
                height: 16px;
            }

            /* ===== ACHIEVEMENTS ===== */
            .achievement-item {
                padding: 14px;
                flex-direction: row;
                gap: 12px;
                text-align: left;
                border-radius: 12px;
            }

            .achievement-icon {
                font-size: 2em;
                width: 50px;
                flex-shrink: 0;
            }

            /* ===== POPUPS ===== */
            .popup-content {
                margin: 16px;
                padding: 28px 20px;
                max-width: calc(100% - 32px);
                border-radius: 20px;
                background: linear-gradient(165deg, #0a0a1a 0%, #15153a 100%);
            }

            .popup-content h2 {
                font-size: 1.3em;
            }

            .popup-earnings {
                font-size: 1.8em;
                margin: 16px 0;
            }

            .popup-btn {
                width: 100%;
                padding: 16px;
                border-radius: 12px;
                font-size: 1.05em;
            }

            .bonus-popup {
                padding: 18px 28px;
                font-size: 1.15em;
                width: calc(100% - 40px);
                max-width: 280px;
                border-radius: 16px;
            }

            .block-found {
                padding: 22px 35px;
                font-size: 1.3em;
                border-radius: 16px;
            }

            .hack-popup {
                margin: 16px;
                padding: 28px 20px;
                max-width: calc(100% - 32px);
                border-radius: 20px;
            }

            .click-text {
                font-size: 1.1em;
                font-weight: 700;
            }
        }

        /* ===== EXTRA SMALL (360px) ===== */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.25em;
            }

            .coin-display {
                font-size: 1.35em;
                padding: 14px;
            }

            .mine-button {
                width: 110px;
                height: 110px;
            }

            .mine-button::after {
                font-size: 42px;
            }

            .tab {
                min-width: 48px;
                padding: 8px 3px 10px;
                font-size: 0.58em;
            }

            .market-display {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .live-indicator {
                grid-column: span 1;
            }

            .stat {
                padding: 6px 10px;
                font-size: 0.72em;
            }

            .coin-option {
                min-width: calc(50% - 4px);
            }
        }

        /* ===== LANDSCAPE MODE ===== */
        @media (max-width: 900px) and (orientation: landscape) {
            body {
                padding-bottom: 55px;
            }

            .header {
                padding: 10px;
                margin-bottom: 6px;
            }

            .header h1 {
                font-size: 1.2em;
                margin-bottom: 8px;
            }

            .coin-display {
                font-size: 1.2em;
                margin: 0 0 8px;
                padding: 10px;
            }

            .market-display {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
            }

            .market-display > div {
                flex: 1 1 auto;
            }

            .clicker-area {
                padding: 8px 0;
            }

            .mine-button {
                width: 90px;
                height: 90px;
            }

            .mine-button::after {
                font-size: 35px;
            }

            .tabs {
                height: 55px;
            }

            .tab {
                padding: 6px 8px 8px;
                font-size: 0.6em;
                gap: 2px;
            }

            .stats-row {
                padding: 6px 0;
                margin: 4px 0 0;
            }

            .panel {
                padding: 10px;
            }
        }

        /* ===== TOUCH DEVICE OPTIMIZATIONS ===== */
        @media (hover: none) and (pointer: coarse) {
            .mine-button:hover {
                transform: none;
                box-shadow:
                    0 10px 30px rgba(247, 147, 26, 0.4),
                    inset 0 -5px 20px rgba(0, 0, 0, 0.3),
                    inset 0 5px 20px rgba(255, 255, 255, 0.3);
            }

            .mine-button:active {
                transform: scale(0.92);
            }

            .buy-btn:hover:not(:disabled) {
                transform: none;
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.25);
            }

            .tab:hover {
                background: transparent;
                color: rgba(255, 255, 255, 0.5);
            }

            .tab.active:hover {
                color: #00ff88;
                background: linear-gradient(180deg, rgba(0, 255, 136, 0.12) 0%, transparent 100%);
            }

            .tab:active {
                background: rgba(0, 255, 136, 0.08);
            }

            .miner-item:hover, .upgrade-item:hover, .feature-item:hover {
                transform: none;
                background: linear-gradient(145deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.01));
                border-color: var(--glass-border);
            }

            .coin-option:hover {
                background: rgba(255, 255, 255, 0.03);
            }

            .coin-option.active:hover {
                background: rgba(247, 147, 26, 0.1);
            }

            /* Smooth scroll behavior */
            .tabs, .stats-row {
                scroll-behavior: smooth;
            }
        }

        /* ===== SAFE AREA (NOTCHED DEVICES) ===== */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            @media (max-width: 600px) {
                body {
                    padding-bottom: calc(var(--mobile-nav-height) + env(safe-area-inset-bottom) + 10px);
                }

                .tabs {
                    padding-bottom: env(safe-area-inset-bottom);
                    height: calc(var(--mobile-nav-height) + env(safe-area-inset-bottom));
                }
            }
        }

        /* Mobile Shimmer Animation (defined outside media query for browser compatibility) */
        @keyframes mobileShimmer {
            100% { left: 100%; }
        }

        /* ===== REDUCED MOTION ===== */
        @media (prefers-reduced-motion: reduce) {
            .coin-display::before {
                animation: none;
            }

            .mine-button,
            .buy-btn,
            .tab,
            .miner-item,
            .upgrade-item {
                transition: none;
            }
        }

        /* ===== DARK MODE ENHANCEMENT ===== */
        @media (prefers-color-scheme: dark) and (max-width: 600px) {
            .header {
                background: rgba(10, 10, 25, 0.9);
            }

            .panel {
                background: rgba(10, 10, 25, 0.85);
            }
        }
    </style>
</head>
<body>
    <!-- Offline Popup -->
    <div id="offlinePopup" class="popup hidden">
        <div class="popup-content">
            <h2>ì±„êµ´ê¸°ê°€ ì—´ì‹¬íˆ ì¼í–ˆì–´ìš”! ğŸ‰</h2>
            <p id="offlineTime"></p>
            <p>ì˜¤í”„ë¼ì¸ ë™ì•ˆ ì±„êµ´í•œ ì½”ì¸:</p>
            <div class="popup-earnings" id="offlineEarnings">+0 BTC</div>
            <button class="popup-btn" onclick="closeOfflinePopup()">ë°›ê¸°!</button>
        </div>
    </div>

    <!-- Hack Popup -->
    <div id="hackPopup" class="popup hidden">
        <div id="hackOverlay" class="hack-overlay"></div>
        <div class="hack-popup">
            <h2>ğŸš¨ í•´í‚¹ ì‹œë„ ê°ì§€!</h2>
            <p id="hackMessage">í•´ì»¤ê°€ ë‹¹ì‹ ì˜ ì§€ê°‘ì„ ë…¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤!</p>
            <div class="popup-earnings" id="hackDamage" style="color: #ff4444;">-0 BTC</div>
            <button class="popup-btn" style="background: linear-gradient(145deg, #ff4444, #cc0000);" onclick="closeHackPopup()">í™•ì¸</button>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>í¬ë¦½í†  ë§ˆì´ë„ˆ</h1>
            <div class="coin-display">
                â‚¿ <span class="amount" id="coinAmount">0</span> <span id="coinSymbol">BTC</span>
            </div>
            <div class="market-display">
                <div class="live-indicator live" id="liveIndicator">
                    <span class="dot"></span>
                    <span id="liveStatus">ì‹¤ì‹œê°„</span>
                </div>
                <div class="price-tag">
                    ğŸ’µ ì‹œì„¸: $<span id="marketPrice">50000</span>
                    <span id="priceChange" class="price-up">â–² +0%</span>
                </div>
                <div class="usd-value">
                    ğŸ’ ì½”ì¸ê°€ì¹˜: $<span id="coinValue">0</span>
                </div>
                <div class="usd-value" style="color: #f7931a;">
                    ğŸ’° ì”ì•¡: $<span id="totalUSD">0</span>
                </div>
            </div>
            <div class="stats-row">
                <div class="stat">â›ï¸ í´ë¦­: <span id="hashPower">1</span> H</div>
                <div class="stat">âš¡ í•´ì‹œ: <span id="hashRate">0</span> H/s</div>
                <div class="stat">ğŸª™ í† í°: <span id="tokens">0</span></div>
                <div class="stat">ğŸ”’ ë³´ì•ˆ: <span id="securityLevel">0</span>%</div>
            </div>
            <div class="hashrate-bar">
                <div class="hashrate-fill" id="hashrateFill" style="width: 0%"></div>
            </div>
            <div class="mining-indicator" id="miningIndicator">â›ï¸ ì±„êµ´ ì¤‘...</div>
        </div>

        <!-- Clicker -->
        <div class="clicker-area" id="clickerArea">
            <button class="mine-button" id="mineBtn"></button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="miners">â›ï¸ ì±„êµ´</button>
            <button class="tab" data-tab="upgrades">â¬†ï¸ ê°•í™”</button>
            <button class="tab" data-tab="market">ğŸ“ˆ ê±°ë˜</button>
            <button class="tab" data-tab="events" id="eventsTab">ğŸ“° ì´ë²¤íŠ¸</button>
            <button class="tab" data-tab="staking" id="stakingTab">ğŸ’ ìŠ¤í…Œì´í‚¹</button>
            <button class="tab" data-tab="security" id="securityTab">ğŸ” ë³´ì•ˆ</button>
            <button class="tab" data-tab="defi" id="defiTab">ğŸ¦ DeFi</button>
            <button class="tab" data-tab="achievements">ğŸ† ì—…ì </button>
            <button class="tab" data-tab="prestige">ğŸ”„ í¬í¬</button>
            <button class="tab" data-tab="settings">âš™ï¸</button>
        </div>

        <!-- Panels -->
        <div id="miners" class="panel active">
            <div class="buy-amount" style="margin-bottom: 15px;">
                <span style="color: #aaa; margin-right: 10px;">êµ¬ë§¤ ìˆ˜ëŸ‰:</span>
                <button class="amount-btn active" data-amount="1">x1</button>
                <button class="amount-btn" data-amount="10">x10</button>
                <button class="amount-btn" data-amount="100">x100</button>
                <button class="amount-btn" data-amount="max">MAX</button>
            </div>
            <div id="minerList"></div>
        </div>

        <div id="upgrades" class="panel">
            <div id="upgradeList"></div>
        </div>

        <div id="market" class="panel">
            <div class="market-area">
                <h3 style="margin-bottom: 15px;">ğŸª™ ì½”ì¸ ì„ íƒ</h3>
                <div class="coin-selector" id="coinSelector"></div>

                <h3 style="margin: 20px 0 15px;">ğŸ“ˆ ê°€ê²© ì°¨íŠ¸ (24ì‹œê°„)</h3>
                <div class="price-chart">
                    <canvas id="priceChart" class="chart-canvas"></canvas>
                </div>

                <div class="exchange-area">
                    <button class="exchange-btn sell-btn" id="sellBtn" onclick="sellCoins()">
                        ì „ëŸ‰ ë§¤ë„ ($<span id="sellValue">0</span>)
                    </button>
                </div>
            </div>
        </div>

        <div id="events" class="panel">
            <div id="eventsContent"></div>
        </div>

        <div id="staking" class="panel">
            <div id="stakingContent"></div>
        </div>

        <div id="security" class="panel">
            <div id="securityContent"></div>
        </div>

        <div id="defi" class="panel">
            <div id="defiContent"></div>
        </div>

        <div id="achievements" class="panel">
            <div id="achievementList"></div>
        </div>

        <div id="prestige" class="panel">
            <div class="prestige-area">
                <div class="prestige-info">
                    <h2>ğŸ”„ í•˜ë“œí¬í¬ ì‹œìŠ¤í…œ</h2>
                    <p>ëª¨ë“  ì½”ì¸ê³¼ ì±„êµ´ê¸°ë¥¼ ì´ˆê¸°í™”í•˜ê³ <br>ì˜êµ¬ ë³´ë„ˆìŠ¤ í† í°ì„ íšë“í•˜ì„¸ìš”!</p>
                    <div class="prestige-tokens">
                        íšë“ ì˜ˆì •: <span id="forkGain">0</span> ğŸª™
                    </div>
                    <p style="color: #aaa;">í˜„ì¬ ë³´ë„ˆìŠ¤: <span id="forkBonus">0</span>% ì¶”ê°€ í•´ì‹œíŒŒì›Œ</p>
                    <button class="prestige-btn" id="forkBtn" disabled onclick="doHardFork()">í•˜ë“œí¬í¬ ì‹¤í–‰</button>
                    <p style="color: #888; margin-top: 15px;" id="forkReq">ì´ $1,000,000 í™˜ì „ í•„ìš”</p>
                </div>
            </div>
        </div>

        <div id="settings" class="panel">
            <div class="settings-area">
                <div class="setting-item">
                    <span>ğŸ”Š ì‚¬ìš´ë“œ</span>
                    <button class="setting-btn" id="soundToggle" onclick="toggleSound()">ON</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ’¾ ìˆ˜ë™ ì €ì¥</span>
                    <button class="setting-btn" onclick="saveGame()">ì €ì¥í•˜ê¸°</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ“Š í†µê³„ ë³´ê¸°</span>
                    <button class="setting-btn" onclick="showStats()">í†µê³„</button>
                </div>
                <div class="setting-item">
                    <span>ğŸ—‘ï¸ ê²Œì„ ì´ˆê¸°í™”</span>
                    <button class="setting-btn danger" onclick="resetGame()">ì´ˆê¸°í™”</button>
                </div>
            </div>
            <div id="statsArea" style="display: none; padding: 20px;">
                <h3 style="margin-bottom: 20px;">ğŸ“Š ì±„êµ´ í†µê³„</h3>
                <div class="record-item">
                    <span>â‚¿ ìµœê³  ë³´ìœ ëŸ‰</span>
                    <span class="record-value" id="recordCoins">0</span>
                </div>
                <div class="record-item">
                    <span>ğŸ’µ ì´ í™˜ì „ USD</span>
                    <span class="record-value" id="recordUSD">$0</span>
                </div>
                <div class="record-item">
                    <span>ğŸ‘† ì´ í´ë¦­ ìˆ˜</span>
                    <span class="record-value" id="recordClicks">0</span>
                </div>
                <div class="record-item">
                    <span>â›ï¸ ì´ ì±„êµ´ëŸ‰</span>
                    <span class="record-value" id="recordMined">0</span>
                </div>
                <div class="record-item">
                    <span>ğŸ”„ í•˜ë“œí¬í¬ íšŸìˆ˜</span>
                    <span class="record-value" id="recordForks">0</span>
                </div>
                <div class="record-item">
                    <span>ğŸ† ë‹¬ì„± ì—…ì </span>
                    <span class="record-value" id="recordAchievements">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GAME STATE ====================
        let gameState = {
            coins: 0,
            usd: 0,
            totalMined: 0,
            totalUSD: 0,
            totalClicks: 0,
            hashPower: 1,
            hashRate: 0,
            tokens: 0,
            totalTokens: 0,
            forkCount: 0,
            miners: {},
            upgrades: {},
            achievements: {},
            selectedCoin: 'btc',
            lastSave: Date.now(),
            sessionStart: Date.now(),
            highestCoins: 0,
            soundEnabled: true,
            // New systems
            securityLevel: 0,
            securityUpgrades: {},
            stakedCoins: {},
            stakingStartTime: {},
            defiPools: {},
            whaleAlertActive: false,
            currentEvent: null,
            eventEndTime: 0,
            totalHackLoss: 0,
            hackDefended: 0
        };

        let buyAmount = 1;
        let globalMultiplier = 1;
        let minerMultipliers = {};
        let priceHistory = [];
        let currentPrice = 50000;
        let priceDirection = 1;
        let isLivePrice = false;
        let priceChange24h = 0;
        let realPrices = {
            btc: { usd: 50000, usd_24h_change: 0 },
            eth: { usd: 3000, usd_24h_change: 0 },
            doge: { usd: 0.15, usd_24h_change: 0 }
        };
        let lastApiCall = 0;

        // ==================== UNLOCK CONDITIONS ====================
        const UNLOCK_CONDITIONS = {
            events: { type: 'usd', value: 100000, name: 'ì‹œì¥ ì´ë²¤íŠ¸', desc: '$100K í™˜ì „ í›„ í•´ê¸ˆ' },
            staking: { type: 'fork', value: 1, name: 'ìŠ¤í…Œì´í‚¹', desc: 'ì²« í•˜ë“œí¬í¬ í›„ í•´ê¸ˆ' },
            security: { type: 'fork', value: 1, name: 'ë³´ì•ˆ ì‹œìŠ¤í…œ', desc: 'ì²« í•˜ë“œí¬í¬ í›„ í•´ê¸ˆ' },
            defi: { type: 'fork', value: 3, name: 'DeFi', desc: '3íšŒ í•˜ë“œí¬í¬ í›„ í•´ê¸ˆ' }
        };

        function isUnlocked(feature) {
            const cond = UNLOCK_CONDITIONS[feature];
            if (!cond) return true;
            if (cond.type === 'usd') return gameState.totalUSD >= cond.value;
            if (cond.type === 'fork') return gameState.forkCount >= cond.value;
            return false;
        }

        function getUnlockProgress(feature) {
            const cond = UNLOCK_CONDITIONS[feature];
            if (!cond) return 100;
            if (cond.type === 'usd') return Math.min(100, (gameState.totalUSD / cond.value) * 100);
            if (cond.type === 'fork') return Math.min(100, (gameState.forkCount / cond.value) * 100);
            return 0;
        }

        // ==================== COIN DATA ====================
        const coinTypes = {
            btc: { name: 'Bitcoin', symbol: 'BTC', icon: 'â‚¿', basePrice: 50000, color: '#f7931a', volatility: 0.02 },
            eth: { name: 'Ethereum', symbol: 'ETH', icon: 'Î', basePrice: 3000, color: '#627eea', volatility: 0.03 },
            doge: { name: 'Dogecoin', symbol: 'DOGE', icon: 'ğŸ•', basePrice: 0.15, color: '#c3a634', volatility: 0.05 }
        };

        // ==================== MINER DATA ====================
        const miners = [
            { id: 'cpu', name: 'CPU ì±„êµ´', icon: 'ğŸ’»', basePrice: 15, baseHash: 0.1, desc: 'ê¸°ë³¸ì ì¸ CPU ì±„êµ´' },
            { id: 'gpu', name: 'GPU ì±„êµ´ê¸°', icon: 'ğŸ®', basePrice: 100, baseHash: 1, desc: 'ê·¸ë˜í”½ ì¹´ë“œ ì±„êµ´' },
            { id: 'asic', name: 'ASIC ë§ˆì´ë„ˆ', icon: 'ğŸ”²', basePrice: 1100, baseHash: 8, desc: 'ì „ìš© ì±„êµ´ ì¥ë¹„' },
            { id: 'farm', name: 'ì±„êµ´ ë†ì¥', icon: 'ğŸ­', basePrice: 12000, baseHash: 47, desc: 'ëŒ€ê·œëª¨ ì±„êµ´ ì‹œì„¤' },
            { id: 'pool', name: 'ì±„êµ´ í’€', icon: 'ğŸŒŠ', basePrice: 130000, baseHash: 260, desc: 'í˜‘ë ¥ ì±„êµ´ ë„¤íŠ¸ì›Œí¬' },
            { id: 'quantum', name: 'ì–‘ì ì»´í“¨í„°', icon: 'âš›ï¸', basePrice: 1400000, baseHash: 1400, desc: 'ì°¨ì„¸ëŒ€ ì–‘ì ì±„êµ´' },
            { id: 'ai', name: 'AI ì±„êµ´ ì‹œìŠ¤í…œ', icon: 'ğŸ¤–', basePrice: 20000000, baseHash: 7800, desc: 'AI ìµœì í™” ì±„êµ´' },
            { id: 'fusion', name: 'í•µìœµí•© ì±„êµ´ì†Œ', icon: 'â˜€ï¸', basePrice: 330000000, baseHash: 44000, desc: 'ë¬´í•œ ì—ë„ˆì§€ ì±„êµ´' },
            { id: 'dyson', name: 'ë‹¤ì´ìŠ¨ ìŠ¤í”¼ì–´', icon: 'ğŸŒ', basePrice: 5100000000, baseHash: 260000, desc: 'í•­ì„± ì—ë„ˆì§€ ì±„êµ´' }
        ];

        const upgrades = [
            { id: 'hash1', name: 'ì˜¤ë²„í´ëŸ­', icon: 'âš¡', price: 100, desc: 'í´ë¦­ í•´ì‹œ +1', effect: () => gameState.hashPower += 1 },
            { id: 'hash2', name: 'ì¿¨ë§ ì‹œìŠ¤í…œ', icon: 'â„ï¸', price: 500, desc: 'í´ë¦­ í•´ì‹œ +5', effect: () => gameState.hashPower += 5 },
            { id: 'hash3', name: 'ì „ë ¥ ìµœì í™”', icon: 'ğŸ”‹', price: 10000, desc: 'í´ë¦­ í•´ì‹œ +50', effect: () => gameState.hashPower += 50 },
            { id: 'cpu1', name: 'CPU ì—…ê·¸ë ˆì´ë“œ', icon: 'ğŸ’»', price: 100, desc: 'CPU íš¨ìœ¨ 2ë°°', requires: 'cpu', multiplier: 2 },
            { id: 'gpu1', name: 'GPU ìµœì í™”', icon: 'ğŸ®', price: 1000, desc: 'GPU íš¨ìœ¨ 2ë°°', requires: 'gpu', multiplier: 2 },
            { id: 'asic1', name: 'ASIC íŒì›¨ì–´', icon: 'ğŸ”²', price: 11000, desc: 'ASIC íš¨ìœ¨ 2ë°°', requires: 'asic', multiplier: 2 },
            { id: 'farm1', name: 'ë†ì¥ í™•ì¥', icon: 'ğŸ—ï¸', price: 120000, desc: 'ë†ì¥ íš¨ìœ¨ 2ë°°', requires: 'farm', multiplier: 2 },
            { id: 'pool1', name: 'í’€ ìµœì í™”', icon: 'ğŸ“Š', price: 1300000, desc: 'í’€ íš¨ìœ¨ 2ë°°', requires: 'pool', multiplier: 2 },
            { id: 'global1', name: 'ë¸”ë¡ì²´ì¸ ìµœì í™”', icon: 'ğŸ”—', price: 10000000, desc: 'ëª¨ë“  í•´ì‹œë ˆì´íŠ¸ +50%', globalMultiplier: 1.5 },
            { id: 'hash4', name: 'ì‹ ê²½ë§ í•´ì‹±', icon: 'ğŸ§ ', price: 100000000, desc: 'í´ë¦­ í•´ì‹œ +500', effect: () => gameState.hashPower += 500 },
            { id: 'global2', name: 'ì–‘ì ê°€ì†', icon: 'ğŸš€', price: 1000000000, desc: 'ëª¨ë“  í•´ì‹œë ˆì´íŠ¸ 2ë°°', globalMultiplier: 2 }
        ];

        // ==================== ACHIEVEMENTS (10x rewards!) ====================
        const achievements = [
            { id: 'click10', name: 'ì²« ë°œê±¸ìŒ', icon: 'ğŸ‘†', desc: '10ë²ˆ í´ë¦­', condition: () => gameState.totalClicks >= 10, reward: 100 },
            { id: 'click100', name: 'ì—´ì • ì±„êµ´ëŸ¬', icon: 'â›ï¸', desc: '100ë²ˆ í´ë¦­', condition: () => gameState.totalClicks >= 100, reward: 500 },
            { id: 'click1000', name: 'ì±„êµ´ ë§ˆìŠ¤í„°', icon: 'ğŸ’', desc: '1,000ë²ˆ í´ë¦­', condition: () => gameState.totalClicks >= 1000, reward: 2000 },
            { id: 'click10000', name: 'ì „ì„¤ì˜ ì±„êµ´ëŸ¬', icon: 'ğŸ‘‘', desc: '10,000ë²ˆ í´ë¦­', condition: () => gameState.totalClicks >= 10000, reward: 10000 },
            { id: 'coin1', name: 'ì²« ì½”ì¸', icon: 'ğŸª™', desc: '1 BTC ì±„êµ´', condition: () => gameState.totalMined >= 1, reward: 1000 },
            { id: 'coin100', name: 'ë¹„íŠ¸ì½”ì¸ ë³´ìœ ì', icon: 'â‚¿', desc: '100 BTC ì±„êµ´', condition: () => gameState.totalMined >= 100, reward: 10000 },
            { id: 'coin1000', name: 'ì½”ì¸ ì™•', icon: 'ğŸ†', desc: '1,000 BTC ì±„êµ´', condition: () => gameState.totalMined >= 1000, reward: 50000 },
            { id: 'usd100k', name: 'ì„±ê³µì˜ ì‹œì‘', icon: 'ğŸ’µ', desc: '$100,000 í™˜ì „', condition: () => gameState.totalUSD >= 100000, reward: 10000 },
            { id: 'usd1m', name: 'ë°±ë§Œì¥ì', icon: 'ğŸ’°', desc: '$1,000,000 í™˜ì „', condition: () => gameState.totalUSD >= 1000000, reward: 50000 },
            { id: 'usd100m', name: 'ì–µë§Œì¥ì', icon: 'ğŸ¤‘', desc: '$100,000,000 í™˜ì „', condition: () => gameState.totalUSD >= 100000000, reward: 500000 },
            { id: 'usd1b', name: 'ì¬ë²Œ', icon: 'ğŸ¦', desc: '$1,000,000,000 í™˜ì „', condition: () => gameState.totalUSD >= 1000000000, reward: 5000000 },
            { id: 'fork1', name: 'ì²« í•˜ë“œí¬í¬', icon: 'ğŸ”„', desc: 'ì²« í•˜ë“œí¬í¬ ì‹¤í–‰', condition: () => gameState.forkCount >= 1, reward: 5000 },
            { id: 'fork5', name: 'í¬í¬ ë§ˆìŠ¤í„°', icon: 'ğŸŒ', desc: '5ë²ˆ í•˜ë“œí¬í¬', condition: () => gameState.forkCount >= 5, reward: 20000 },
            { id: 'fork10', name: 'ë¸”ë¡ì²´ì¸ ì‹ ', icon: 'âš¡', desc: '10ë²ˆ í•˜ë“œí¬í¬', condition: () => gameState.forkCount >= 10, reward: 100000 },
            { id: 'miner10', name: 'ì±„êµ´ ì‹œì‘', icon: 'ğŸ­', desc: 'ì±„êµ´ê¸° 10ê°œ ë³´ìœ ', condition: () => Object.values(gameState.miners).reduce((a,b) => a+b, 0) >= 10, reward: 1000 },
            { id: 'miner100', name: 'ì±„êµ´ ì œêµ­', icon: 'ğŸ‘‘', desc: 'ì±„êµ´ê¸° 100ê°œ ë³´ìœ ', condition: () => Object.values(gameState.miners).reduce((a,b) => a+b, 0) >= 100, reward: 10000 },
            { id: 'miner500', name: 'ì±„êµ´ êµ°ì£¼', icon: 'ğŸŒŸ', desc: 'ì±„êµ´ê¸° 500ê°œ ë³´ìœ ', condition: () => Object.values(gameState.miners).reduce((a,b) => a+b, 0) >= 500, reward: 50000 },
            { id: 'security50', name: 'ë³´ì•ˆ ì „ë¬¸ê°€', icon: 'ğŸ”’', desc: 'ë³´ì•ˆ 50% ë‹¬ì„±', condition: () => gameState.securityLevel >= 50, reward: 20000 },
            { id: 'security100', name: 'ì² ë²½ ë°©ì–´', icon: 'ğŸ›¡ï¸', desc: 'ë³´ì•ˆ 100% ë‹¬ì„±', condition: () => gameState.securityLevel >= 100, reward: 100000 },
            { id: 'defend10', name: 'í•´ì»¤ ì‚¬ëƒ¥ê¾¼', icon: 'ğŸ¯', desc: 'í•´í‚¹ 10íšŒ ë°©ì–´', condition: () => gameState.hackDefended >= 10, reward: 30000 }
        ];

        // ==================== MARKET EVENTS ====================
        const marketEvents = [
            { id: 'bull', name: 'ğŸ‚ ê°•ì„¸ì¥!', desc: 'ëª¨ë“  ì½”ì¸ ê°€ê²© +30%', effect: { priceMultiplier: 1.3 }, duration: 60 },
            { id: 'bear', name: 'ğŸ» ì•½ì„¸ì¥!', desc: 'ëª¨ë“  ì½”ì¸ ê°€ê²© -20%', effect: { priceMultiplier: 0.8 }, duration: 60 },
            { id: 'elon', name: 'ğŸš€ ì¼ë¡  íŠ¸ìœ—!', desc: 'DOGE ê°€ê²© 2ë°°!', effect: { coinMultiplier: { doge: 2 } }, duration: 45 },
            { id: 'halving', name: 'â›ï¸ ë°˜ê°ê¸°!', desc: 'ì±„êµ´ëŸ‰ 50%, ê°€ê²© +50%', effect: { miningMultiplier: 0.5, priceMultiplier: 1.5 }, duration: 90 },
            { id: 'etf', name: 'ğŸ“ˆ ETF ìŠ¹ì¸!', desc: 'BTC ê°€ê²© +40%', effect: { coinMultiplier: { btc: 1.4 } }, duration: 60 },
            { id: 'regulation', name: 'âš–ï¸ ê·œì œ ë‰´ìŠ¤', desc: 'ëª¨ë“  ê°€ê²© -15%', effect: { priceMultiplier: 0.85 }, duration: 45 },
            { id: 'adoption', name: 'ğŸª ëŒ€ëŸ‰ ì±„íƒ!', desc: 'ëª¨ë“  í•´ì‹œë ˆì´íŠ¸ +50%', effect: { hashMultiplier: 1.5 }, duration: 60 },
            { id: 'fomo', name: 'ğŸ˜± FOMO ë°œìƒ!', desc: 'í´ë¦­ ë³´ìƒ 3ë°°!', effect: { clickMultiplier: 3 }, duration: 30 }
        ];

        // ==================== STAKING OPTIONS ====================
        const stakingOptions = [
            { id: 'flex', name: 'ìœ ë™ ìŠ¤í…Œì´í‚¹', icon: 'ğŸ’§', apy: 5, lockDays: 0, desc: 'ì–¸ì œë“  ì¶œê¸ˆ ê°€ëŠ¥' },
            { id: 'week', name: 'ì£¼ê°„ ìŠ¤í…Œì´í‚¹', icon: 'ğŸ“…', apy: 15, lockDays: 7, desc: '7ì¼ ì ê¸ˆ' },
            { id: 'month', name: 'ì›”ê°„ ìŠ¤í…Œì´í‚¹', icon: 'ğŸ—“ï¸', apy: 30, lockDays: 30, desc: '30ì¼ ì ê¸ˆ' },
            { id: 'year', name: 'ì—°ê°„ ìŠ¤í…Œì´í‚¹', icon: 'ğŸ¯', apy: 100, lockDays: 365, desc: '365ì¼ ì ê¸ˆ, ìµœê³  ìˆ˜ìµ!' }
        ];

        // ==================== SECURITY UPGRADES ====================
        const securityUpgrades = [
            { id: 'firewall', name: 'ë°©í™”ë²½', icon: 'ğŸ”¥', price: 5000, security: 10, desc: 'ê¸°ë³¸ ë³´ì•ˆ ê°•í™”' },
            { id: '2fa', name: '2ë‹¨ê³„ ì¸ì¦', icon: 'ğŸ“±', price: 20000, security: 15, desc: 'ê³„ì • ë³´í˜¸ ê°•í™”' },
            { id: 'coldwallet', name: 'ì½œë“œì›”ë ›', icon: 'â„ï¸', price: 100000, security: 25, desc: 'ì˜¤í”„ë¼ì¸ ë³´ê´€' },
            { id: 'multisig', name: 'ë©€í‹°ì‹œê·¸', icon: 'ğŸ”‘', price: 500000, security: 20, desc: 'ë‹¤ì¤‘ ì„œëª… í•„ìš”' },
            { id: 'insurance', name: 'í•´í‚¹ ë³´í—˜', icon: 'ğŸ›¡ï¸', price: 2000000, security: 30, desc: 'ì†ì‹¤ 50% ë³´ìƒ' }
        ];

        // ==================== DEFI POOLS ====================
        const defiPools = [
            { id: 'liquidity', name: 'ìœ ë™ì„± í’€', icon: 'ğŸ’§', minDeposit: 10000, dailyReturn: 0.5, risk: 10, desc: 'ì•ˆì •ì ì¸ ìˆ˜ìµ' },
            { id: 'yield', name: 'ì´ì ë†ì‚¬', icon: 'ğŸŒ¾', minDeposit: 50000, dailyReturn: 2, risk: 25, desc: 'ë†’ì€ ìˆ˜ìµ, ì¤‘ê°„ ìœ„í—˜' },
            { id: 'leverage', name: 'ë ˆë²„ë¦¬ì§€ í’€', icon: 'ğŸ“ˆ', minDeposit: 100000, dailyReturn: 5, risk: 50, desc: 'ê³ ìœ„í—˜ ê³ ìˆ˜ìµ!' }
        ];

        // ==================== AUDIO ====================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function playSound(type) {
            if (!gameState.soundEnabled) return;
            if (!audioCtx) audioCtx = new AudioContext();

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const sounds = {
                click: { freq: 600, duration: 0.05 },
                buy: { freq: 800, duration: 0.1 },
                achievement: { freq: 1000, duration: 0.2 },
                sell: { freq: 1200, duration: 0.15 },
                block: { freq: 1500, duration: 0.3 },
                hack: { freq: 200, duration: 0.5 },
                whale: { freq: 400, duration: 0.3 }
            };

            const sound = sounds[type] || sounds.click;
            oscillator.frequency.setValueAtTime(sound.freq, audioCtx.currentTime);
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + sound.duration);

            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + sound.duration);
        }

        // ==================== UTILITIES ====================
        function formatNumber(num) {
            if (num < 0.0001) return num.toExponential(2);
            if (num < 1) return num.toFixed(4);
            if (num < 1000) return num.toFixed(2);

            const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc'];
            const tier = Math.floor(Math.log10(Math.abs(num)) / 3);

            if (tier >= suffixes.length) return num.toExponential(2);

            const suffix = suffixes[tier];
            const scale = Math.pow(10, tier * 3);
            const scaled = num / scale;

            return scaled.toFixed(scaled < 10 ? 2 : 1) + suffix;
        }

        function formatUSD(num) {
            return '$' + formatNumber(num);
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // ==================== REAL-TIME PRICE API ====================
        const COINGECKO_API = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,dogecoin&vs_currencies=usd&include_24hr_change=true';
        const API_COOLDOWN = 60000;

        async function fetchRealPrices() {
            const now = Date.now();
            if (now - lastApiCall < API_COOLDOWN) return;
            lastApiCall = now;

            try {
                const response = await fetch(COINGECKO_API);
                if (!response.ok) throw new Error('API Error');

                const data = await response.json();

                realPrices = {
                    btc: { usd: data.bitcoin.usd, usd_24h_change: data.bitcoin.usd_24h_change || 0 },
                    eth: { usd: data.ethereum.usd, usd_24h_change: data.ethereum.usd_24h_change || 0 },
                    doge: { usd: data.dogecoin.usd, usd_24h_change: data.dogecoin.usd_24h_change || 0 }
                };

                isLivePrice = true;
                updateLiveIndicator(true);
                renderCoinSelector();

            } catch (error) {
                isLivePrice = false;
                updateLiveIndicator(false);
            }
        }

        function updateLiveIndicator(isLive) {
            const indicator = document.getElementById('liveIndicator');
            const status = document.getElementById('liveStatus');

            if (isLive) {
                indicator.className = 'live-indicator live';
                status.textContent = 'ì‹¤ì‹œê°„';
            } else {
                indicator.className = 'live-indicator offline';
                status.textContent = 'ì‹œë®¬';
            }
        }

        function updatePrice() {
            const coin = coinTypes[gameState.selectedCoin];
            let eventMultiplier = 1;

            // Apply event effects
            if (gameState.currentEvent && Date.now() < gameState.eventEndTime) {
                const event = marketEvents.find(e => e.id === gameState.currentEvent);
                if (event?.effect.priceMultiplier) eventMultiplier *= event.effect.priceMultiplier;
                if (event?.effect.coinMultiplier?.[gameState.selectedCoin]) {
                    eventMultiplier *= event.effect.coinMultiplier[gameState.selectedCoin];
                }
            }

            if (isLivePrice) {
                currentPrice = realPrices[gameState.selectedCoin].usd * eventMultiplier;
                priceChange24h = realPrices[gameState.selectedCoin].usd_24h_change;
            } else {
                const change = (Math.random() - 0.5) * coin.volatility * currentPrice;
                if (Math.random() < 0.1) priceDirection *= -1;
                currentPrice += change + (priceDirection * coin.volatility * currentPrice * 0.1);
                currentPrice = Math.max(coin.basePrice * 0.3, Math.min(coin.basePrice * 3, currentPrice));
                currentPrice *= eventMultiplier;

                if (priceHistory.length > 0) {
                    const oldPrice = priceHistory[0];
                    priceChange24h = ((currentPrice - oldPrice) / oldPrice) * 100;
                }
            }

            priceHistory.push(currentPrice);
            if (priceHistory.length > 60) priceHistory.shift();
        }

        // ==================== PARTICLES ====================
        function createParticles(x, y, count = 5) {
            const emojis = ['âš¡', 'ğŸ’', 'âœ¨', 'ğŸ”¥'];
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';

                const angle = (Math.random() * 360) * (Math.PI / 180);
                const velocity = 50 + Math.random() * 100;
                const dx = Math.cos(angle) * velocity;
                const dy = Math.sin(angle) * velocity;

                document.body.appendChild(particle);

                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${dx}px, ${dy}px) scale(0)`, opacity: 0 }
                ], { duration: 1000, easing: 'ease-out' });

                setTimeout(() => particle.remove(), 1000);
            }
        }

        function showBonusPopup(text) {
            const popup = document.createElement('div');
            popup.className = 'bonus-popup';
            popup.textContent = text;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2000);
        }

        function showBlockFound(amount) {
            const block = document.createElement('div');
            block.className = 'block-found';
            block.innerHTML = `ğŸ‰ ë¸”ë¡ ë°œê²¬!<br>+${formatNumber(amount)} ${coinTypes[gameState.selectedCoin].symbol}`;
            document.body.appendChild(block);
            playSound('block');
            setTimeout(() => block.remove(), 3000);
        }

        // ==================== CALCULATIONS ====================
        function getMinerPrice(miner, amount = 1) {
            const owned = gameState.miners[miner.id] || 0;
            let total = 0;
            for (let i = 0; i < amount; i++) {
                total += Math.floor(miner.basePrice * Math.pow(1.15, owned + i));
            }
            return total;
        }

        function getMaxAffordable(miner) {
            const owned = gameState.miners[miner.id] || 0;
            let count = 0, total = 0;
            while (total + Math.floor(miner.basePrice * Math.pow(1.15, owned + count)) <= gameState.usd) {
                total += Math.floor(miner.basePrice * Math.pow(1.15, owned + count));
                count++;
                if (count > 1000) break;
            }
            return count;
        }

        function getActualBuyAmount(miner) {
            if (buyAmount === 'max') return getMaxAffordable(miner);
            return Math.min(buyAmount, getMaxAffordable(miner));
        }

        function calculateHashRate() {
            let total = 0;
            let eventMultiplier = 1;

            if (gameState.currentEvent && Date.now() < gameState.eventEndTime) {
                const event = marketEvents.find(e => e.id === gameState.currentEvent);
                if (event?.effect.hashMultiplier) eventMultiplier = event.effect.hashMultiplier;
            }

            miners.forEach(miner => {
                const owned = gameState.miners[miner.id] || 0;
                const multiplier = minerMultipliers[miner.id] || 1;
                total += owned * miner.baseHash * multiplier * globalMultiplier * eventMultiplier;
            });

            const tokenBonus = 1 + (gameState.tokens * 0.01);
            total *= tokenBonus;

            return total;
        }

        function calculateForkGain() {
            if (gameState.totalUSD < 1000000) return 0;
            return Math.floor(Math.sqrt(gameState.totalUSD / 1000000));
        }

        function calculateSecurityLevel() {
            let level = 0;
            securityUpgrades.forEach(upgrade => {
                if (gameState.securityUpgrades[upgrade.id]) {
                    level += upgrade.security;
                }
            });
            return Math.min(100, level);
        }

        // ==================== GAME ACTIONS ====================
        function handleClick(e) {
            let clickMultiplier = 1;

            if (gameState.currentEvent && Date.now() < gameState.eventEndTime) {
                const event = marketEvents.find(ev => ev.id === gameState.currentEvent);
                if (event?.effect.clickMultiplier) clickMultiplier = event.effect.clickMultiplier;
            }

            const tokenBonus = 1 + (gameState.tokens * 0.01);
            const earned = gameState.hashPower * tokenBonus * 0.00001 * clickMultiplier;

            gameState.coins += earned;
            gameState.totalMined += earned;
            gameState.totalClicks++;

            if (gameState.coins > gameState.highestCoins) {
                gameState.highestCoins = gameState.coins;
            }

            playSound('click');

            const x = e.clientX || e.touches?.[0]?.clientX || window.innerWidth/2;
            const y = e.clientY || e.touches?.[0]?.clientY || window.innerHeight/2;

            const text = document.createElement('div');
            text.className = 'click-text';
            text.textContent = '+' + formatNumber(earned);
            text.style.left = x + 'px';
            text.style.top = y + 'px';
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 1000);

            createParticles(x, y, 3);

            checkAchievements();
            updateUI();
        }

        function buyMiner(minerId) {
            const miner = miners.find(m => m.id === minerId);
            const amount = getActualBuyAmount(miner);
            if (amount <= 0) return;

            const price = getMinerPrice(miner, amount);
            if (gameState.usd >= price) {
                gameState.usd -= price;
                gameState.miners[minerId] = (gameState.miners[minerId] || 0) + amount;
                gameState.hashRate = calculateHashRate();
                playSound('buy');
                checkAchievements();
                fullRender();
                updateUI();
            }
        }

        function buyUpgrade(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            if (gameState.upgrades[upgradeId]) return;
            if (gameState.usd < upgrade.price) return;

            gameState.usd -= upgrade.price;
            gameState.upgrades[upgradeId] = true;

            if (upgrade.effect) upgrade.effect();
            if (upgrade.multiplier && upgrade.requires) {
                minerMultipliers[upgrade.requires] = (minerMultipliers[upgrade.requires] || 1) * upgrade.multiplier;
            }
            if (upgrade.globalMultiplier) {
                globalMultiplier *= upgrade.globalMultiplier;
            }

            gameState.hashRate = calculateHashRate();
            playSound('buy');
            fullRender();
            updateUI();
        }

        function sellCoins() {
            if (gameState.coins <= 0) return;

            const value = gameState.coins * currentPrice;
            gameState.usd += value;
            gameState.totalUSD += value;
            gameState.coins = 0;

            playSound('sell');
            showBonusPopup(`+${formatUSD(value)} í™˜ì „ ì™„ë£Œ!`);
            checkAchievements();
            updateTabStates();
            updateUI();
        }

        function selectCoin(coinId) {
            gameState.selectedCoin = coinId;
            currentPrice = isLivePrice ? realPrices[coinId].usd : coinTypes[coinId].basePrice;
            priceChange24h = isLivePrice ? realPrices[coinId].usd_24h_change : 0;
            priceHistory = [currentPrice];
            renderCoinSelector();
            updateUI();
        }

        function doHardFork() {
            const gain = calculateForkGain();
            if (gain <= 0) return;
            if (!confirm(`í•˜ë“œí¬í¬ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${gain}ê°œì˜ í† í°ì„ íšë“í•©ë‹ˆë‹¤.\nëª¨ë“  ì½”ì¸, USD, ì±„êµ´ê¸°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.`)) return;

            gameState.tokens += gain;
            gameState.totalTokens += gain;
            gameState.forkCount++;
            gameState.coins = 0;
            gameState.usd = 0;
            gameState.totalUSD = 0;
            gameState.hashPower = 1;
            gameState.miners = {};
            gameState.upgrades = {};

            globalMultiplier = 1;
            minerMultipliers = {};

            gameState.hashRate = calculateHashRate();
            playSound('achievement');
            showBonusPopup(`ğŸ”„ í•˜ë“œí¬í¬ ì™„ë£Œ! +${gain} í† í°`);
            checkAchievements();
            updateTabStates();
            fullRender();
            updateUI();
            saveGame();
        }

        // ==================== STAKING SYSTEM ====================
        function stakeCoins(optionId, amount) {
            if (gameState.coins < amount) return;

            gameState.coins -= amount;
            gameState.stakedCoins[optionId] = (gameState.stakedCoins[optionId] || 0) + amount;
            gameState.stakingStartTime[optionId] = Date.now();

            playSound('buy');
            showBonusPopup(`ğŸ’ ${formatNumber(amount)} ${coinTypes[gameState.selectedCoin].symbol} ìŠ¤í…Œì´í‚¹!`);
            renderStaking();
            updateUI();
        }

        function unstakeCoins(optionId) {
            const option = stakingOptions.find(o => o.id === optionId);
            const staked = gameState.stakedCoins[optionId] || 0;
            if (staked <= 0) return;

            const startTime = gameState.stakingStartTime[optionId] || Date.now();
            const daysStaked = (Date.now() - startTime) / (1000 * 60 * 60 * 24);

            if (option.lockDays > 0 && daysStaked < option.lockDays) {
                if (!confirm(`ì•„ì§ ì ê¸ˆ ê¸°ê°„ì´ ëë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì¡°ê¸° ì¶œê¸ˆ ì‹œ ë³´ìƒ ì—†ì´ ì›ê¸ˆë§Œ ëŒë ¤ë°›ìŠµë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
                gameState.coins += staked;
            } else {
                const reward = staked * (option.apy / 100) * (daysStaked / 365);
                gameState.coins += staked + reward;
                showBonusPopup(`ğŸ’° +${formatNumber(reward)} ${coinTypes[gameState.selectedCoin].symbol} ì´ì!`);
            }

            gameState.stakedCoins[optionId] = 0;
            delete gameState.stakingStartTime[optionId];

            playSound('sell');
            renderStaking();
            updateUI();
        }

        // ==================== SECURITY SYSTEM ====================
        function buySecurityUpgrade(upgradeId) {
            const upgrade = securityUpgrades.find(u => u.id === upgradeId);
            if (gameState.securityUpgrades[upgradeId]) return;
            if (gameState.usd < upgrade.price) return;

            gameState.usd -= upgrade.price;
            gameState.securityUpgrades[upgradeId] = true;
            gameState.securityLevel = calculateSecurityLevel();

            playSound('buy');
            showBonusPopup(`ğŸ” ë³´ì•ˆ +${upgrade.security}%!`);
            checkAchievements();
            renderSecurity();
            updateUI();
        }

        function triggerHackAttempt() {
            if (!isUnlocked('security')) return;
            if (gameState.coins <= 0) return;
            if (Math.random() > 0.02) return; // 2% chance per tick

            const hackPower = Math.random() * 100;
            const defended = hackPower < gameState.securityLevel;

            if (defended) {
                gameState.hackDefended++;
                showBonusPopup(`ğŸ›¡ï¸ í•´í‚¹ ë°©ì–´ ì„±ê³µ!`);
                playSound('achievement');
            } else {
                const lossPercent = Math.min(50, (hackPower - gameState.securityLevel)) / 100;
                let loss = gameState.coins * lossPercent;

                // Insurance reduces loss by 50%
                if (gameState.securityUpgrades['insurance']) {
                    loss *= 0.5;
                }

                gameState.coins -= loss;
                gameState.totalHackLoss += loss;

                document.getElementById('hackDamage').textContent = `-${formatNumber(loss)} ${coinTypes[gameState.selectedCoin].symbol}`;
                document.getElementById('hackMessage').textContent = `í•´ì»¤ê°€ ${(lossPercent * 100).toFixed(0)}%ì˜ ì½”ì¸ì„ í›”ì³¤ìŠµë‹ˆë‹¤!`;
                document.getElementById('hackPopup').classList.remove('hidden');
                playSound('hack');
            }

            checkAchievements();
        }

        function closeHackPopup() {
            document.getElementById('hackPopup').classList.add('hidden');
        }

        // ==================== DEFI SYSTEM ====================
        function depositDeFi(poolId, amount) {
            const pool = defiPools.find(p => p.id === poolId);
            if (gameState.usd < amount || amount < pool.minDeposit) return;

            gameState.usd -= amount;
            gameState.defiPools[poolId] = {
                amount: (gameState.defiPools[poolId]?.amount || 0) + amount,
                startTime: Date.now()
            };

            playSound('buy');
            showBonusPopup(`ğŸ¦ ${formatUSD(amount)} DeFi ì˜ˆì¹˜!`);
            renderDeFi();
            updateUI();
        }

        function withdrawDeFi(poolId) {
            const pool = defiPools.find(p => p.id === poolId);
            const deposit = gameState.defiPools[poolId];
            if (!deposit || deposit.amount <= 0) return;

            const daysDeposited = (Date.now() - deposit.startTime) / (1000 * 60 * 60 * 24);
            const reward = deposit.amount * (pool.dailyReturn / 100) * daysDeposited;

            // Risk check
            if (Math.random() * 100 < pool.risk) {
                const lossPercent = Math.random() * 0.3;
                const loss = deposit.amount * lossPercent;
                gameState.usd += deposit.amount - loss;
                showBonusPopup(`âš ï¸ ì†ì‹¤ ë°œìƒ! -${formatUSD(loss)}`);
            } else {
                gameState.usd += deposit.amount + reward;
                showBonusPopup(`ğŸ’° +${formatUSD(reward)} ìˆ˜ìµ!`);
            }

            gameState.defiPools[poolId] = { amount: 0, startTime: 0 };
            playSound('sell');
            renderDeFi();
            updateUI();
        }

        // ==================== MARKET EVENTS ====================
        function triggerMarketEvent() {
            if (!isUnlocked('events')) return;
            if (gameState.currentEvent && Date.now() < gameState.eventEndTime) return;
            if (Math.random() > 0.01) return; // 1% chance per tick

            const event = marketEvents[Math.floor(Math.random() * marketEvents.length)];
            gameState.currentEvent = event.id;
            gameState.eventEndTime = Date.now() + (event.duration * 1000);

            showBonusPopup(`${event.name}`);
            playSound('achievement');
            renderEvents();
        }

        function triggerWhaleAlert() {
            if (!isUnlocked('events')) return;
            if (Math.random() > 0.005) return; // 0.5% chance

            gameState.whaleAlertActive = true;
            playSound('whale');

            setTimeout(() => {
                if (gameState.whaleAlertActive) {
                    // Whale caused price movement
                    const direction = Math.random() > 0.5 ? 1.2 : 0.8;
                    currentPrice *= direction;
                    gameState.whaleAlertActive = false;
                    renderEvents();
                }
            }, 10000);

            renderEvents();
        }

        function actOnWhale(action) {
            if (!gameState.whaleAlertActive) return;

            const direction = Math.random() > 0.5;
            const correct = (action === 'buy' && direction) || (action === 'sell' && !direction);

            if (correct) {
                const bonus = gameState.coins * 0.1;
                gameState.coins += bonus;
                showBonusPopup(`ğŸ‹ ì˜ˆì¸¡ ì„±ê³µ! +${formatNumber(bonus)}`);
            } else {
                showBonusPopup(`ğŸ˜… ì˜ˆì¸¡ ì‹¤íŒ¨!`);
            }

            gameState.whaleAlertActive = false;
            playSound('sell');
            renderEvents();
            updateUI();
        }

        // ==================== ACHIEVEMENTS ====================
        function checkAchievements() {
            let newAchievement = false;
            achievements.forEach(ach => {
                if (!gameState.achievements[ach.id] && ach.condition()) {
                    gameState.achievements[ach.id] = true;
                    gameState.usd += ach.reward;
                    newAchievement = true;
                    showBonusPopup(`ğŸ† ${ach.name} ë‹¬ì„±! +${formatUSD(ach.reward)}`);
                    playSound('achievement');
                }
            });
            if (newAchievement) renderAchievements();
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            document.getElementById('soundToggle').textContent = gameState.soundEnabled ? 'ON' : 'OFF';
        }

        function showStats() {
            const statsArea = document.getElementById('statsArea');
            statsArea.style.display = statsArea.style.display === 'none' ? 'block' : 'none';
        }

        // ==================== CHART ====================
        function updateChart() {
            const canvas = document.getElementById('priceChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.parentElement.clientWidth;
            const height = canvas.parentElement.clientHeight;

            canvas.width = width;
            canvas.height = height;

            ctx.clearRect(0, 0, width, height);

            if (priceHistory.length < 2) return;

            const max = Math.max(...priceHistory);
            const min = Math.min(...priceHistory);
            const range = max - min || 1;
            const step = width / (priceHistory.length - 1);

            ctx.beginPath();
            const coin = coinTypes[gameState.selectedCoin];

            priceHistory.forEach((val, i) => {
                const x = i * step;
                const y = height - ((val - min) / range) * (height - 40) - 20;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });

            ctx.strokeStyle = coin.color;
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();

            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, coin.color + '40');
            gradient.addColorStop(1, coin.color + '00');
            ctx.fillStyle = gradient;
            ctx.fill();
        }

        // ==================== RENDERING ====================
        function updateTabStates() {
            ['events', 'staking', 'security', 'defi'].forEach(feature => {
                const tab = document.getElementById(feature + 'Tab');
                if (tab) {
                    if (isUnlocked(feature)) {
                        tab.classList.remove('locked');
                        tab.innerHTML = tab.innerHTML.split('<span')[0];
                    } else {
                        tab.classList.add('locked');
                        const cond = UNLOCK_CONDITIONS[feature];
                        if (!tab.innerHTML.includes('unlock-hint')) {
                            tab.innerHTML += `<span class="unlock-hint">ğŸ”’</span>`;
                        }
                    }
                }
            });
        }

        function renderLockedPanel(feature) {
            const cond = UNLOCK_CONDITIONS[feature];
            const progress = getUnlockProgress(feature);
            return `
                <div class="locked-panel">
                    <div class="lock-icon">ğŸ”’</div>
                    <h3>${cond.name}</h3>
                    <p>${cond.desc}</p>
                    <div class="unlock-progress">
                        <div class="unlock-progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <p>${progress.toFixed(1)}% ì§„í–‰</p>
                </div>
            `;
        }

        function renderCoinSelector() {
            const container = document.getElementById('coinSelector');
            container.innerHTML = Object.entries(coinTypes).map(([id, coin]) => {
                const price = isLivePrice ? realPrices[id].usd : coin.basePrice;
                const change = isLivePrice ? realPrices[id].usd_24h_change : 0;
                const changeClass = change >= 0 ? 'price-up' : 'price-down';
                const changeText = isLivePrice ? `<span class="${changeClass}">${change >= 0 ? '+' : ''}${change.toFixed(1)}%</span>` : '';

                return `
                    <div class="coin-option ${gameState.selectedCoin === id ? 'active' : ''}" onclick="selectCoin('${id}')">
                        <span class="coin-icon">${coin.icon}</span>
                        <div class="coin-name">${coin.name}</div>
                        <div class="coin-price">$${formatNumber(price)} ${changeText}</div>
                    </div>
                `;
            }).join('');
        }

        function renderMiners() {
            const container = document.getElementById('minerList');
            container.innerHTML = miners.map(miner => {
                const owned = gameState.miners[miner.id] || 0;
                const amount = buyAmount === 'max' ? getMaxAffordable(miner) : buyAmount;
                const price = getMinerPrice(miner, amount);
                const canBuy = gameState.usd >= price && amount > 0;
                const multiplier = minerMultipliers[miner.id] || 1;
                const hashRate = miner.baseHash * multiplier * globalMultiplier;

                return `
                    <div class="miner-item">
                        <div class="miner-info">
                            <div class="miner-icon">${miner.icon}</div>
                            <div class="miner-details">
                                <h3>${miner.name}</h3>
                                <p>${miner.desc}</p>
                                <p style="color: #00ff88;">${formatNumber(hashRate)} H/s</p>
                                <p class="miner-owned">ë³´ìœ : ${owned}ëŒ€</p>
                            </div>
                        </div>
                        <div class="miner-right">
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buyMiner('${miner.id}')">
                                ${amount > 0 ? `x${amount} - ${formatUSD(price)}` : 'êµ¬ë§¤ ë¶ˆê°€'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderUpgrades() {
            const container = document.getElementById('upgradeList');
            container.innerHTML = upgrades.map(upgrade => {
                const purchased = gameState.upgrades[upgrade.id];
                const canBuy = !purchased && gameState.usd >= upgrade.price;

                return `
                    <div class="upgrade-item ${purchased ? 'purchased' : ''}">
                        <div class="upgrade-info">
                            <div class="upgrade-icon">${upgrade.icon}</div>
                            <div class="miner-details">
                                <h3>${upgrade.name}</h3>
                                <p>${upgrade.desc}</p>
                            </div>
                        </div>
                        <div class="miner-right">
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buyUpgrade('${upgrade.id}')">
                                ${purchased ? 'êµ¬ë§¤ì™„ë£Œ' : formatUSD(upgrade.price)}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAchievements() {
            const container = document.getElementById('achievementList');
            container.innerHTML = achievements.map(ach => {
                const isUnlockedAch = gameState.achievements[ach.id];
                return `
                    <div class="achievement-item ${isUnlockedAch ? 'unlocked' : ''}">
                        <div class="miner-info">
                            <div class="achievement-icon">${ach.icon}</div>
                            <div class="miner-details">
                                <h3>${ach.name}</h3>
                                <p>${ach.desc}</p>
                                <p class="achievement-reward">ë³´ìƒ: +${formatUSD(ach.reward)}</p>
                            </div>
                        </div>
                        <div>${isUnlockedAch ? 'âœ…' : 'ğŸ”’'}</div>
                    </div>
                `;
            }).join('');
        }

        function renderEvents() {
            const container = document.getElementById('eventsContent');

            if (!isUnlocked('events')) {
                container.innerHTML = renderLockedPanel('events');
                return;
            }

            let content = '<h3 style="margin-bottom: 20px;">ğŸ“° ì‹œì¥ ì´ë²¤íŠ¸</h3>';

            // Current event
            if (gameState.currentEvent && Date.now() < gameState.eventEndTime) {
                const event = marketEvents.find(e => e.id === gameState.currentEvent);
                const remaining = Math.ceil((gameState.eventEndTime - Date.now()) / 1000);
                content += `
                    <div class="event-banner">
                        ${event.name}<br>
                        <small>${event.desc}</small><br>
                        <span>â° ${remaining}ì´ˆ ë‚¨ìŒ</span>
                    </div>
                `;
            } else {
                content += `<p style="color: #888; text-align: center; margin: 20px 0;">ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘...</p>`;
            }

            // Whale alert
            if (gameState.whaleAlertActive) {
                content += `
                    <div class="whale-alert">
                        <h3>ğŸ‹ ê³ ë˜ ê²½ë³´!</h3>
                        <p>ëŒ€ëŸ‰ ê±°ë˜ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤! ë°©í–¥ì„ ì˜ˆì¸¡í•˜ì„¸ìš”!</p>
                        <div style="margin-top: 15px;">
                            <button class="buy-btn" onclick="actOnWhale('buy')" style="margin-right: 10px;">ğŸ“ˆ ë§¤ìˆ˜</button>
                            <button class="buy-btn" onclick="actOnWhale('sell')" style="background: linear-gradient(145deg, #ff6b6b, #ff4444);">ğŸ“‰ ë§¤ë„</button>
                        </div>
                    </div>
                `;
            }

            // Event history
            content += `
                <div style="margin-top: 20px;">
                    <h4>ğŸ“Š ì´ë²¤íŠ¸ ì¢…ë¥˜</h4>
                    ${marketEvents.map(e => `
                        <div class="feature-item" style="padding: 10px;">
                            <span>${e.name}</span>
                            <span style="color: #888; font-size: 0.9em;">${e.desc}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = content;
        }

        function renderStaking() {
            const container = document.getElementById('stakingContent');

            if (!isUnlocked('staking')) {
                container.innerHTML = renderLockedPanel('staking');
                return;
            }

            let content = '<h3 style="margin-bottom: 20px;">ğŸ’ ìŠ¤í…Œì´í‚¹</h3>';

            stakingOptions.forEach(option => {
                const staked = gameState.stakedCoins[option.id] || 0;
                const startTime = gameState.stakingStartTime[option.id];
                const daysStaked = startTime ? (Date.now() - startTime) / (1000 * 60 * 60 * 24) : 0;
                const currentReward = staked * (option.apy / 100) * (daysStaked / 365);
                const canUnstake = staked > 0 && (option.lockDays === 0 || daysStaked >= option.lockDays);

                content += `
                    <div class="staking-item ${staked > 0 ? 'active' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <h4>${option.icon} ${option.name}</h4>
                                <p style="color: #888;">${option.desc}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #00ff88; font-size: 1.5em;">${option.apy}% APY</div>
                            </div>
                        </div>
                        ${staked > 0 ? `
                            <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                                <p>ìŠ¤í…Œì´í‚¹: ${formatNumber(staked)} ${coinTypes[gameState.selectedCoin].symbol}</p>
                                <p style="color: #00ff88;">ì˜ˆìƒ ë³´ìƒ: +${formatNumber(currentReward)} ${coinTypes[gameState.selectedCoin].symbol}</p>
                                <p style="color: #888;">ê¸°ê°„: ${daysStaked.toFixed(2)}ì¼</p>
                            </div>
                            <button class="buy-btn" onclick="unstakeCoins('${option.id}')" ${!canUnstake ? 'style="background: #555;"' : ''}>
                                ${canUnstake ? 'ì¶œê¸ˆí•˜ê¸°' : `${(option.lockDays - daysStaked).toFixed(1)}ì¼ ë‚¨ìŒ`}
                            </button>
                        ` : `
                            <div style="display: flex; gap: 10px;">
                                <button class="buy-btn" onclick="stakeCoins('${option.id}', gameState.coins * 0.25)" ${gameState.coins <= 0 ? 'disabled' : ''}>25%</button>
                                <button class="buy-btn" onclick="stakeCoins('${option.id}', gameState.coins * 0.5)" ${gameState.coins <= 0 ? 'disabled' : ''}>50%</button>
                                <button class="buy-btn" onclick="stakeCoins('${option.id}', gameState.coins)" ${gameState.coins <= 0 ? 'disabled' : ''}>ì „ì•¡</button>
                            </div>
                        `}
                    </div>
                `;
            });

            container.innerHTML = content;
        }

        function renderSecurity() {
            const container = document.getElementById('securityContent');

            if (!isUnlocked('security')) {
                container.innerHTML = renderLockedPanel('security');
                return;
            }

            const secLevel = calculateSecurityLevel();
            let content = `
                <h3 style="margin-bottom: 20px;">ğŸ” ë³´ì•ˆ ì‹œìŠ¤í…œ</h3>
                <div class="security-status ${secLevel < 30 ? 'danger' : ''}">
                    <span style="font-size: 2em;">ğŸ›¡ï¸</span>
                    <div>
                        <h4>ë³´ì•ˆ ë ˆë²¨: ${secLevel}%</h4>
                        <p style="color: ${secLevel < 30 ? '#ff4444' : secLevel < 70 ? '#ffaa00' : '#00ff88'};">
                            ${secLevel < 30 ? 'ìœ„í—˜! í•´í‚¹ì— ì·¨ì•½í•©ë‹ˆë‹¤.' : secLevel < 70 ? 'ë³´í†µ. ì¶”ê°€ ë³´ì•ˆ ê¶Œì¥.' : 'ì•ˆì „! ì˜ ë³´í˜¸ë˜ê³  ìˆìŠµë‹ˆë‹¤.'}
                        </p>
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <p>ì´ í•´í‚¹ ì†ì‹¤: ${formatNumber(gameState.totalHackLoss)} ${coinTypes[gameState.selectedCoin].symbol}</p>
                    <p>ë°©ì–´ ì„±ê³µ: ${gameState.hackDefended}íšŒ</p>
                </div>
                <h4 style="margin-bottom: 15px;">ğŸ”§ ë³´ì•ˆ ì—…ê·¸ë ˆì´ë“œ</h4>
            `;

            securityUpgrades.forEach(upgrade => {
                const owned = gameState.securityUpgrades[upgrade.id];
                const canBuy = !owned && gameState.usd >= upgrade.price;

                content += `
                    <div class="feature-item ${owned ? 'unlocked' : ''}">
                        <div class="miner-info">
                            <div class="miner-icon">${upgrade.icon}</div>
                            <div class="miner-details">
                                <h3>${upgrade.name}</h3>
                                <p>${upgrade.desc}</p>
                                <p style="color: #00ff88;">+${upgrade.security}% ë³´ì•ˆ</p>
                            </div>
                        </div>
                        <div>
                            <button class="buy-btn" ${!canBuy ? 'disabled' : ''} onclick="buySecurityUpgrade('${upgrade.id}')">
                                ${owned ? 'âœ… í™œì„±í™”' : formatUSD(upgrade.price)}
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = content;
        }

        function renderDeFi() {
            const container = document.getElementById('defiContent');

            if (!isUnlocked('defi')) {
                container.innerHTML = renderLockedPanel('defi');
                return;
            }

            let content = '<h3 style="margin-bottom: 20px;">ğŸ¦ DeFi í’€</h3>';

            defiPools.forEach(pool => {
                const deposit = gameState.defiPools[pool.id];
                const deposited = deposit?.amount || 0;
                const daysDeposited = deposit?.startTime ? (Date.now() - deposit.startTime) / (1000 * 60 * 60 * 24) : 0;
                const currentReward = deposited * (pool.dailyReturn / 100) * daysDeposited;

                content += `
                    <div class="defi-pool">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <h4>${pool.icon} ${pool.name}</h4>
                                <p style="color: #888;">${pool.desc}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #00ff88; font-size: 1.3em;">${pool.dailyReturn}%/ì¼</div>
                                <div style="color: #ff6b6b;">ìœ„í—˜: ${pool.risk}%</div>
                            </div>
                        </div>
                        <p style="color: #888; margin-bottom: 10px;">ìµœì†Œ ì˜ˆì¹˜: ${formatUSD(pool.minDeposit)}</p>
                        ${deposited > 0 ? `
                            <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                                <p>ì˜ˆì¹˜ê¸ˆ: ${formatUSD(deposited)}</p>
                                <p style="color: #00ff88;">ì˜ˆìƒ ìˆ˜ìµ: +${formatUSD(currentReward)}</p>
                                <p style="color: #888;">ê¸°ê°„: ${daysDeposited.toFixed(2)}ì¼</p>
                            </div>
                            <button class="buy-btn" onclick="withdrawDeFi('${pool.id}')">ì¶œê¸ˆ (ìœ„í—˜: ${pool.risk}%)</button>
                        ` : `
                            <div style="display: flex; gap: 10px;">
                                <button class="buy-btn" onclick="depositDeFi('${pool.id}', ${pool.minDeposit})" ${gameState.usd < pool.minDeposit ? 'disabled' : ''}>
                                    ${formatUSD(pool.minDeposit)}
                                </button>
                                <button class="buy-btn" onclick="depositDeFi('${pool.id}', ${pool.minDeposit * 5})" ${gameState.usd < pool.minDeposit * 5 ? 'disabled' : ''}>
                                    ${formatUSD(pool.minDeposit * 5)}
                                </button>
                            </div>
                        `}
                    </div>
                `;
            });

            container.innerHTML = content;
        }

        function fullRender() {
            renderCoinSelector();
            renderMiners();
            renderUpgrades();
            renderAchievements();
            renderEvents();
            renderStaking();
            renderSecurity();
            renderDeFi();
            updateTabStates();
        }

        function updateUI() {
            const coin = coinTypes[gameState.selectedCoin];

            document.getElementById('coinAmount').textContent = formatNumber(gameState.coins);
            document.getElementById('coinSymbol').textContent = coin.symbol;
            document.getElementById('hashPower').textContent = formatNumber(gameState.hashPower);
            document.getElementById('hashRate').textContent = formatNumber(gameState.hashRate);
            document.getElementById('tokens').textContent = formatNumber(gameState.tokens);
            document.getElementById('securityLevel').textContent = gameState.securityLevel;

            document.getElementById('marketPrice').textContent = formatNumber(currentPrice);
            document.getElementById('coinValue').textContent = formatNumber(gameState.coins * currentPrice);
            document.getElementById('totalUSD').textContent = formatNumber(gameState.usd);

            const priceChangeEl = document.getElementById('priceChange');
            const displayChange = isLivePrice ? priceChange24h : (priceHistory.length > 1 ? ((currentPrice - priceHistory[0]) / priceHistory[0]) * 100 : 0);
            priceChangeEl.textContent = (displayChange >= 0 ? 'â–² +' : 'â–¼ ') + Math.abs(displayChange).toFixed(2) + '%';
            priceChangeEl.className = displayChange >= 0 ? 'price-up' : 'price-down';

            document.getElementById('sellValue').textContent = formatNumber(gameState.coins * currentPrice);
            document.getElementById('sellBtn').disabled = gameState.coins <= 0;

            const maxHash = 1000000;
            const hashPercent = Math.min(100, (gameState.hashRate / maxHash) * 100);
            document.getElementById('hashrateFill').style.width = hashPercent + '%';

            const miningIndicator = document.getElementById('miningIndicator');
            miningIndicator.classList.toggle('active', gameState.hashRate > 0);

            const gain = calculateForkGain();
            document.getElementById('forkGain').textContent = formatNumber(gain);
            document.getElementById('forkBonus').textContent = gameState.tokens;
            document.getElementById('forkBtn').disabled = gain <= 0;
            document.getElementById('forkReq').textContent = gain > 0 ? 'í•˜ë“œí¬í¬ ê°€ëŠ¥!' : `ì´ ${formatUSD(1000000)} í™˜ì „ í•„ìš”`;

            document.getElementById('recordCoins').textContent = formatNumber(gameState.highestCoins) + ' ' + coin.symbol;
            document.getElementById('recordUSD').textContent = formatUSD(gameState.totalUSD);
            document.getElementById('recordClicks').textContent = formatNumber(gameState.totalClicks);
            document.getElementById('recordMined').textContent = formatNumber(gameState.totalMined) + ' ' + coin.symbol;
            document.getElementById('recordForks').textContent = gameState.forkCount;
            document.getElementById('recordAchievements').textContent = Object.keys(gameState.achievements).length + '/' + achievements.length;
        }

        // ==================== GAME LOOP ====================
        let blockFindChance = 0;

        function gameLoop() {
            gameState.hashRate = calculateHashRate();

            if (gameState.hashRate > 0) {
                let miningMultiplier = 1;
                if (gameState.currentEvent && Date.now() < gameState.eventEndTime) {
                    const event = marketEvents.find(e => e.id === gameState.currentEvent);
                    if (event?.effect.miningMultiplier) miningMultiplier = event.effect.miningMultiplier;
                }

                const tokenBonus = 1 + (gameState.tokens * 0.01);
                const earned = (gameState.hashRate * tokenBonus * 0.00001 * miningMultiplier) / 10;
                gameState.coins += earned;
                gameState.totalMined += earned;

                if (gameState.coins > gameState.highestCoins) {
                    gameState.highestCoins = gameState.coins;
                }

                blockFindChance += gameState.hashRate * 0.000001;
                if (Math.random() < blockFindChance / 1000) {
                    const bonus = gameState.hashRate * 0.01;
                    gameState.coins += bonus;
                    gameState.totalMined += bonus;
                    showBlockFound(bonus);
                    blockFindChance = 0;
                }
            }

            // Random events
            triggerMarketEvent();
            triggerWhaleAlert();
            triggerHackAttempt();

            // Clear expired event
            if (gameState.currentEvent && Date.now() >= gameState.eventEndTime) {
                gameState.currentEvent = null;
                renderEvents();
            }

            checkAchievements();
            updateUI();
        }

        // ==================== SAVE/LOAD ====================
        function saveGame() {
            gameState.lastSave = Date.now();
            localStorage.setItem('cryptoMiner', JSON.stringify(gameState));
            localStorage.setItem('cryptoMinerMultipliers', JSON.stringify({
                global: globalMultiplier,
                miners: minerMultipliers
            }));
        }

        function loadGame() {
            const saved = localStorage.getItem('cryptoMiner');
            const multipliers = localStorage.getItem('cryptoMinerMultipliers');

            if (saved) {
                const loaded = JSON.parse(saved);
                gameState = { ...gameState, ...loaded };
                gameState.sessionStart = Date.now();

                if (multipliers) {
                    const m = JSON.parse(multipliers);
                    globalMultiplier = m.global || 1;
                    minerMultipliers = m.miners || {};
                }

                document.getElementById('soundToggle').textContent = gameState.soundEnabled ? 'ON' : 'OFF';

                currentPrice = coinTypes[gameState.selectedCoin].basePrice;
                priceHistory = [currentPrice];

                gameState.securityLevel = calculateSecurityLevel();

                const now = Date.now();
                const elapsed = (now - gameState.lastSave) / 1000;

                if (elapsed > 60 && gameState.hashRate > 0) {
                    const maxOfflineTime = 8 * 60 * 60;
                    const offlineTime = Math.min(elapsed, maxOfflineTime);
                    const offlineEarnings = gameState.hashRate * 0.00001 * offlineTime * 0.5;

                    document.getElementById('offlineTime').textContent =
                        `${Math.floor(offlineTime/3600)}ì‹œê°„ ${Math.floor((offlineTime%3600)/60)}ë¶„ ë™ì•ˆ`;
                    document.getElementById('offlineEarnings').textContent = '+' + formatNumber(offlineEarnings) + ' ' + coinTypes[gameState.selectedCoin].symbol;
                    document.getElementById('offlinePopup').classList.remove('hidden');

                    gameState.coins += offlineEarnings;
                    gameState.totalMined += offlineEarnings;
                }

                gameState.hashRate = calculateHashRate();
            }
        }

        function closeOfflinePopup() {
            document.getElementById('offlinePopup').classList.add('hidden');
        }

        function resetGame() {
            if (!confirm('ì •ë§ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤!')) return;
            localStorage.removeItem('cryptoMiner');
            localStorage.removeItem('cryptoMinerMultipliers');
            location.reload();
        }

        // ==================== INITIALIZATION ====================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;

                // Check if locked
                if (UNLOCK_CONDITIONS[tabName] && !isUnlocked(tabName)) {
                    const cond = UNLOCK_CONDITIONS[tabName];
                    showBonusPopup(`ğŸ”’ ${cond.desc}`);
                    return;
                }

                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });

        document.querySelectorAll('.amount-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                buyAmount = btn.dataset.amount === 'max' ? 'max' : parseInt(btn.dataset.amount);
                fullRender();
                updateUI();
            });
        });

        document.getElementById('mineBtn').addEventListener('click', handleClick);
        document.getElementById('mineBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick(e);
        });

        loadGame();
        gameState.hashRate = calculateHashRate();
        fullRender();
        updateUI();

        fetchRealPrices();

        setInterval(gameLoop, 100);
        setInterval(saveGame, 30000);
        setInterval(updatePrice, 2000);
        setInterval(updateChart, 1000);
        setInterval(fetchRealPrices, 60000);
        setInterval(fullRender, 5000);
    </script>
</body>
</html>
